{"ast":null,"code":"var _jsxFileName = \"D:\\\\realtime-code-editor\\\\client\\\\src\\\\pages\\\\EditorPage.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useLocation, useParams, useNavigate, useBeforeUnload } from 'react-router-dom';\nimport Editor from '@monaco-editor/react';\nimport { io } from 'socket.io-client';\nimport FileSidebar from '../components/FileSidebar';\nimport '../styles/editor.css';\nimport { downloadProjectAsZip } from '../utils/downloadZip';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction EditorPage() {\n  _s();\n  const {\n    roomId\n  } = useParams();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const socketRef = useRef(null);\n  const initializedRef = useRef(false);\n  const currentUserRef = useRef(null);\n  const editorRef = useRef(null);\n  const iframeRef = useRef(null);\n  const isUpdatingFromSocket = useRef(false);\n  const lastChangeTimestamp = useRef(0);\n  const [username, setUsername] = useState('');\n  const [files, setFiles] = useState(null);\n  const [activeFile, setActiveFile] = useState('index.html');\n  const [connectionStatus, setConnectionStatus] = useState('Connecting...');\n  const [users, setUsers] = useState([]);\n  const [activeUsers, setActiveUsers] = useState({});\n  const [typingUsers, setTypingUsers] = useState({});\n  const [userCursors, setUserCursors] = useState({});\n  const [showNewFileModal, setShowNewFileModal] = useState(false);\n  const [showNewFolderModal, setShowNewFolderModal] = useState(false);\n  const [newFileName, setNewFileName] = useState('');\n  const [newFolderName, setNewFolderName] = useState('');\n  // Add to your existing state\n  const [fileTree, setFileTree] = useState(null);\n  const [panelWidth, setPanelWidth] = useState(65);\n  const [isDragging, setIsDragging] = useState(false);\n\n  // Colors for different users\n  const userColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];\n  const getUserColor = userId => {\n    const index = Object.keys(activeUsers).indexOf(userId);\n    return userColors[index % userColors.length];\n  };\n\n  // Debounced save function\n  const debouncedSaveRef = useRef();\n  const debouncedSave = useCallback(debounce(async (roomId, filename, content) => {\n    try {\n      await fetch('http://localhost:5000/api/code/save', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          roomId,\n          filename,\n          content\n        })\n      });\n    } catch (err) {\n      console.error('Error saving file:', err);\n    }\n  }, 2000), [roomId]);\n  // const loadFiles = async () => {\n  //   const { files, tree } = await fetchFiles();\n  //   setFiles(files);\n  //   setFileTree(tree);\n  //   setActiveFile('index.html');\n  // };\n  // Fetch files from backend\n  const fetchFiles = useCallback(async () => {\n    if (!roomId) return;\n    try {\n      const response = await fetch(`http://localhost:5000/api/code/${roomId}`);\n      if (!response.ok) {\n        if (response.status === 404) {\n          // Create default files structure\n          const defaultFiles = {\n            'index.html': '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>',\n            'style.css': '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}',\n            'script.js': '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");'\n          };\n\n          // Save default files to database\n          await Promise.all(Object.entries(defaultFiles).map(([filename, content]) => debouncedSave(roomId, filename, content)));\n\n          // Create default tree structure\n          const defaultTree = {\n            name: 'root',\n            type: 'folder',\n            path: '',\n            children: [{\n              name: 'index.html',\n              type: 'file',\n              path: 'index.html',\n              content: defaultFiles['index.html']\n            }, {\n              name: 'style.css',\n              type: 'file',\n              path: 'style.css',\n              content: defaultFiles['style.css']\n            }, {\n              name: 'script.js',\n              type: 'file',\n              path: 'script.js',\n              content: defaultFiles['script.js']\n            }]\n          };\n          return {\n            files: defaultFiles,\n            tree: defaultTree\n          };\n        }\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const {\n        files,\n        tree\n      } = await response.json();\n\n      // Ensure required files exist\n      const requiredFiles = ['index.html', 'style.css', 'script.js'];\n      const completeFiles = {\n        ...files\n      };\n      requiredFiles.forEach(file => {\n        if (!completeFiles[file]) {\n          completeFiles[file] = file.endsWith('.html') ? '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>' : file.endsWith('.css') ? '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}' : '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");';\n\n          // Add missing file to tree if it doesn't exist\n          if (!tree.children.some(child => child.name === file)) {\n            tree.children.push({\n              name: file,\n              type: 'file',\n              path: file,\n              content: completeFiles[file]\n            });\n          }\n        }\n      });\n      return {\n        files: completeFiles,\n        tree: tree\n      };\n    } catch (error) {\n      console.error('Error loading files:', error);\n\n      // Fallback to default structure\n      const defaultFiles = {\n        'index.html': '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>',\n        'style.css': '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}',\n        'script.js': '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");'\n      };\n      const defaultTree = {\n        name: 'root',\n        type: 'folder',\n        path: '',\n        children: [{\n          name: 'index.html',\n          type: 'file',\n          path: 'index.html',\n          content: defaultFiles['index.html']\n        }, {\n          name: 'style.css',\n          type: 'file',\n          path: 'style.css',\n          content: defaultFiles['style.css']\n        }, {\n          name: 'script.js',\n          type: 'file',\n          path: 'script.js',\n          content: defaultFiles['script.js']\n        }]\n      };\n      return {\n        files: defaultFiles,\n        tree: defaultTree\n      };\n    }\n  }, [roomId, debouncedSave]);\n\n  // Initialize socket connection\n  const initializeSocket = useCallback(filesData => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n    }\n    const socket = io('http://localhost:5000', {\n      transports: ['websocket'],\n      upgrade: false,\n      reconnectionAttempts: 5,\n      reconnectionDelay: 1000,\n      timeout: 10000\n    });\n    socket.on('room-error', msg => {\n      alert(msg); // Show the error message\n      navigate('/room'); // Redirect user back to RoomPage\n    });\n    socket.on('connect', () => {\n      console.log('ðŸŸ¢ Connected to server');\n      setConnectionStatus('Connected');\n      currentUserRef.current = socket.id;\n      socket.emit('join-room', {\n        roomId,\n        username,\n        files: filesData\n      });\n    });\n    socket.on('disconnect', () => {\n      console.log('ðŸ”´ Disconnected from server');\n      setConnectionStatus('Disconnected');\n    });\n    socket.on('reconnect', () => {\n      console.log('ðŸŸ¡ Reconnected to server');\n      setConnectionStatus('Connected');\n      socket.emit('join-room', {\n        roomId,\n        username,\n        files: files\n      });\n    });\n    socket.on('room-state', ({\n      files: roomFiles,\n      users: roomUsers\n    }) => {\n      console.log('ðŸ“‹ Received room state:', {\n        files: Object.keys(roomFiles),\n        users: roomUsers.length\n      });\n      setFiles(roomFiles);\n      setUsers(roomUsers);\n    });\n    socket.on('code-update', ({\n      filePath,\n      code,\n      sender,\n      position,\n      username: senderUsername\n    }) => {\n      if (sender !== currentUserRef.current) {\n        console.log('ðŸ“ Code update from', senderUsername, 'for', filePath);\n        isUpdatingFromSocket.current = true;\n        // Update both files state and file tree state in a single batch\n\n        setFiles(prevFiles => {\n          const newFiles = {\n            ...prevFiles,\n            [filePath]: code\n          };\n\n          // Update editor content if it's the active file\n          if (filePath === activeFile && editorRef.current) {\n            var _editorRef$current$mo;\n            const model = (_editorRef$current$mo = editorRef.current.models) === null || _editorRef$current$mo === void 0 ? void 0 : _editorRef$current$mo[filePath];\n            if (model && model.getValue() !== code) {\n              // Save current cursor position\n              const currentSelection = editorRef.current.getSelection();\n              const scrollInfo = editorRef.current.getScrollTop();\n\n              // Update content\n              model.setValue(code);\n\n              // Restore cursor position if it was the current user's cursor\n              if (currentSelection && !position) {\n                editorRef.current.setSelection(currentSelection);\n                editorRef.current.setScrollTop(scrollInfo);\n              }\n            }\n          }\n          return newFiles;\n        });\n\n        // Update the file tree structure\n        setFileTree(prevTree => {\n          if (!prevTree) return prevTree;\n\n          // Create a deep clone of the tree\n          const newTree = JSON.parse(JSON.stringify(prevTree));\n\n          // Function to find and update the file in the tree\n          const updateFileContent = nodes => {\n            for (let node of nodes) {\n              if (node.path === filePath && node.type === 'file') {\n                node.content = code;\n                return true;\n              }\n              if (node.children && updateFileContent(node.children)) {\n                return true;\n              }\n            }\n            return false;\n          };\n          updateFileContent(newTree.children);\n          return newTree;\n        });\n\n        // Update user cursor position\n        if (position) {\n          setUserCursors(prev => ({\n            ...prev,\n            [sender]: {\n              ...prev[sender],\n              position,\n              activeFile: filePath,\n              username: senderUsername\n            }\n          }));\n        }\n\n        // Show typing indicator\n        if (filePath === activeFile) {\n          setTypingUsers(prev => ({\n            ...prev,\n            [sender]: {\n              username: senderUsername,\n              timestamp: Date.now()\n            }\n          }));\n        }\n        setTimeout(() => {\n          isUpdatingFromSocket.current = false;\n        }, 100);\n      }\n    });\n    socket.on('file-deleted', ({\n      path\n    }) => {\n      setFiles(prev => {\n        const newFiles = {\n          ...prev\n        };\n        delete newFiles[path];\n        return newFiles;\n      });\n      setFileTree(prevTree => {\n        if (!prevTree) return prevTree;\n        const newTree = JSON.parse(JSON.stringify(prevTree));\n        const removeNode = nodes => {\n          for (let i = 0; i < nodes.length; i++) {\n            if (nodes[i].path === path) {\n              nodes.splice(i, 1);\n              return true;\n            }\n            if (nodes[i].children && removeNode(nodes[i].children)) {\n              return true;\n            }\n          }\n          return false;\n        };\n        removeNode(newTree.children);\n        return newTree;\n      });\n    });\n    socket.on('file-renamed', ({\n      oldPath,\n      newPath\n    }) => {\n      setFiles(prev => {\n        const newFiles = {\n          ...prev\n        };\n        if (newFiles[oldPath]) {\n          newFiles[newPath] = newFiles[oldPath];\n          delete newFiles[oldPath];\n        }\n        return newFiles;\n      });\n      setFileTree(prevTree => {\n        if (!prevTree) return prevTree;\n        const newTree = JSON.parse(JSON.stringify(prevTree));\n        const updateNode = nodes => {\n          for (let node of nodes) {\n            if (node.path === oldPath) {\n              const newName = newPath.split('/').pop();\n              node.name = newName;\n              node.path = newPath;\n              return true;\n            }\n            if (node.children && updateNode(node.children)) {\n              return true;\n            }\n          }\n          return false;\n        };\n        updateNode(newTree.children);\n        return newTree;\n      });\n      if (activeFile === oldPath) {\n        setActiveFile(newPath);\n      }\n    });\n    socket.on('folder-renamed', ({\n      oldPath,\n      newPath\n    }) => {\n      // Update files\n      setFiles(prev => {\n        const updated = {};\n        for (const key in prev) {\n          if (key.startsWith(oldPath)) {\n            const newKey = key.replace(oldPath, newPath);\n            updated[newKey] = prev[key];\n          } else {\n            updated[key] = prev[key];\n          }\n        }\n        return updated;\n      });\n\n      // Update file tree\n      setFileTree(prevTree => {\n        if (!prevTree) return prevTree;\n        const newTree = JSON.parse(JSON.stringify(prevTree));\n        const updatePaths = nodes => {\n          nodes.forEach(node => {\n            if (node.path.startsWith(oldPath)) {\n              node.path = node.path.replace(oldPath, newPath);\n              if (node.type === 'folder') {\n                node.name = newPath.replace(/\\/$/, '').split('/').pop();\n              }\n            }\n            if (node.children) updatePaths(node.children);\n          });\n        };\n        updatePaths(newTree.children);\n        return newTree;\n      });\n    });\n    socket.on('folder-deleted', ({\n      path\n    }) => {\n      setFiles(prev => {\n        const updated = {};\n        for (const key in prev) {\n          if (!key.startsWith(path)) {\n            updated[key] = prev[key];\n          }\n        }\n        return updated;\n      });\n      setFileTree(prevTree => {\n        if (!prevTree) return prevTree;\n        const newTree = JSON.parse(JSON.stringify(prevTree));\n        const removeFolder = nodes => {\n          for (let i = 0; i < nodes.length; i++) {\n            if (nodes[i].path === path) {\n              nodes.splice(i, 1);\n              return true;\n            }\n            if (nodes[i].children && removeFolder(nodes[i].children)) {\n              return true;\n            }\n          }\n          return false;\n        };\n        removeFolder(newTree.children);\n        return newTree;\n      });\n    });\n    socket.on('user-joined', ({\n      userId,\n      username: newUsername\n    }) => {\n      console.log('ðŸ‘¤ User joined:', newUsername);\n      setUsers(prev => {\n        const exists = prev.find(u => u.id === userId);\n        if (!exists) {\n          return [...prev, {\n            id: userId,\n            username: newUsername\n          }];\n        }\n        return prev;\n      });\n    });\n    socket.on('user-left', ({\n      userId,\n      username: leftUsername\n    }) => {\n      console.log('ðŸ‘¤ User left:', leftUsername);\n      setUsers(prev => prev.filter(u => u.id !== userId));\n      setActiveUsers(prev => {\n        const newActive = {\n          ...prev\n        };\n        delete newActive[userId];\n        return newActive;\n      });\n      setUserCursors(prev => {\n        const newCursors = {\n          ...prev\n        };\n        delete newCursors[userId];\n        return newCursors;\n      });\n      setTypingUsers(prev => {\n        const newTyping = {\n          ...prev\n        };\n        delete newTyping[userId];\n        return newTyping;\n      });\n    });\n    socket.on('cursor-position', ({\n      userId,\n      username: cursorUsername,\n      position,\n      activeFile: userActiveFile\n    }) => {\n      if (userId !== currentUserRef.current && userActiveFile === activeFile) {\n        setUserCursors(prev => ({\n          ...prev,\n          [userId]: {\n            position,\n            activeFile: userActiveFile,\n            username: cursorUsername,\n            timestamp: Date.now()\n          }\n        }));\n      }\n    });\n    socket.on('user-typing', ({\n      userId,\n      username: typingUsername,\n      filePath\n    }) => {\n      if (userId !== currentUserRef.current && filePath === activeFile) {\n        setTypingUsers(prev => ({\n          ...prev,\n          [userId]: {\n            username: typingUsername,\n            timestamp: Date.now()\n          }\n        }));\n      }\n    });\n    // Listen for remote file creation\n    socket.on('remote-file-created', ({\n      filePath,\n      content\n    }) => {\n      setFiles(prev => ({\n        ...prev,\n        [filePath]: content\n      }));\n      setFileTree(prevTree => {\n        if (!prevTree) return prevTree;\n        const newTree = JSON.parse(JSON.stringify(prevTree)); // Deep copy\n        const parts = filePath.split('/');\n        const fileName = parts.pop(); // last item is the file name\n        const folderPathParts = parts;\n        let current = newTree;\n        for (const part of folderPathParts) {\n          let folder = current.children.find(child => child.name === part && child.type === 'folder');\n          if (!folder) {\n            folder = {\n              name: part,\n              type: 'folder',\n              path: (current.path || '') + part + '/',\n              children: []\n            };\n            current.children.push(folder);\n          }\n          current = folder;\n        }\n\n        // Add the new file under the right folder\n        current.children.push({\n          name: fileName,\n          type: 'file',\n          path: filePath,\n          content\n        });\n        return newTree;\n      });\n    });\n\n    // Listen for remote folder creation\n    socket.on('remote-folder-created', ({\n      path\n    }) => {\n      setFileTree(prevTree => {\n        if (!prevTree) return prevTree;\n        const exists = prevTree.children.some(child => child.path === path);\n        if (!exists) {\n          return {\n            ...prevTree,\n            children: [...prevTree.children, {\n              name: path.replace(/\\/$/, '').split('/').pop(),\n              type: 'folder',\n              path,\n              children: []\n            }]\n          };\n        }\n        return prevTree;\n      });\n    });\n    socketRef.current = socket;\n    return socket;\n  }, [username, roomId, activeFile, files, navigate]);\n\n  // Clear old typing indicators\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = Date.now();\n      setTypingUsers(prev => {\n        const updated = {\n          ...prev\n        };\n        Object.keys(updated).forEach(userId => {\n          if (now - updated[userId].timestamp > 3000) {\n            delete updated[userId];\n          }\n        });\n        return updated;\n      });\n    }, 1000);\n    return () => clearInterval(interval);\n  }, []);\n  useEffect(() => {\n    if (!socketRef.current) return;\n    const socket = socketRef.current;\n    socket.on('file-deleted', ({\n      path\n    }) => {\n      setFiles(prev => {\n        const newFiles = {\n          ...prev\n        };\n        delete newFiles[path];\n        return newFiles;\n      });\n      setFileTree(prevTree => {\n        if (!prevTree) return prevTree;\n        const newTree = JSON.parse(JSON.stringify(prevTree));\n        const removeNode = nodes => {\n          for (let i = 0; i < nodes.length; i++) {\n            if (nodes[i].path === path) {\n              nodes.splice(i, 1);\n              return true;\n            }\n            if (nodes[i].children && removeNode(nodes[i].children)) {\n              return true;\n            }\n          }\n          return false;\n        };\n        removeNode(newTree.children);\n        return newTree;\n      });\n    });\n    socket.on('file-renamed', ({\n      oldPath,\n      newPath\n    }) => {\n      setFiles(prev => {\n        const newFiles = {\n          ...prev\n        };\n        if (newFiles[oldPath]) {\n          newFiles[newPath] = newFiles[oldPath];\n          delete newFiles[oldPath];\n        }\n        return newFiles;\n      });\n      setFileTree(prevTree => {\n        if (!prevTree) return prevTree;\n        const newTree = JSON.parse(JSON.stringify(prevTree));\n        const updateNode = nodes => {\n          for (let node of nodes) {\n            if (node.path === oldPath) {\n              const newName = newPath.split('/').pop();\n              node.name = newName;\n              node.path = newPath;\n              return true;\n            }\n            if (node.children && updateNode(node.children)) {\n              return true;\n            }\n          }\n          return false;\n        };\n        updateNode(newTree.children);\n        return newTree;\n      });\n      if (activeFile === oldPath) {\n        setActiveFile(newPath);\n      }\n    });\n    return () => {\n      socket.off('file-deleted');\n      socket.off('file-renamed');\n    };\n  }, [activeFile]);\n  useEffect(() => {\n    if (!socketRef.current) return;\n    const socket = socketRef.current;\n\n    // ðŸ” Folder Renamed\n    socket.on('folder-renamed', ({\n      oldPath,\n      newPath\n    }) => {\n      setFiles(prev => {\n        const updated = {};\n        for (const key in prev) {\n          if (key.startsWith(oldPath)) {\n            const updatedKey = key.replace(oldPath, newPath);\n            updated[updatedKey] = prev[key];\n          } else {\n            updated[key] = prev[key];\n          }\n        }\n        return updated;\n      });\n      setFileTree(prev => {\n        if (!prev) return prev;\n        const tree = JSON.parse(JSON.stringify(prev));\n        const updatePaths = nodes => {\n          nodes.forEach(node => {\n            if (node.path.startsWith(oldPath)) {\n              node.path = node.path.replace(oldPath, newPath);\n              if (node.type === 'folder') {\n                node.name = newPath.replace(/\\/$/, '').split('/').pop();\n              }\n            }\n            if (node.children) updatePaths(node.children);\n          });\n        };\n        updatePaths(tree.children);\n        return tree;\n      });\n    });\n\n    // ðŸ—‘ï¸ Folder Deleted\n    socket.on('folder-deleted', ({\n      path\n    }) => {\n      setFiles(prev => {\n        const updated = {};\n        for (const key in prev) {\n          if (!key.startsWith(path)) {\n            updated[key] = prev[key];\n          }\n        }\n        return updated;\n      });\n      setFileTree(prev => {\n        if (!prev) return prev;\n        const tree = JSON.parse(JSON.stringify(prev));\n        const removeFolder = nodes => {\n          for (let i = 0; i < nodes.length; i++) {\n            if (nodes[i].path === path) {\n              nodes.splice(i, 1);\n              return true;\n            }\n            if (nodes[i].children && removeFolder(nodes[i].children)) {\n              return true;\n            }\n          }\n          return false;\n        };\n        removeFolder(tree.children);\n        return tree;\n      });\n    });\n    return () => {\n      socket.off('folder-renamed');\n      socket.off('folder-deleted');\n    };\n  }, []);\n\n  // Main initialization effect\n  useEffect(() => {\n    if (!roomId) {\n      navigate('/room');\n      return;\n    }\n    if (initializedRef.current) return;\n    initializedRef.current = true;\n    const user = location.state && location.state.username || localStorage.getItem('username') || 'Guest';\n    setUsername(user);\n    const initialize = async () => {\n      try {\n        // 1. Fetch files - now returns { files, tree }\n        const {\n          files: filesData,\n          tree\n        } = await fetchFiles();\n\n        // 2. Set both states\n        setFiles(filesData);\n        setFileTree(tree); // Make sure you have this state: const [fileTree, setFileTree] = useState(null);\n\n        // 3. Initialize socket with the flat files data\n        initializeSocket(filesData);\n\n        // 4. Set username (unchanged)\n        localStorage.setItem('username', user);\n\n        // 5. Set default active file if needed\n        if (!activeFile) {\n          setActiveFile('index.html');\n        }\n      } catch (error) {\n        console.error('Initialization error:', error);\n        setConnectionStatus('Initialization failed');\n      }\n    };\n    initialize();\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.disconnect();\n      }\n    };\n  }, [roomId, navigate, location.state, fetchFiles, initializeSocket, activeFile]);\n\n  // Track cursor position more frequently\n  useEffect(() => {\n    var _socketRef$current;\n    if (!editorRef.current || !((_socketRef$current = socketRef.current) !== null && _socketRef$current !== void 0 && _socketRef$current.connected)) return;\n    const editor = editorRef.current;\n    const handleCursorChange = () => {\n      if (isUpdatingFromSocket.current) return;\n      const selection = editor.getSelection();\n      if (selection) {\n        const position = {\n          lineNumber: selection.positionLineNumber,\n          column: selection.positionColumn\n        };\n        socketRef.current.emit('cursor-position', {\n          roomId,\n          filePath: activeFile,\n          position,\n          username\n        });\n      }\n    };\n    const disposable = editor.onDidChangeCursorPosition(handleCursorChange);\n    return () => disposable.dispose();\n  }, [roomId, activeFile, username]);\n\n  // Handle code changes with real-time sync\n\n  const handleMouseMove = useCallback(e => {\n    if (!isDragging) return;\n    const container = document.querySelector('.main-editor');\n    if (!container) return;\n    const containerRect = container.getBoundingClientRect();\n    const containerWidth = containerRect.width;\n    const mouseX = e.clientX - containerRect.left;\n    const newWidth = mouseX / containerWidth * 100;\n\n    // Limit the width between 20% and 80%\n    setPanelWidth(Math.min(Math.max(newWidth, 30), 70));\n  }, [isDragging]);\n  const handleMouseUp = useCallback(() => {\n    setIsDragging(false);\n    document.body.style.cursor = '';\n    document.removeEventListener('mousemove', handleMouseMove);\n    document.removeEventListener('mouseup', handleMouseUp);\n  }, [handleMouseMove]);\n  // Add this to your cleanup effects\n  useEffect(() => {\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [handleMouseMove, handleMouseUp]);\n  const handleMouseDown = useCallback(e => {\n    e.preventDefault();\n    setIsDragging(true);\n    document.body.style.cursor = 'col-resize';\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n  }, [handleMouseMove, handleMouseUp]);\n  const handleCodeChange = useCallback(value => {\n    if (!value) value = '';\n    if (isUpdatingFromSocket.current) return;\n    const timestamp = Date.now();\n    lastChangeTimestamp.current = timestamp;\n    setFiles(prev => {\n      if (prev[activeFile] !== value) {\n        var _socketRef$current2, _debouncedSaveRef$cur;\n        const newFiles = {\n          ...prev,\n          [activeFile]: value\n        };\n        if ((_socketRef$current2 = socketRef.current) !== null && _socketRef$current2 !== void 0 && _socketRef$current2.connected) {\n          var _editorRef$current;\n          const selection = (_editorRef$current = editorRef.current) === null || _editorRef$current === void 0 ? void 0 : _editorRef$current.getSelection();\n          const position = selection ? {\n            lineNumber: selection.positionLineNumber,\n            column: selection.positionColumn\n          } : null;\n\n          // Emit real-time changes\n          socketRef.current.emit('code-change', {\n            roomId,\n            filePath: activeFile,\n            code: value,\n            position,\n            timestamp,\n            username\n          });\n\n          // Emit typing indicator\n          socketRef.current.emit('user-typing', {\n            roomId,\n            filePath: activeFile,\n            username\n          });\n        }\n\n        // Debounced save to database\n        //debouncedSave(roomId, activeFile, value);\n        (_debouncedSaveRef$cur = debouncedSaveRef.current) === null || _debouncedSaveRef$cur === void 0 ? void 0 : _debouncedSaveRef$cur.call(debouncedSaveRef, roomId, activeFile, value);\n        return newFiles;\n      }\n      return prev;\n    });\n  }, [activeFile, roomId, debouncedSave, username]);\n  const handleAddFile = () => {\n    setShowNewFileModal(true);\n  };\n  const handleAddFolder = () => {\n    setShowNewFolderModal(true);\n  };\n  const createNewFile = async () => {\n    if (!newFileName) return;\n    const fileExt = newFileName.split('.').pop();\n    let defaultContent = '';\n    if (fileExt === 'html') {\n      defaultContent = '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>New File</title>\\n</head>\\n<body>\\n    \\n</body>\\n</html>';\n    } else if (fileExt === 'css') {\n      defaultContent = '/* Your CSS here */';\n    } else if (fileExt === 'js') {\n      defaultContent = '// Your JavaScript here';\n    }\n    try {\n      var _socketRef$current3, _socketRef$current4;\n      // Save to backend first\n      await fetch('http://localhost:5000/api/code/save', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          roomId,\n          filePath: newFileName,\n          content: defaultContent\n        })\n      });\n\n      // Then update local state\n      setFiles(prev => ({\n        ...prev,\n        [newFileName]: defaultContent\n      }));\n      setFileTree(prevTree => {\n        if (!prevTree) return prevTree;\n\n        // Check if file already exists in tree\n        const exists = prevTree.children.some(child => child.path === newFileName);\n        if (!exists) {\n          return {\n            ...prevTree,\n            children: [...prevTree.children, {\n              name: newFileName,\n              type: 'file',\n              path: newFileName,\n              content: defaultContent\n            }]\n          };\n        }\n        return prevTree;\n      });\n      if ((_socketRef$current3 = socketRef.current) !== null && _socketRef$current3 !== void 0 && _socketRef$current3.connected) {\n        socketRef.current.emit('new-file-created', {\n          roomId,\n          filePath: newFileName,\n          content: defaultContent,\n          username\n        });\n      }\n      setActiveFile(newFileName);\n      setShowNewFileModal(false);\n      setNewFileName('');\n\n      // Notify other users\n      if ((_socketRef$current4 = socketRef.current) !== null && _socketRef$current4 !== void 0 && _socketRef$current4.connected) {\n        socketRef.current.emit('code-change', {\n          roomId,\n          filePath: newFileName,\n          code: defaultContent,\n          username\n        });\n      }\n    } catch (error) {\n      console.error('Error creating file:', error);\n    }\n  };\n  const createFileAtPath = async path => {\n    var _socketRef$current5;\n    const fileExt = path.split('.').pop();\n    let defaultContent = '';\n    if (fileExt === 'html') defaultContent = '<!DOCTYPE html>\\n<html>\\n<head>\\n<title></title>\\n</head>\\n<body>\\n</body>\\n</html>';\n    if (fileExt === 'css') defaultContent = '/* CSS here */';\n    if (fileExt === 'js') defaultContent = '// JS here';\n    await fetch('http://localhost:5000/api/code/save', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        roomId,\n        filePath: path,\n        content: defaultContent\n      })\n    });\n    setFiles(prev => ({\n      ...prev,\n      [path]: defaultContent\n    }));\n    setFileTree(prevTree => {\n      if (!prevTree) return prevTree;\n      const newNode = {\n        name: path.split('/').pop(),\n        type: 'file',\n        path,\n        content: defaultContent\n      };\n\n      // Recursively insert file under the correct folder\n      const insertFile = (tree, folderPath) => {\n        if (tree.path === folderPath) {\n          tree.children.push(newNode);\n          return true;\n        }\n        for (const child of tree.children) {\n          if (child.type === 'folder' && insertFile(child, folderPath)) return true;\n        }\n        return false;\n      };\n      const updatedTree = JSON.parse(JSON.stringify(prevTree));\n      insertFile(updatedTree, path.substring(0, path.lastIndexOf('/') + 1));\n      return updatedTree;\n    });\n    if ((_socketRef$current5 = socketRef.current) !== null && _socketRef$current5 !== void 0 && _socketRef$current5.connected) {\n      socketRef.current.emit('new-file-created', {\n        roomId,\n        filePath: path,\n        content: defaultContent,\n        username\n      });\n    }\n  };\n  const createNewFolder = async () => {\n    if (!newFolderName) return;\n    try {\n      var _socketRef$current6;\n      // Ensure folder path ends with /\n      const folderPath = newFolderName.endsWith('/') ? newFolderName : `${newFolderName}/`;\n\n      // Save to backend\n      await fetch('http://localhost:5000/api/code/createFolder', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          roomId,\n          path: folderPath\n        })\n      });\n\n      // Update local state\n      setFileTree(prevTree => {\n        if (!prevTree) return prevTree;\n\n        // Check if folder already exists\n        const exists = prevTree.children.some(child => child.path === folderPath);\n        if (!exists) {\n          return {\n            ...prevTree,\n            children: [...prevTree.children, {\n              name: newFolderName,\n              type: 'folder',\n              path: folderPath,\n              children: []\n            }]\n          };\n        }\n        return prevTree;\n      });\n      setShowNewFolderModal(false);\n      setNewFolderName('');\n      if ((_socketRef$current6 = socketRef.current) !== null && _socketRef$current6 !== void 0 && _socketRef$current6.connected) {\n        socketRef.current.emit('new-folder-created', {\n          roomId,\n          path: folderPath,\n          username\n        });\n      }\n    } catch (error) {\n      console.error('Error creating folder:', error);\n    }\n  };\n  // Handle running the code\n  const handleRun = () => {\n    if (!files || !iframeRef.current) return;\n    const html = files['index.html'] || '';\n    const css = files['style.css'] || '';\n    const js = files['script.js'] || '';\n    const combined = `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <style>${css}</style>\n        </head>\n        <body>\n          ${html}\n          <script>\n            // Error handling for iframe\n            window.onerror = function(msg, url, line, col, error) {\n              console.error('Error:', msg, 'at', line + ':' + col);\n              return false;\n            };\n            ${js}\n          </script>\n        </body>\n      </html>\n    `;\n    const blob = new Blob([combined], {\n      type: 'text/html'\n    });\n    const url = URL.createObjectURL(blob);\n    iframeRef.current.src = url;\n    setTimeout(() => URL.revokeObjectURL(url), 1000);\n  };\n\n  // Handle file switching\n  // const handleFileSwitch = (fileName) => {\n  //   setActiveFile(fileName);\n  //    if (editorRef.current?.models?.[fileName]) {\n  //   editorRef.current.setModel(editorRef.current.models[fileName]);\n  // }\n  //   if (socketRef.current?.connected) {\n  //     socketRef.current.emit('file-switch', {\n  //       roomId,\n  //       filePath: fileName,\n  //       username\n  //     });\n  //   }\n  // };\n  const handleEditorMount = (editor, monaco) => {\n    editorRef.current = editor;\n\n    // Initialize models object if not present\n    if (!editorRef.current.models) {\n      editorRef.current.models = {};\n    }\n\n    // Create or reuse a separate model for each file\n    Object.entries(files).forEach(([filePath, content]) => {\n      if (!editorRef.current.models[filePath]) {\n        const lang = getLanguage(filePath);\n        editorRef.current.models[filePath] = monaco.editor.createModel(content, lang);\n      }\n    });\n\n    // Set current active model\n    const activeModel = editorRef.current.models[activeFile];\n    if (activeModel) {\n      editor.setModel(activeModel);\n    }\n\n    // Cursor tracking\n    editor.onDidChangeCursorPosition(() => {\n      var _socketRef$current7;\n      if ((_socketRef$current7 = socketRef.current) !== null && _socketRef$current7 !== void 0 && _socketRef$current7.connected && !isUpdatingFromSocket.current) {\n        const selection = editor.getSelection();\n        if (selection) {\n          const position = {\n            lineNumber: selection.positionLineNumber,\n            column: selection.positionColumn\n          };\n          socketRef.current.emit('cursor-position', {\n            roomId,\n            filePath: activeFile,\n            position,\n            username\n          });\n        }\n      }\n    });\n  };\n  const handleFileSwitch = fileName => {\n    var _editorRef$current2, _editorRef$current2$m;\n    setActiveFile(fileName);\n    const model = (_editorRef$current2 = editorRef.current) === null || _editorRef$current2 === void 0 ? void 0 : (_editorRef$current2$m = _editorRef$current2.models) === null || _editorRef$current2$m === void 0 ? void 0 : _editorRef$current2$m[fileName];\n    if (model) {\n      editorRef.current.setModel(model); // âœ… this is correct\n    }\n  };\n\n  // Cleanup on page unload\n  useBeforeUnload(() => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n    }\n  });\n  const getLanguage = file => {\n    if (file.endsWith('.js')) return 'javascript';\n    if (file.endsWith('.html')) return 'html';\n    if (file.endsWith('.css')) return 'css';\n    return 'plaintext';\n  };\n  if (!files || !fileTree) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-wrapper\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-screen\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"loading-spinner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1230,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"Loading collaborative editor...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1231,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"connection-status\",\n          children: connectionStatus\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1232,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1229,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1228,\n      columnNumber: 7\n    }, this);\n  }\n  const typingUsersList = Object.values(typingUsers);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"editor-wrapper\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"collaboration-bar\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"room-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Room:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1244,\n          columnNumber: 11\n        }, this), \" \", roomId, \" | \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"User:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1244,\n          columnNumber: 45\n        }, this), \" \", username, /*#__PURE__*/_jsxDEV(\"span\", {\n          className: `connection-status ${connectionStatus === 'Connected' ? 'connected' : 'disconnected'}`,\n          children: [\"\\u25CF \", connectionStatus]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1245,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1243,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"online-users\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"users-label\",\n          children: [\"Online (\", users.length, \"):\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1251,\n          columnNumber: 11\n        }, this), users.map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"user-badge\",\n          style: {\n            backgroundColor: getUserColor(user.id)\n          },\n          children: [user.username, user.id === currentUserRef.current && ' (You)']\n        }, user.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1253,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1250,\n        columnNumber: 9\n      }, this), typingUsersList.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"typing-indicator\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"typing-dots\",\n          children: \"\\u25CF\\u25CF\\u25CF\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1266,\n          columnNumber: 13\n        }, this), typingUsersList.map(t => t.username).join(', '), typingUsersList.length === 1 ? ' is' : ' are', \" typing in \", activeFile, \"...\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1265,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1242,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-container\",\n      style: {\n        flexDirection: 'row'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sidebar\",\n        children: /*#__PURE__*/_jsxDEV(FileSidebar, {\n          tree: fileTree,\n          activeFile: activeFile,\n          setActiveFile: handleFileSwitch,\n          onAddFile: handleAddFile,\n          onAddFolder: handleAddFolder,\n          onAddFileToFolder: createFileAtPath,\n          roomId: roomId,\n          setFiles: setFiles // Pass down the setter\n          ,\n          setFileTree: setFileTree // Pass down the setter\n          ,\n          socketRef: socketRef // Pass down the ref\n          ,\n          username: username\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1275,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1274,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main-editor noselect\",\n        style: {\n          display: 'flex',\n          flexDirection: 'row',\n          flex: 1\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: `${panelWidth}%`,\n            display: 'flex',\n            flexDirection: 'column',\n            minWidth: '300px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"editor-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"file-info\",\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: activeFile\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1295,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"file-language\",\n                children: [\"(\", getLanguage(activeFile), \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1296,\n                columnNumber: 15\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1294,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"run-button\",\n              onClick: handleRun,\n              children: \"\\u25B6 Run\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1298,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"download-button\",\n              onClick: downloadProjectAsZip,\n              children: \"\\u2B07 Download ZIP\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1301,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1293,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"editor-container-with-cursors\",\n            children: [/*#__PURE__*/_jsxDEV(Editor, {\n              height: \"50vh\",\n              language: getLanguage(activeFile),\n              value: files[activeFile] || \"\",\n              onChange: handleCodeChange,\n              onMount: handleEditorMount //(editor,monaco) => {\n              //                 editorRef.current = editor;\n              //                  if (!editorRef.current.models) {\n              //     editorRef.current.models = {};\n              //   }\n\n              //   Object.entries(files).forEach(([filePath, content]) => {\n              //     if (!editorRef.current.models[filePath]) {\n              //       const language = getLanguage(filePath);\n              //       editorRef.current.models[filePath] = monaco.editor.createModel(content, language);\n              //     } \n              //   });\n\n              //   editor.setModel(editorRef.current.models[activeFile]);\n\n              //   // Save the models for reuse\n              // //  editorRef.current.models = models;\n              //                 // Add cursor tracking\n              //                 editor.onDidChangeCursorPosition(() => {\n              //                   if (socketRef.current?.connected && !isUpdatingFromSocket.current) {\n              //                     const selection = editor.getSelection();\n              //                     if (selection) {\n              //                       const position = {\n              //                         lineNumber: selection.positionLineNumber,\n              //                         column: selection.positionColumn\n              //                       };\n\n              //                       socketRef.current.emit('cursor-position', {\n              //                         roomId,\n              //                         filePath: activeFile,\n              //                         position,\n              //                         username\n              //                       });\n              //                     }\n              //                   }\n              //                 });\n              //               }}\n              ,\n\n              theme: \"vs-dark\",\n              options: {\n                minimap: {\n                  enabled: false\n                },\n                fontSize: 14,\n                wordWrap: 'on',\n                automaticLayout: true,\n                scrollBeyondLastLine: false,\n                renderWhitespace: 'selection',\n                smoothScrolling: true,\n                cursorBlinking: 'smooth',\n                cursorSmoothCaretAnimation: true\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1307,\n              columnNumber: 13\n            }, this), Object.entries(userCursors).map(([userId, cursor]) => {\n              var _cursor$position, _cursor$position2;\n              return cursor.activeFile === activeFile && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"user-cursor\",\n                style: {\n                  position: 'absolute',\n                  top: `${(((_cursor$position = cursor.position) === null || _cursor$position === void 0 ? void 0 : _cursor$position.lineNumber) || 0) * 18}px`,\n                  left: `${(((_cursor$position2 = cursor.position) === null || _cursor$position2 === void 0 ? void 0 : _cursor$position2.column) || 0) * 8}px`,\n                  borderLeft: `2px solid ${getUserColor(userId)}`,\n                  height: '18px',\n                  pointerEvents: 'none',\n                  zIndex: 1000\n                },\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"user-cursor-label\",\n                  style: {\n                    backgroundColor: getUserColor(userId),\n                    color: 'white',\n                    padding: '2px 6px',\n                    borderRadius: '3px',\n                    fontSize: '11px',\n                    position: 'absolute',\n                    top: '-20px',\n                    left: '0',\n                    whiteSpace: 'nowrap'\n                  },\n                  children: cursor.username\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1381,\n                  columnNumber: 19\n                }, this)\n              }, userId, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1368,\n                columnNumber: 17\n              }, this);\n            })]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1306,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1292,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"resize-handle\",\n          onMouseDown: handleMouseDown,\n          style: {\n            width: '5px',\n            cursor: 'col-resize',\n            backgroundColor: isDragging ? '#007acc' : '#3e3e42',\n            transition: 'background-color 0.2s ease'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1402,\n          columnNumber: 1\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"output-panel\",\n          style: {\n            width: `${100 - panelWidth}%`,\n            minWidth: '300px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"output-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Output Preview\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1414,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"refresh-output\",\n              onClick: handleRun,\n              children: \"\\uD83D\\uDD04 Refresh\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1415,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1413,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"iframe\", {\n            ref: iframeRef,\n            title: \"Live Code Output\",\n            className: \"output-frame\",\n            style: {\n              flex: 1,\n              border: 'none',\n              background: 'white',\n              width: '100%',\n              height: '100%'\n            },\n            sandbox: \"allow-scripts allow-same-origin allow-forms\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1419,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1412,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1290,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1273,\n      columnNumber: 7\n    }, this), showNewFileModal && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-overlay\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Create New File\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1432,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"filename.html/.css/.js\",\n          value: newFileName,\n          onChange: e => setNewFileName(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1433,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-actions\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setShowNewFileModal(false),\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1440,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: createNewFile,\n            children: \"Create\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1441,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1439,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1431,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1430,\n      columnNumber: 9\n    }, this), showNewFolderModal && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-overlay\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Create New Folder\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1450,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Folder name\",\n          value: newFolderName,\n          onChange: e => setNewFolderName(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1451,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-actions\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setShowNewFolderModal(false),\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1458,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: createNewFolder,\n            children: \"Create\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1459,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1457,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1449,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1448,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1241,\n    columnNumber: 5\n  }, this);\n}\n_s(EditorPage, \"mvKvWGOSiTAPNOBjK5+gTZtmnpM=\", false, function () {\n  return [useParams, useLocation, useNavigate, useBeforeUnload];\n});\n_c = EditorPage;\nfunction debounce(func, wait) {\n  let timeout;\n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\nexport default EditorPage;\nvar _c;\n$RefreshReg$(_c, \"EditorPage\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useLocation","useParams","useNavigate","useBeforeUnload","Editor","io","FileSidebar","downloadProjectAsZip","jsxDEV","_jsxDEV","EditorPage","_s","roomId","location","navigate","socketRef","initializedRef","currentUserRef","editorRef","iframeRef","isUpdatingFromSocket","lastChangeTimestamp","username","setUsername","files","setFiles","activeFile","setActiveFile","connectionStatus","setConnectionStatus","users","setUsers","activeUsers","setActiveUsers","typingUsers","setTypingUsers","userCursors","setUserCursors","showNewFileModal","setShowNewFileModal","showNewFolderModal","setShowNewFolderModal","newFileName","setNewFileName","newFolderName","setNewFolderName","fileTree","setFileTree","panelWidth","setPanelWidth","isDragging","setIsDragging","userColors","getUserColor","userId","index","Object","keys","indexOf","length","debouncedSaveRef","debouncedSave","debounce","filename","content","fetch","method","headers","body","JSON","stringify","err","console","error","fetchFiles","response","ok","status","defaultFiles","Promise","all","entries","map","defaultTree","name","type","path","children","tree","Error","json","requiredFiles","completeFiles","forEach","file","endsWith","some","child","push","initializeSocket","filesData","current","disconnect","socket","transports","upgrade","reconnectionAttempts","reconnectionDelay","timeout","on","msg","alert","log","id","emit","roomFiles","roomUsers","filePath","code","sender","position","senderUsername","prevFiles","newFiles","_editorRef$current$mo","model","models","getValue","currentSelection","getSelection","scrollInfo","getScrollTop","setValue","setSelection","setScrollTop","prevTree","newTree","parse","updateFileContent","nodes","node","prev","timestamp","Date","now","setTimeout","removeNode","i","splice","oldPath","newPath","updateNode","newName","split","pop","updated","key","startsWith","newKey","replace","updatePaths","removeFolder","newUsername","exists","find","u","leftUsername","filter","newActive","newCursors","newTyping","cursorUsername","userActiveFile","typingUsername","parts","fileName","folderPathParts","part","folder","interval","setInterval","clearInterval","off","updatedKey","user","state","localStorage","getItem","initialize","setItem","_socketRef$current","connected","editor","handleCursorChange","selection","lineNumber","positionLineNumber","column","positionColumn","disposable","onDidChangeCursorPosition","dispose","handleMouseMove","e","container","document","querySelector","containerRect","getBoundingClientRect","containerWidth","width","mouseX","clientX","left","newWidth","Math","min","max","handleMouseUp","style","cursor","removeEventListener","handleMouseDown","preventDefault","addEventListener","handleCodeChange","value","_socketRef$current2","_debouncedSaveRef$cur","_editorRef$current","call","handleAddFile","handleAddFolder","createNewFile","fileExt","defaultContent","_socketRef$current3","_socketRef$current4","createFileAtPath","_socketRef$current5","newNode","insertFile","folderPath","updatedTree","substring","lastIndexOf","createNewFolder","_socketRef$current6","handleRun","html","css","js","combined","blob","Blob","url","URL","createObjectURL","src","revokeObjectURL","handleEditorMount","monaco","lang","getLanguage","createModel","activeModel","setModel","_socketRef$current7","handleFileSwitch","_editorRef$current2","_editorRef$current2$m","className","_jsxFileName","columnNumber","typingUsersList","values","backgroundColor","t","join","flexDirection","onAddFile","onAddFolder","onAddFileToFolder","display","flex","minWidth","onClick","height","language","onChange","onMount","theme","options","minimap","enabled","fontSize","wordWrap","automaticLayout","scrollBeyondLastLine","renderWhitespace","smoothScrolling","cursorBlinking","cursorSmoothCaretAnimation","_cursor$position","_cursor$position2","top","borderLeft","pointerEvents","zIndex","color","padding","borderRadius","whiteSpace","onMouseDown","transition","ref","title","border","background","sandbox","placeholder","target","_c","func","wait","executedFunction","args","later","clearTimeout","$RefreshReg$"],"sources":["D:/realtime-code-editor/client/src/pages/EditorPage.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useLocation, useParams, useNavigate, useBeforeUnload } from 'react-router-dom';\r\nimport Editor from '@monaco-editor/react';\r\nimport { io } from 'socket.io-client';\r\nimport FileSidebar from '../components/FileSidebar';\r\nimport '../styles/editor.css';\r\nimport { downloadProjectAsZip } from '../utils/downloadZip';\r\n\r\nfunction EditorPage() {\r\n  const { roomId } = useParams();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const socketRef = useRef(null);\r\n  const initializedRef = useRef(false);\r\n  const currentUserRef = useRef(null);\r\n  const editorRef = useRef(null);\r\n  const iframeRef = useRef(null);\r\n  const isUpdatingFromSocket = useRef(false);\r\n  const lastChangeTimestamp = useRef(0);\r\n\r\n  const [username, setUsername] = useState('');\r\n  const [files, setFiles] = useState(null);\r\n  const [activeFile, setActiveFile] = useState('index.html');\r\n  const [connectionStatus, setConnectionStatus] = useState('Connecting...');\r\n  const [users, setUsers] = useState([]);\r\n  const [activeUsers, setActiveUsers] = useState({});\r\n  const [typingUsers, setTypingUsers] = useState({});\r\n  const [userCursors, setUserCursors] = useState({});\r\nconst [showNewFileModal, setShowNewFileModal] = useState(false);\r\nconst [showNewFolderModal, setShowNewFolderModal] = useState(false);\r\nconst [newFileName, setNewFileName] = useState('');\r\nconst [newFolderName, setNewFolderName] = useState('');\r\n// Add to your existing state\r\nconst [fileTree, setFileTree] = useState(null);\r\n \r\n  const [panelWidth, setPanelWidth] = useState(65); \r\nconst [isDragging, setIsDragging] = useState(false);\r\n\r\n // Colors for different users\r\n  const userColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];\r\n  const getUserColor = (userId) => {\r\n    const index = Object.keys(activeUsers).indexOf(userId);\r\n    return userColors[index % userColors.length];\r\n  };\r\n\r\n  // Debounced save function\r\n  const debouncedSaveRef = useRef();\r\n  const debouncedSave = useCallback(\r\n    debounce(async (roomId, filename, content) => {\r\n      try {\r\n        await fetch('http://localhost:5000/api/code/save', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ roomId, filename, content }),\r\n        });\r\n      } catch (err) {\r\n        console.error('Error saving file:', err);\r\n      }\r\n    }, 2000),\r\n    [roomId]);\r\n// const loadFiles = async () => {\r\n//   const { files, tree } = await fetchFiles();\r\n//   setFiles(files);\r\n//   setFileTree(tree);\r\n//   setActiveFile('index.html');\r\n// };\r\n  // Fetch files from backend\r\n  const fetchFiles = useCallback(async () => {\r\n  if (!roomId) return;\r\n\r\n  try {\r\n    const response = await fetch(`http://localhost:5000/api/code/${roomId}`);\r\n    \r\n    if (!response.ok) {\r\n      if (response.status === 404) {\r\n        // Create default files structure\r\n        const defaultFiles = {\r\n          'index.html': '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>',\r\n          'style.css': '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}',\r\n          'script.js': '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");'\r\n        };\r\n\r\n        // Save default files to database\r\n        await Promise.all(\r\n          Object.entries(defaultFiles).map(([filename, content]) =>\r\n            debouncedSave(roomId, filename, content)\r\n        ));\r\n\r\n        // Create default tree structure\r\n        const defaultTree = {\r\n          name: 'root',\r\n          type: 'folder',\r\n          path: '',\r\n          children: [\r\n            {\r\n              name: 'index.html',\r\n              type: 'file',\r\n              path: 'index.html',\r\n              content: defaultFiles['index.html']\r\n            },\r\n            {\r\n              name: 'style.css',\r\n              type: 'file',\r\n              path: 'style.css',\r\n              content: defaultFiles['style.css']\r\n            },\r\n            {\r\n              name: 'script.js',\r\n              type: 'file',\r\n              path: 'script.js',\r\n              content: defaultFiles['script.js']\r\n            }\r\n          ]\r\n        };\r\n\r\n        return {\r\n          files: defaultFiles,\r\n          tree: defaultTree\r\n        };\r\n      }\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n    \r\n    const { files, tree } = await response.json();\r\n    \r\n    // Ensure required files exist\r\n    const requiredFiles = ['index.html', 'style.css', 'script.js'];\r\n    const completeFiles = { ...files };\r\n    \r\n    requiredFiles.forEach(file => {\r\n      if (!completeFiles[file]) {\r\n        completeFiles[file] = file.endsWith('.html') ? \r\n          '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>' :\r\n          file.endsWith('.css') ? \r\n          '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}' :\r\n          '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");';\r\n        \r\n        // Add missing file to tree if it doesn't exist\r\n        if (!tree.children.some(child => child.name === file)) {\r\n          tree.children.push({\r\n            name: file,\r\n            type: 'file',\r\n            path: file,\r\n            content: completeFiles[file]\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    return {\r\n      files: completeFiles,\r\n      tree: tree\r\n    };\r\n  } catch (error) {\r\n    console.error('Error loading files:', error);\r\n    \r\n    // Fallback to default structure\r\n    const defaultFiles = {\r\n      'index.html': '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>',\r\n      'style.css': '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}',\r\n      'script.js': '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");'\r\n    };\r\n\r\n    const defaultTree = {\r\n      name: 'root',\r\n      type: 'folder',\r\n      path: '',\r\n      children: [\r\n        {\r\n          name: 'index.html',\r\n          type: 'file',\r\n          path: 'index.html',\r\n          content: defaultFiles['index.html']\r\n        },\r\n        {\r\n          name: 'style.css',\r\n          type: 'file',\r\n          path: 'style.css',\r\n          content: defaultFiles['style.css']\r\n        },\r\n        {\r\n          name: 'script.js',\r\n          type: 'file',\r\n          path: 'script.js',\r\n          content: defaultFiles['script.js']\r\n        }\r\n      ]\r\n    };\r\n\r\n    return {\r\n      files: defaultFiles,\r\n      tree: defaultTree\r\n    };\r\n  }\r\n}, [roomId, debouncedSave]);\r\n\r\n  // Initialize socket connection\r\n  const initializeSocket = useCallback((filesData) => {\r\n    if (socketRef.current) {\r\n      socketRef.current.disconnect();\r\n    }\r\n\r\n    const socket = io('http://localhost:5000', {\r\n      transports: ['websocket'],\r\n      upgrade: false,\r\n      reconnectionAttempts: 5,\r\n      reconnectionDelay: 1000,\r\n      timeout: 10000,\r\n    });\r\nsocket.on('room-error', (msg) => {\r\n  alert(msg);           // Show the error message\r\n  navigate('/room');    // Redirect user back to RoomPage\r\n});\r\n\r\n    socket.on('connect', () => {\r\n      console.log('ðŸŸ¢ Connected to server');\r\n      setConnectionStatus('Connected');\r\n      currentUserRef.current = socket.id;\r\n      socket.emit('join-room', { \r\n        roomId, \r\n        username,\r\n        files: filesData \r\n      });\r\n    });\r\n\r\n    socket.on('disconnect', () => {\r\n      console.log('ðŸ”´ Disconnected from server');\r\n      setConnectionStatus('Disconnected');\r\n    });\r\n\r\n    socket.on('reconnect', () => {\r\n      console.log('ðŸŸ¡ Reconnected to server');\r\n      setConnectionStatus('Connected');\r\n      socket.emit('join-room', { \r\n        roomId, \r\n        username,\r\n        files: files \r\n      });\r\n    });\r\n\r\n    socket.on('room-state', ({ files: roomFiles, users: roomUsers }) => {\r\n      console.log('ðŸ“‹ Received room state:', { files: Object.keys(roomFiles), users: roomUsers.length });\r\n      setFiles(roomFiles);\r\n      setUsers(roomUsers);\r\n    });\r\n\r\nsocket.on('code-update', ({ filePath, code, sender, position, username: senderUsername }) => {\r\n  if (sender !== currentUserRef.current) {\r\n    console.log('ðŸ“ Code update from', senderUsername, 'for', filePath);\r\n    \r\n    isUpdatingFromSocket.current = true;\r\n    // Update both files state and file tree state in a single batch\r\n     \r\n    setFiles(prevFiles => {\r\n      const newFiles = { ...prevFiles, [filePath]: code };\r\n     \r\n      // Update editor content if it's the active file\r\n      if (filePath === activeFile && editorRef.current) {\r\n        const model = editorRef.current.models?.[filePath];\r\n        if (model && model.getValue() !== code) {\r\n          // Save current cursor position\r\n          const currentSelection = editorRef.current.getSelection();\r\n          const scrollInfo = editorRef.current.getScrollTop();\r\n          \r\n          // Update content\r\n          model.setValue(code);\r\n          \r\n          // Restore cursor position if it was the current user's cursor\r\n          if (currentSelection && !position) {\r\n            editorRef.current.setSelection(currentSelection);\r\n            editorRef.current.setScrollTop(scrollInfo);\r\n          }\r\n        }\r\n      }\r\n      \r\n      return newFiles;\r\n    });\r\n  \r\n\r\n    // Update the file tree structure\r\n    setFileTree(prevTree => {\r\n      if (!prevTree) return prevTree;\r\n      \r\n      // Create a deep clone of the tree\r\n      const newTree = JSON.parse(JSON.stringify(prevTree));\r\n      \r\n      // Function to find and update the file in the tree\r\n      const updateFileContent = (nodes) => {\r\n        for (let node of nodes) {\r\n          if (node.path === filePath && node.type === 'file') {\r\n            node.content = code;\r\n            return true;\r\n          }\r\n          if (node.children && updateFileContent(node.children)) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      };\r\n      \r\n      updateFileContent(newTree.children);\r\n      return newTree;\r\n    });\r\n\r\n    // Update user cursor position\r\n    if (position) {\r\n      setUserCursors(prev => ({\r\n        ...prev,\r\n        [sender]: { \r\n          ...prev[sender], \r\n          position, \r\n          activeFile: filePath,\r\n          username: senderUsername\r\n        }\r\n      }));\r\n    }\r\n\r\n    // Show typing indicator\r\n    if (filePath === activeFile) {\r\n      setTypingUsers(prev => ({\r\n        ...prev,\r\n        [sender]: { username: senderUsername, timestamp: Date.now() }\r\n      }));\r\n    }\r\n\r\n    setTimeout(() => {\r\n      isUpdatingFromSocket.current = false;\r\n    }, 100);\r\n  }\r\n});\r\n\r\nsocket.on('file-deleted', ({ path }) => {\r\n  setFiles(prev => {\r\n    const newFiles = { ...prev };\r\n    delete newFiles[path];\r\n    return newFiles;\r\n  });\r\n\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n    \r\n    const newTree = JSON.parse(JSON.stringify(prevTree));\r\n    const removeNode = (nodes) => {\r\n      for (let i = 0; i < nodes.length; i++) {\r\n        if (nodes[i].path === path) {\r\n          nodes.splice(i, 1);\r\n          return true;\r\n        }\r\n        if (nodes[i].children && removeNode(nodes[i].children)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    \r\n    removeNode(newTree.children);\r\n    return newTree;\r\n  });\r\n});\r\n\r\n socket.on('file-renamed', ({ oldPath, newPath }) => {\r\n  setFiles(prev => {\r\n    const newFiles = { ...prev };\r\n    if (newFiles[oldPath]) {\r\n      newFiles[newPath] = newFiles[oldPath];\r\n      delete newFiles[oldPath];\r\n    }\r\n    return newFiles;\r\n  });\r\n\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n    \r\n    const newTree = JSON.parse(JSON.stringify(prevTree));\r\n    const updateNode = (nodes) => {\r\n      for (let node of nodes) {\r\n        if (node.path === oldPath) {\r\n          const newName = newPath.split('/').pop();\r\n          node.name = newName;\r\n          node.path = newPath;\r\n          return true;\r\n        }\r\n        if (node.children && updateNode(node.children)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    \r\n    updateNode(newTree.children);\r\n    return newTree;\r\n  });\r\n\r\n  if (activeFile === oldPath) {\r\n    setActiveFile(newPath);\r\n  }\r\n});\r\nsocket.on('folder-renamed', ({ oldPath, newPath }) => {\r\n  // Update files\r\n  setFiles(prev => {\r\n    const updated = {};\r\n    for (const key in prev) {\r\n      if (key.startsWith(oldPath)) {\r\n        const newKey = key.replace(oldPath, newPath);\r\n        updated[newKey] = prev[key];\r\n      } else {\r\n        updated[key] = prev[key];\r\n      }\r\n    }\r\n    return updated;\r\n  });\r\n\r\n  // Update file tree\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n    const newTree = JSON.parse(JSON.stringify(prevTree));\r\n\r\n    const updatePaths = (nodes) => {\r\n      nodes.forEach((node) => {\r\n        if (node.path.startsWith(oldPath)) {\r\n          node.path = node.path.replace(oldPath, newPath);\r\n          if (node.type === 'folder') {\r\n            node.name = newPath.replace(/\\/$/, '').split('/').pop();\r\n          }\r\n        }\r\n        if (node.children) updatePaths(node.children);\r\n      });\r\n    };\r\n\r\n    updatePaths(newTree.children);\r\n    return newTree;\r\n  });\r\n});\r\nsocket.on('folder-deleted', ({ path }) => {\r\n  setFiles(prev => {\r\n    const updated = {};\r\n    for (const key in prev) {\r\n      if (!key.startsWith(path)) {\r\n        updated[key] = prev[key];\r\n      }\r\n    }\r\n    return updated;\r\n  });\r\n\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n    const newTree = JSON.parse(JSON.stringify(prevTree));\r\n\r\n    const removeFolder = (nodes) => {\r\n      for (let i = 0; i < nodes.length; i++) {\r\n        if (nodes[i].path === path) {\r\n          nodes.splice(i, 1);\r\n          return true;\r\n        }\r\n        if (nodes[i].children && removeFolder(nodes[i].children)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n\r\n    removeFolder(newTree.children);\r\n    return newTree;\r\n  });\r\n});\r\n\r\n    socket.on('user-joined', ({ userId, username: newUsername }) => {\r\n      console.log('ðŸ‘¤ User joined:', newUsername);\r\n      setUsers(prev => {\r\n        const exists = prev.find(u => u.id === userId);\r\n        if (!exists) {\r\n          return [...prev, { id: userId, username: newUsername }];\r\n        }\r\n        return prev;\r\n      });\r\n    });\r\n\r\n    socket.on('user-left', ({ userId, username: leftUsername }) => {\r\n      console.log('ðŸ‘¤ User left:', leftUsername);\r\n      setUsers(prev => prev.filter(u => u.id !== userId));\r\n      setActiveUsers(prev => {\r\n        const newActive = { ...prev };\r\n        delete newActive[userId];\r\n        return newActive;\r\n      });\r\n      setUserCursors(prev => {\r\n        const newCursors = { ...prev };\r\n        delete newCursors[userId];\r\n        return newCursors;\r\n      });\r\n      setTypingUsers(prev => {\r\n        const newTyping = { ...prev };\r\n        delete newTyping[userId];\r\n        return newTyping;\r\n      });\r\n    });\r\n\r\n    socket.on('cursor-position', ({ userId, username: cursorUsername, position, activeFile: userActiveFile }) => {\r\n      if (userId !== currentUserRef.current && userActiveFile === activeFile) {\r\n        setUserCursors(prev => ({\r\n          ...prev,\r\n          [userId]: { \r\n            position, \r\n            activeFile: userActiveFile, \r\n            username: cursorUsername,\r\n            timestamp: Date.now()\r\n          }\r\n        }));\r\n      }\r\n    });\r\n\r\n    socket.on('user-typing', ({ userId, username: typingUsername, filePath }) => {\r\n      if (userId !== currentUserRef.current && filePath === activeFile) {\r\n        setTypingUsers(prev => ({\r\n          ...prev,\r\n          [userId]: { username: typingUsername, timestamp: Date.now() }\r\n        }));\r\n      }\r\n    });\r\n// Listen for remote file creation\r\nsocket.on('remote-file-created', ({ filePath, content }) => {\r\n  setFiles(prev => ({ ...prev, [filePath]: content }));\r\n\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n\r\n    const newTree = JSON.parse(JSON.stringify(prevTree)); // Deep copy\r\n    const parts = filePath.split('/');\r\n    const fileName = parts.pop(); // last item is the file name\r\n    const folderPathParts = parts;\r\n\r\n    let current = newTree;\r\n\r\n    for (const part of folderPathParts) {\r\n      let folder = current.children.find(\r\n        child => child.name === part && child.type === 'folder'\r\n      );\r\n      if (!folder) {\r\n        folder = {\r\n          name: part,\r\n          type: 'folder',\r\n          path: (current.path || '') + part + '/',\r\n          children: []\r\n        };\r\n        current.children.push(folder);\r\n      }\r\n      current = folder;\r\n    }\r\n\r\n    // Add the new file under the right folder\r\n    current.children.push({\r\n      name: fileName,\r\n      type: 'file',\r\n      path: filePath,\r\n      content\r\n    });\r\n\r\n    return newTree;\r\n  });\r\n});\r\n\r\n// Listen for remote folder creation\r\nsocket.on('remote-folder-created', ({ path }) => {\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n    const exists = prevTree.children.some(child => child.path === path);\r\n    if (!exists) {\r\n      return {\r\n        ...prevTree,\r\n        children: [\r\n          ...prevTree.children,\r\n          {\r\n            name: path.replace(/\\/$/, '').split('/').pop(),\r\n            type: 'folder',\r\n            path,\r\n            children: []\r\n          }\r\n        ]\r\n      };\r\n    }\r\n    return prevTree;\r\n  });\r\n});\r\n\r\n    socketRef.current = socket;\r\n    return socket;\r\n  }, [username, roomId, activeFile, files,navigate]);\r\n\r\n  // Clear old typing indicators\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      const now = Date.now();\r\n      setTypingUsers(prev => {\r\n        const updated = { ...prev };\r\n        Object.keys(updated).forEach(userId => {\r\n          if (now - updated[userId].timestamp > 3000) {\r\n            delete updated[userId];\r\n          }\r\n        });\r\n        return updated;\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\nuseEffect(() => {\r\n  if (!socketRef.current) return;\r\n\r\n  const socket = socketRef.current;\r\n\r\n  socket.on('file-deleted', ({ path }) => {\r\n    setFiles(prev => {\r\n      const newFiles = { ...prev };\r\n      delete newFiles[path];\r\n      return newFiles;\r\n    });\r\n\r\n    setFileTree(prevTree => {\r\n      if (!prevTree) return prevTree;\r\n      const newTree = JSON.parse(JSON.stringify(prevTree));\r\n      const removeNode = (nodes) => {\r\n        for (let i = 0; i < nodes.length; i++) {\r\n          if (nodes[i].path === path) {\r\n            nodes.splice(i, 1);\r\n            return true;\r\n          }\r\n          if (nodes[i].children && removeNode(nodes[i].children)) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      };\r\n      removeNode(newTree.children);\r\n      return newTree;\r\n    });\r\n  });\r\n\r\n  socket.on('file-renamed', ({ oldPath, newPath }) => {\r\n    setFiles(prev => {\r\n      const newFiles = { ...prev };\r\n      if (newFiles[oldPath]) {\r\n        newFiles[newPath] = newFiles[oldPath];\r\n        delete newFiles[oldPath];\r\n      }\r\n      return newFiles;\r\n    });\r\n\r\n    setFileTree(prevTree => {\r\n      if (!prevTree) return prevTree;\r\n      const newTree = JSON.parse(JSON.stringify(prevTree));\r\n      const updateNode = (nodes) => {\r\n        for (let node of nodes) {\r\n          if (node.path === oldPath) {\r\n            const newName = newPath.split('/').pop();\r\n            node.name = newName;\r\n            node.path = newPath;\r\n            return true;\r\n          }\r\n          if (node.children && updateNode(node.children)) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      };\r\n      updateNode(newTree.children);\r\n      return newTree;\r\n    });\r\n\r\n    if (activeFile === oldPath) {\r\n      setActiveFile(newPath);\r\n    }\r\n  });\r\n\r\n  return () => {\r\n    socket.off('file-deleted');\r\n    socket.off('file-renamed');\r\n  };\r\n}, [activeFile]);\r\nuseEffect(() => {\r\n  if (!socketRef.current) return;\r\n  const socket = socketRef.current;\r\n\r\n  // ðŸ” Folder Renamed\r\n  socket.on('folder-renamed', ({ oldPath, newPath }) => {\r\n    setFiles(prev => {\r\n      const updated = {};\r\n      for (const key in prev) {\r\n        if (key.startsWith(oldPath)) {\r\n          const updatedKey = key.replace(oldPath, newPath);\r\n          updated[updatedKey] = prev[key];\r\n        } else {\r\n          updated[key] = prev[key];\r\n        }\r\n      }\r\n      return updated;\r\n    });\r\n\r\n    setFileTree(prev => {\r\n      if (!prev) return prev;\r\n      const tree = JSON.parse(JSON.stringify(prev));\r\n      const updatePaths = (nodes) => {\r\n        nodes.forEach(node => {\r\n          if (node.path.startsWith(oldPath)) {\r\n            node.path = node.path.replace(oldPath, newPath);\r\n            if (node.type === 'folder') {\r\n              node.name = newPath.replace(/\\/$/, '').split('/').pop();\r\n            }\r\n          }\r\n          if (node.children) updatePaths(node.children);\r\n        });\r\n      };\r\n      updatePaths(tree.children);\r\n      return tree;\r\n    });\r\n  });\r\n\r\n  // ðŸ—‘ï¸ Folder Deleted\r\n  socket.on('folder-deleted', ({ path }) => {\r\n    setFiles(prev => {\r\n      const updated = {};\r\n      for (const key in prev) {\r\n        if (!key.startsWith(path)) {\r\n          updated[key] = prev[key];\r\n        }\r\n      }\r\n      return updated;\r\n    });\r\n\r\n    setFileTree(prev => {\r\n      if (!prev) return prev;\r\n      const tree = JSON.parse(JSON.stringify(prev));\r\n      const removeFolder = (nodes) => {\r\n        for (let i = 0; i < nodes.length; i++) {\r\n          if (nodes[i].path === path) {\r\n            nodes.splice(i, 1);\r\n            return true;\r\n          }\r\n          if (nodes[i].children && removeFolder(nodes[i].children)) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      };\r\n      removeFolder(tree.children);\r\n      return tree;\r\n    });\r\n  });\r\n\r\n  return () => {\r\n    socket.off('folder-renamed');\r\n    socket.off('folder-deleted');\r\n  };\r\n}, []);\r\n\r\n  // Main initialization effect\r\n  useEffect(() => {\r\n    if (!roomId) {\r\n      navigate('/room');\r\n      return;\r\n    }\r\n\r\n    if (initializedRef.current) return;\r\n    initializedRef.current = true;\r\n\r\n    const user = (location.state && location.state.username) ||\r\n                 localStorage.getItem('username') ||\r\n                 'Guest';\r\n    setUsername(user);\r\n\r\n  const initialize = async () => {\r\n  try {\r\n    // 1. Fetch files - now returns { files, tree }\r\n    const { files: filesData, tree } = await fetchFiles();\r\n    \r\n    // 2. Set both states\r\n    setFiles(filesData);\r\n    setFileTree(tree); // Make sure you have this state: const [fileTree, setFileTree] = useState(null);\r\n    \r\n    // 3. Initialize socket with the flat files data\r\n    initializeSocket(filesData);\r\n    \r\n    // 4. Set username (unchanged)\r\n    localStorage.setItem('username', user);\r\n    \r\n    // 5. Set default active file if needed\r\n    if (!activeFile) {\r\n      setActiveFile('index.html');\r\n    }\r\n  } catch (error) {\r\n    console.error('Initialization error:', error);\r\n    setConnectionStatus('Initialization failed');\r\n  }\r\n};\r\n\r\n    initialize();\r\n\r\n    return () => {\r\n      if (socketRef.current) {\r\n        socketRef.current.disconnect();\r\n      }\r\n    };\r\n  }, [roomId, navigate, location.state, fetchFiles, initializeSocket,activeFile]);\r\n\r\n  // Track cursor position more frequently\r\n  useEffect(() => {\r\n    if (!editorRef.current || !socketRef.current?.connected) return;\r\n\r\n    const editor = editorRef.current;\r\n    \r\n    const handleCursorChange = () => {\r\n      if (isUpdatingFromSocket.current) return;\r\n      \r\n      const selection = editor.getSelection();\r\n      if (selection) {\r\n        const position = {\r\n          lineNumber: selection.positionLineNumber,\r\n          column: selection.positionColumn\r\n        };\r\n        \r\n        socketRef.current.emit('cursor-position', {\r\n          roomId,\r\n          filePath: activeFile,\r\n          position,\r\n          username\r\n        });\r\n      }\r\n    };\r\n\r\n    const disposable = editor.onDidChangeCursorPosition(handleCursorChange);\r\n    return () => disposable.dispose();\r\n  }, [roomId, activeFile, username]);\r\n\r\n  // Handle code changes with real-time sync\r\n\r\nconst handleMouseMove =useCallback((e) => {\r\n  if (!isDragging) return;\r\n  \r\n  const container = document.querySelector('.main-editor');\r\n  if (!container) return;\r\n  \r\n  const containerRect = container.getBoundingClientRect();\r\n  const containerWidth = containerRect.width;\r\n  const mouseX = e.clientX - containerRect.left;\r\n  const newWidth = (mouseX / containerWidth) * 100;\r\n  \r\n  // Limit the width between 20% and 80%\r\n  setPanelWidth(Math.min(Math.max(newWidth, 30), 70));\r\n},[isDragging]);\r\nconst handleMouseUp =useCallback( () => {\r\n  setIsDragging(false);\r\n  document.body.style.cursor = '';\r\n  document.removeEventListener('mousemove', handleMouseMove);\r\n  document.removeEventListener('mouseup', handleMouseUp);\r\n},[handleMouseMove]);\r\n// Add this to your cleanup effects\r\nuseEffect(() => {\r\n  return () => {\r\n    document.removeEventListener('mousemove', handleMouseMove);\r\n    document.removeEventListener('mouseup', handleMouseUp);\r\n  };\r\n}, [handleMouseMove, handleMouseUp]);\r\n\r\n  const handleMouseDown = useCallback((e) => {\r\n    e.preventDefault();\r\n  setIsDragging(true);\r\n  document.body.style.cursor = 'col-resize';\r\n  document.addEventListener('mousemove', handleMouseMove);\r\n  document.addEventListener('mouseup', handleMouseUp);\r\n},[handleMouseMove, handleMouseUp]);\r\n\r\n  const handleCodeChange = useCallback((value) => {\r\n    if (!value) value = '';\r\n    if (isUpdatingFromSocket.current) return;\r\n    \r\n    const timestamp = Date.now();\r\n    lastChangeTimestamp.current = timestamp;\r\n     \r\n    setFiles(prev => {\r\n      if (prev[activeFile] !== value) {\r\n        const newFiles = { ...prev, [activeFile]: value };\r\n        \r\n        if (socketRef.current?.connected) {\r\n          const selection = editorRef.current?.getSelection();\r\n          const position = selection ? {\r\n            lineNumber: selection.positionLineNumber,\r\n            column: selection.positionColumn\r\n          } : null;\r\n          \r\n          // Emit real-time changes\r\n          socketRef.current.emit('code-change', {\r\n            roomId,\r\n            filePath: activeFile,\r\n            code: value,\r\n            position,\r\n            timestamp,\r\n            username\r\n          });\r\n\r\n          // Emit typing indicator\r\n          socketRef.current.emit('user-typing', {\r\n            roomId,\r\n            filePath: activeFile,\r\n            username\r\n          });\r\n        }\r\n        \r\n        // Debounced save to database\r\n        //debouncedSave(roomId, activeFile, value);\r\n        debouncedSaveRef.current?.(roomId, activeFile, value);\r\n        return newFiles;\r\n      }\r\n      return prev;\r\n    });\r\n  }, [activeFile, roomId, debouncedSave, username]);\r\nconst handleAddFile = () => {\r\n  setShowNewFileModal(true);\r\n};\r\n\r\nconst handleAddFolder = () => {\r\n  setShowNewFolderModal(true);\r\n};\r\nconst createNewFile = async () => {\r\n  if (!newFileName) return;\r\n  \r\n  const fileExt = newFileName.split('.').pop();\r\n  let defaultContent = '';\r\n  \r\n  if (fileExt === 'html') {\r\n    defaultContent = '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>New File</title>\\n</head>\\n<body>\\n    \\n</body>\\n</html>';\r\n  } else if (fileExt === 'css') {\r\n    defaultContent = '/* Your CSS here */';\r\n  } else if (fileExt === 'js') {\r\n    defaultContent = '// Your JavaScript here';\r\n  }\r\n  \r\n  try {\r\n    // Save to backend first\r\n    await fetch('http://localhost:5000/api/code/save', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ \r\n        roomId, \r\n        filePath: newFileName, \r\n        content: defaultContent \r\n      }),\r\n    });\r\n\r\n    // Then update local state\r\n    setFiles(prev => ({ ...prev, [newFileName]: defaultContent }));\r\n    \r\n    setFileTree(prevTree => {\r\n      if (!prevTree) return prevTree;\r\n      \r\n      // Check if file already exists in tree\r\n      const exists = prevTree.children.some(child => \r\n        child.path === newFileName\r\n      );\r\n      \r\n      if (!exists) {\r\n        return {\r\n          ...prevTree,\r\n          children: [\r\n            ...prevTree.children,\r\n            {\r\n              name: newFileName,\r\n              type: 'file',\r\n              path: newFileName,\r\n              content: defaultContent\r\n            }\r\n          ]\r\n        };\r\n      }\r\n      return prevTree;\r\n    });\r\n        if (socketRef.current?.connected) {\r\n      socketRef.current.emit('new-file-created', {\r\n        roomId,\r\n        filePath: newFileName,\r\n        content: defaultContent,\r\n        username\r\n      });\r\n    }\r\n\r\n    setActiveFile(newFileName);\r\n    setShowNewFileModal(false);\r\n    setNewFileName('');\r\n    \r\n    // Notify other users\r\n    if (socketRef.current?.connected) {\r\n      socketRef.current.emit('code-change', {\r\n        roomId,\r\n        filePath: newFileName,\r\n        code: defaultContent,\r\n        username\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('Error creating file:', error);\r\n  }\r\n};\r\nconst createFileAtPath = async (path) => {\r\n  const fileExt = path.split('.').pop();\r\n  let defaultContent = '';\r\n  if (fileExt === 'html') defaultContent = '<!DOCTYPE html>\\n<html>\\n<head>\\n<title></title>\\n</head>\\n<body>\\n</body>\\n</html>';\r\n  if (fileExt === 'css') defaultContent = '/* CSS here */';\r\n  if (fileExt === 'js') defaultContent = '// JS here';\r\n\r\n  await fetch('http://localhost:5000/api/code/save', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ roomId, filePath: path, content: defaultContent }),\r\n  });\r\n\r\n  setFiles(prev => ({ ...prev, [path]: defaultContent }));\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n\r\n    const newNode = {\r\n      name: path.split('/').pop(),\r\n      type: 'file',\r\n      path,\r\n      content: defaultContent\r\n    };\r\n\r\n    // Recursively insert file under the correct folder\r\n    const insertFile = (tree, folderPath) => {\r\n      if (tree.path === folderPath) {\r\n        tree.children.push(newNode);\r\n        return true;\r\n      }\r\n      for (const child of tree.children) {\r\n        if (child.type === 'folder' && insertFile(child, folderPath)) return true;\r\n      }\r\n      return false;\r\n    };\r\n\r\n    const updatedTree = JSON.parse(JSON.stringify(prevTree));\r\n    insertFile(updatedTree, path.substring(0, path.lastIndexOf('/') + 1));\r\n    return updatedTree;\r\n  });\r\n\r\n  if (socketRef.current?.connected) {\r\n    socketRef.current.emit('new-file-created', {\r\n      roomId,\r\n      filePath: path,\r\n      content: defaultContent,\r\n      username\r\n    });\r\n  }\r\n};\r\n\r\nconst createNewFolder = async () => {\r\n  if (!newFolderName) return;\r\n  \r\n  try {\r\n    // Ensure folder path ends with /\r\n    const folderPath = newFolderName.endsWith('/') ? \r\n      newFolderName : `${newFolderName}/`;\r\n    \r\n    // Save to backend\r\n    await fetch('http://localhost:5000/api/code/createFolder', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ \r\n        roomId, \r\n        path: folderPath \r\n      }),\r\n    });\r\n\r\n    // Update local state\r\n    setFileTree(prevTree => {\r\n      if (!prevTree) return prevTree;\r\n      \r\n      // Check if folder already exists\r\n      const exists = prevTree.children.some(child => \r\n        child.path === folderPath\r\n      );\r\n      \r\n      if (!exists) {\r\n        return {\r\n          ...prevTree,\r\n          children: [\r\n            ...prevTree.children,\r\n            {\r\n              name: newFolderName,\r\n              type: 'folder',\r\n              path: folderPath,\r\n              children: []\r\n            }\r\n          ]\r\n        };\r\n      }\r\n      return prevTree;\r\n    });\r\n    \r\n    setShowNewFolderModal(false);\r\n    setNewFolderName('');\r\n        if (socketRef.current?.connected) {\r\n      socketRef.current.emit('new-folder-created', {\r\n        roomId,\r\n        path: folderPath,\r\n        username\r\n      });\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Error creating folder:', error);\r\n  }\r\n};\r\n  // Handle running the code\r\n  const handleRun = () => {\r\n    if (!files || !iframeRef.current) return;\r\n\r\n    const html = files['index.html'] || '';\r\n    const css = files['style.css'] || '';\r\n    const js = files['script.js'] || '';\r\n\r\n    const combined = `\r\n      <!DOCTYPE html>\r\n      <html>\r\n        <head>\r\n          <meta charset=\"UTF-8\">\r\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n          <style>${css}</style>\r\n        </head>\r\n        <body>\r\n          ${html}\r\n          <script>\r\n            // Error handling for iframe\r\n            window.onerror = function(msg, url, line, col, error) {\r\n              console.error('Error:', msg, 'at', line + ':' + col);\r\n              return false;\r\n            };\r\n            ${js}\r\n          </script>\r\n        </body>\r\n      </html>\r\n    `;\r\n\r\n    const blob = new Blob([combined], { type: 'text/html' });\r\n    const url = URL.createObjectURL(blob);\r\n    iframeRef.current.src = url;\r\n    setTimeout(() => URL.revokeObjectURL(url), 1000);\r\n  };\r\n\r\n  // Handle file switching\r\n  // const handleFileSwitch = (fileName) => {\r\n  //   setActiveFile(fileName);\r\n  //    if (editorRef.current?.models?.[fileName]) {\r\n  //   editorRef.current.setModel(editorRef.current.models[fileName]);\r\n  // }\r\n  //   if (socketRef.current?.connected) {\r\n  //     socketRef.current.emit('file-switch', {\r\n  //       roomId,\r\n  //       filePath: fileName,\r\n  //       username\r\n  //     });\r\n  //   }\r\n  // };\r\n const handleEditorMount = (editor, monaco) => {\r\n  editorRef.current = editor;\r\n\r\n  // Initialize models object if not present\r\n  if (!editorRef.current.models) {\r\n    editorRef.current.models = {};\r\n  }\r\n\r\n  // Create or reuse a separate model for each file\r\n  Object.entries(files).forEach(([filePath, content]) => {\r\n    if (!editorRef.current.models[filePath]) {\r\n      const lang = getLanguage(filePath);\r\n      editorRef.current.models[filePath] = monaco.editor.createModel(content, lang);\r\n    }\r\n  });\r\n\r\n  // Set current active model\r\n  const activeModel = editorRef.current.models[activeFile];\r\n  if (activeModel) {\r\n    editor.setModel(activeModel);\r\n  }\r\n\r\n  // Cursor tracking\r\n  editor.onDidChangeCursorPosition(() => {\r\n    if (socketRef.current?.connected && !isUpdatingFromSocket.current) {\r\n      const selection = editor.getSelection();\r\n      if (selection) {\r\n        const position = {\r\n          lineNumber: selection.positionLineNumber,\r\n          column: selection.positionColumn\r\n        };\r\n        socketRef.current.emit('cursor-position', {\r\n          roomId,\r\n          filePath: activeFile,\r\n          position,\r\n          username\r\n        });\r\n      }\r\n    }\r\n  });\r\n};\r\nconst handleFileSwitch = (fileName) => {\r\n  setActiveFile(fileName);\r\n\r\n  const model = editorRef.current?.models?.[fileName];\r\n  if (model) {\r\n    editorRef.current.setModel(model);  // âœ… this is correct\r\n  }\r\n};\r\n\r\n\r\n  // Cleanup on page unload\r\n  useBeforeUnload(() => {\r\n    if (socketRef.current) {\r\n      socketRef.current.disconnect();\r\n    }\r\n  });\r\n\r\n  const getLanguage = (file) => {\r\n    if (file.endsWith('.js')) return 'javascript';\r\n    if (file.endsWith('.html')) return 'html';\r\n    if (file.endsWith('.css')) return 'css';\r\n    return 'plaintext';\r\n  };\r\n\r\n  if (!files || !fileTree) {\r\n    return (\r\n      <div className=\"editor-wrapper\" >\r\n        <div className=\"loading-screen\">\r\n          <div className=\"loading-spinner\"></div>\r\n          <div>Loading collaborative editor...</div>\r\n          <div className=\"connection-status\">{connectionStatus}</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const typingUsersList = Object.values(typingUsers);\r\n\r\n  return (\r\n    <div className=\"editor-wrapper\">\r\n      <div className=\"collaboration-bar\">\r\n        <div className=\"room-info\">\r\n          <strong>Room:</strong> {roomId} | <strong>User:</strong> {username}\r\n          <span className={`connection-status ${connectionStatus === 'Connected' ? 'connected' : 'disconnected'}`}>\r\n            â— {connectionStatus}\r\n          </span>\r\n        </div>\r\n        \r\n        <div className=\"online-users\">\r\n          <span className=\"users-label\">Online ({users.length}):</span>\r\n          {users.map(user => (\r\n            <div \r\n              key={user.id} \r\n              className=\"user-badge\"\r\n              style={{ backgroundColor: getUserColor(user.id) }}\r\n            >\r\n              {user.username}\r\n              {user.id === currentUserRef.current && ' (You)'}\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {typingUsersList.length > 0 && (\r\n          <div className=\"typing-indicator\">\r\n            <span className=\"typing-dots\">â—â—â—</span>\r\n            {typingUsersList.map(t => t.username).join(', ')} \r\n            {typingUsersList.length === 1 ? ' is' : ' are'} typing in {activeFile}...\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"editor-container\" style={{ flexDirection: 'row' }}>\r\n        <div className=\"sidebar\">\r\n          <FileSidebar\r\n            tree={fileTree} \r\n           activeFile={activeFile}\r\n         setActiveFile={handleFileSwitch}\r\n         onAddFile={handleAddFile}\r\n             onAddFolder={handleAddFolder}\r\n               onAddFileToFolder={createFileAtPath}\r\n               roomId={roomId}\r\n               setFiles={setFiles}           // Pass down the setter\r\n          setFileTree={setFileTree}     // Pass down the setter\r\n      socketRef={socketRef}         // Pass down the ref\r\n      username={username}\r\n          /> \r\n        </div>\r\n\r\n        <div className=\"main-editor noselect\" style={{ display: 'flex', flexDirection: 'row', flex: 1 }}>\r\n          \r\n          <div style={{ width: `${panelWidth}%`, display: 'flex', flexDirection: 'column',minWidth: '300px' }}>\r\n          <div className=\"editor-header\">\r\n            <div className=\"file-info\">\r\n              <strong>{activeFile}</strong>\r\n              <span className=\"file-language\">({getLanguage(activeFile)})</span>\r\n            </div>\r\n            <button className=\"run-button\" onClick={handleRun}>\r\n              â–¶ Run \r\n            </button>\r\n            <button className=\"download-button\" onClick={downloadProjectAsZip}>\r\n             â¬‡ Download ZIP\r\n           </button>\r\n          </div>\r\n\r\n          <div className=\"editor-container-with-cursors\">\r\n            <Editor\r\n              height=\"50vh\"\r\n              language={getLanguage(activeFile)}\r\n              value={files[activeFile] || \"\"}\r\n              onChange={handleCodeChange}\r\n              onMount={handleEditorMount}//(editor,monaco) => {\r\n//                 editorRef.current = editor;\r\n//                  if (!editorRef.current.models) {\r\n//     editorRef.current.models = {};\r\n//   }\r\n  \r\n//   Object.entries(files).forEach(([filePath, content]) => {\r\n//     if (!editorRef.current.models[filePath]) {\r\n//       const language = getLanguage(filePath);\r\n//       editorRef.current.models[filePath] = monaco.editor.createModel(content, language);\r\n//     } \r\n//   });\r\n\r\n//   editor.setModel(editorRef.current.models[activeFile]);\r\n\r\n//   // Save the models for reuse\r\n// //  editorRef.current.models = models;\r\n//                 // Add cursor tracking\r\n//                 editor.onDidChangeCursorPosition(() => {\r\n//                   if (socketRef.current?.connected && !isUpdatingFromSocket.current) {\r\n//                     const selection = editor.getSelection();\r\n//                     if (selection) {\r\n//                       const position = {\r\n//                         lineNumber: selection.positionLineNumber,\r\n//                         column: selection.positionColumn\r\n//                       };\r\n                      \r\n//                       socketRef.current.emit('cursor-position', {\r\n//                         roomId,\r\n//                         filePath: activeFile,\r\n//                         position,\r\n//                         username\r\n//                       });\r\n//                     }\r\n//                   }\r\n//                 });\r\n//               }}\r\n\r\n\r\n              theme=\"vs-dark\"\r\n              options={{\r\n                minimap: { enabled: false },\r\n                fontSize: 14,\r\n                wordWrap: 'on',\r\n                automaticLayout: true,\r\n                scrollBeyondLastLine: false,\r\n                renderWhitespace: 'selection',\r\n                smoothScrolling: true,\r\n                cursorBlinking: 'smooth',\r\n                cursorSmoothCaretAnimation: true,\r\n              }}\r\n            />\r\n            \r\n            {/* Render other users' cursors */}\r\n            {Object.entries(userCursors).map(([userId, cursor]) => (\r\n              cursor.activeFile === activeFile && (\r\n                <div\r\n                  key={userId}\r\n                  className=\"user-cursor\"\r\n                  style={{\r\n                    position: 'absolute',\r\n                    top: `${(cursor.position?.lineNumber || 0) * 18}px`,\r\n                    left: `${(cursor.position?.column || 0) * 8}px`,\r\n                    borderLeft: `2px solid ${getUserColor(userId)}`,\r\n                    height: '18px',\r\n                    pointerEvents: 'none',\r\n                    zIndex: 1000,\r\n                  }}\r\n                >\r\n                  <div\r\n                    className=\"user-cursor-label\"\r\n                    style={{\r\n                      backgroundColor: getUserColor(userId),\r\n                      color: 'white',\r\n                      padding: '2px 6px',\r\n                      borderRadius: '3px',\r\n                      fontSize: '11px',\r\n                      position: 'absolute',\r\n                      top: '-20px',\r\n                      left: '0',\r\n                      whiteSpace: 'nowrap',\r\n                    }}\r\n                  >\r\n                    {cursor.username}\r\n                  </div>\r\n                </div>\r\n              )\r\n            ))}\r\n          </div>\r\n          </div>\r\n<div \r\n    className=\"resize-handle\"\r\n    onMouseDown={handleMouseDown}\r\n    style={{ \r\n      width: '5px', \r\n      cursor: 'col-resize',\r\n      backgroundColor: isDragging ? '#007acc' : '#3e3e42',\r\n      transition: 'background-color 0.2s ease'\r\n    }}\r\n  />\r\n          <div className=\"output-panel\" style={{ width: `${100 - panelWidth}%`, minWidth: '300px' }}>\r\n            <div className=\"output-header\">\r\n              <strong>Output Preview</strong>\r\n              <button className=\"refresh-output\" onClick={handleRun}>\r\n                ðŸ”„ Refresh\r\n              </button>\r\n            </div>\r\n            <iframe\r\n              ref={iframeRef}\r\n              title=\"Live Code Output\"\r\n              className=\"output-frame\"\r\n                style={{ flex: 1, border: 'none', background: 'white', width: '100%', height: '100%' }}\r\n              sandbox=\"allow-scripts allow-same-origin allow-forms\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {showNewFileModal && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal\">\r\n            <h3>Create New File</h3>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"filename.html/.css/.js\"\r\n              value={newFileName}\r\n              onChange={(e) => setNewFileName(e.target.value)}\r\n            />\r\n            <div className=\"modal-actions\">\r\n              <button onClick={() => setShowNewFileModal(false)}>Cancel</button>\r\n              <button onClick={createNewFile}>Create</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showNewFolderModal && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal\">\r\n            <h3>Create New Folder</h3>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Folder name\"\r\n              value={newFolderName}\r\n              onChange={(e) => setNewFolderName(e.target.value)}\r\n            />\r\n            <div className=\"modal-actions\">\r\n              <button onClick={() => setShowNewFolderModal(false)}>Cancel</button>\r\n              <button onClick={createNewFolder}>Create</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n   \r\n\r\nfunction debounce(func, wait) {\r\n  let timeout;\r\n  return function executedFunction(...args) {\r\n    const later = () => {\r\n      clearTimeout(timeout);\r\n      func(...args);\r\n    };\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n}\r\n\r\nexport default EditorPage;"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,WAAW,QAAQ,OAAO;AACvE,SAASC,WAAW,EAAEC,SAAS,EAAEC,WAAW,EAAEC,eAAe,QAAQ,kBAAkB;AACvF,OAAOC,MAAM,MAAM,sBAAsB;AACzC,SAASC,EAAE,QAAQ,kBAAkB;AACrC,OAAOC,WAAW,MAAM,2BAA2B;AACnD,OAAO,sBAAsB;AAC7B,SAASC,oBAAoB,QAAQ,sBAAsB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE5D,SAASC,UAAUA,CAAA,EAAG;EAAAC,EAAA;EACpB,MAAM;IAAEC;EAAO,CAAC,GAAGX,SAAS,CAAC,CAAC;EAC9B,MAAMY,QAAQ,GAAGb,WAAW,CAAC,CAAC;EAC9B,MAAMc,QAAQ,GAAGZ,WAAW,CAAC,CAAC;EAC9B,MAAMa,SAAS,GAAGlB,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMmB,cAAc,GAAGnB,MAAM,CAAC,KAAK,CAAC;EACpC,MAAMoB,cAAc,GAAGpB,MAAM,CAAC,IAAI,CAAC;EACnC,MAAMqB,SAAS,GAAGrB,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMsB,SAAS,GAAGtB,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMuB,oBAAoB,GAAGvB,MAAM,CAAC,KAAK,CAAC;EAC1C,MAAMwB,mBAAmB,GAAGxB,MAAM,CAAC,CAAC,CAAC;EAErC,MAAM,CAACyB,QAAQ,EAAEC,WAAW,CAAC,GAAGzB,QAAQ,CAAC,EAAE,CAAC;EAC5C,MAAM,CAAC0B,KAAK,EAAEC,QAAQ,CAAC,GAAG3B,QAAQ,CAAC,IAAI,CAAC;EACxC,MAAM,CAAC4B,UAAU,EAAEC,aAAa,CAAC,GAAG7B,QAAQ,CAAC,YAAY,CAAC;EAC1D,MAAM,CAAC8B,gBAAgB,EAAEC,mBAAmB,CAAC,GAAG/B,QAAQ,CAAC,eAAe,CAAC;EACzE,MAAM,CAACgC,KAAK,EAAEC,QAAQ,CAAC,GAAGjC,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACkC,WAAW,EAAEC,cAAc,CAAC,GAAGnC,QAAQ,CAAC,CAAC,CAAC,CAAC;EAClD,MAAM,CAACoC,WAAW,EAAEC,cAAc,CAAC,GAAGrC,QAAQ,CAAC,CAAC,CAAC,CAAC;EAClD,MAAM,CAACsC,WAAW,EAAEC,cAAc,CAAC,GAAGvC,QAAQ,CAAC,CAAC,CAAC,CAAC;EACpD,MAAM,CAACwC,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGzC,QAAQ,CAAC,KAAK,CAAC;EAC/D,MAAM,CAAC0C,kBAAkB,EAAEC,qBAAqB,CAAC,GAAG3C,QAAQ,CAAC,KAAK,CAAC;EACnE,MAAM,CAAC4C,WAAW,EAAEC,cAAc,CAAC,GAAG7C,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAAC8C,aAAa,EAAEC,gBAAgB,CAAC,GAAG/C,QAAQ,CAAC,EAAE,CAAC;EACtD;EACA,MAAM,CAACgD,QAAQ,EAAEC,WAAW,CAAC,GAAGjD,QAAQ,CAAC,IAAI,CAAC;EAE5C,MAAM,CAACkD,UAAU,EAAEC,aAAa,CAAC,GAAGnD,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAACoD,UAAU,EAAEC,aAAa,CAAC,GAAGrD,QAAQ,CAAC,KAAK,CAAC;;EAElD;EACC,MAAMsD,UAAU,GAAG,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;EAChG,MAAMC,YAAY,GAAIC,MAAM,IAAK;IAC/B,MAAMC,KAAK,GAAGC,MAAM,CAACC,IAAI,CAACzB,WAAW,CAAC,CAAC0B,OAAO,CAACJ,MAAM,CAAC;IACtD,OAAOF,UAAU,CAACG,KAAK,GAAGH,UAAU,CAACO,MAAM,CAAC;EAC9C,CAAC;;EAED;EACA,MAAMC,gBAAgB,GAAG/D,MAAM,CAAC,CAAC;EACjC,MAAMgE,aAAa,GAAG9D,WAAW,CAC/B+D,QAAQ,CAAC,OAAOlD,MAAM,EAAEmD,QAAQ,EAAEC,OAAO,KAAK;IAC5C,IAAI;MACF,MAAMC,KAAK,CAAC,qCAAqC,EAAE;QACjDC,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/CC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UAAE1D,MAAM;UAAEmD,QAAQ;UAAEC;QAAQ,CAAC;MACpD,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOO,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,oBAAoB,EAAEF,GAAG,CAAC;IAC1C;EACF,CAAC,EAAE,IAAI,CAAC,EACR,CAAC3D,MAAM,CAAC,CAAC;EACb;EACA;EACA;EACA;EACA;EACA;EACE;EACA,MAAM8D,UAAU,GAAG3E,WAAW,CAAC,YAAY;IAC3C,IAAI,CAACa,MAAM,EAAE;IAEb,IAAI;MACF,MAAM+D,QAAQ,GAAG,MAAMV,KAAK,CAAC,kCAAkCrD,MAAM,EAAE,CAAC;MAExE,IAAI,CAAC+D,QAAQ,CAACC,EAAE,EAAE;QAChB,IAAID,QAAQ,CAACE,MAAM,KAAK,GAAG,EAAE;UAC3B;UACA,MAAMC,YAAY,GAAG;YACnB,YAAY,EAAE,0HAA0H;YACxI,WAAW,EAAE,oHAAoH;YACjI,WAAW,EAAE;UACf,CAAC;;UAED;UACA,MAAMC,OAAO,CAACC,GAAG,CACfxB,MAAM,CAACyB,OAAO,CAACH,YAAY,CAAC,CAACI,GAAG,CAAC,CAAC,CAACnB,QAAQ,EAAEC,OAAO,CAAC,KACnDH,aAAa,CAACjD,MAAM,EAAEmD,QAAQ,EAAEC,OAAO,CAC3C,CAAC,CAAC;;UAEF;UACA,MAAMmB,WAAW,GAAG;YAClBC,IAAI,EAAE,MAAM;YACZC,IAAI,EAAE,QAAQ;YACdC,IAAI,EAAE,EAAE;YACRC,QAAQ,EAAE,CACR;cACEH,IAAI,EAAE,YAAY;cAClBC,IAAI,EAAE,MAAM;cACZC,IAAI,EAAE,YAAY;cAClBtB,OAAO,EAAEc,YAAY,CAAC,YAAY;YACpC,CAAC,EACD;cACEM,IAAI,EAAE,WAAW;cACjBC,IAAI,EAAE,MAAM;cACZC,IAAI,EAAE,WAAW;cACjBtB,OAAO,EAAEc,YAAY,CAAC,WAAW;YACnC,CAAC,EACD;cACEM,IAAI,EAAE,WAAW;cACjBC,IAAI,EAAE,MAAM;cACZC,IAAI,EAAE,WAAW;cACjBtB,OAAO,EAAEc,YAAY,CAAC,WAAW;YACnC,CAAC;UAEL,CAAC;UAED,OAAO;YACLtD,KAAK,EAAEsD,YAAY;YACnBU,IAAI,EAAEL;UACR,CAAC;QACH;QACA,MAAM,IAAIM,KAAK,CAAC,uBAAuBd,QAAQ,CAACE,MAAM,EAAE,CAAC;MAC3D;MAEA,MAAM;QAAErD,KAAK;QAAEgE;MAAK,CAAC,GAAG,MAAMb,QAAQ,CAACe,IAAI,CAAC,CAAC;;MAE7C;MACA,MAAMC,aAAa,GAAG,CAAC,YAAY,EAAE,WAAW,EAAE,WAAW,CAAC;MAC9D,MAAMC,aAAa,GAAG;QAAE,GAAGpE;MAAM,CAAC;MAElCmE,aAAa,CAACE,OAAO,CAACC,IAAI,IAAI;QAC5B,IAAI,CAACF,aAAa,CAACE,IAAI,CAAC,EAAE;UACxBF,aAAa,CAACE,IAAI,CAAC,GAAGA,IAAI,CAACC,QAAQ,CAAC,OAAO,CAAC,GAC1C,0HAA0H,GAC1HD,IAAI,CAACC,QAAQ,CAAC,MAAM,CAAC,GACrB,oHAAoH,GACpH,0EAA0E;;UAE5E;UACA,IAAI,CAACP,IAAI,CAACD,QAAQ,CAACS,IAAI,CAACC,KAAK,IAAIA,KAAK,CAACb,IAAI,KAAKU,IAAI,CAAC,EAAE;YACrDN,IAAI,CAACD,QAAQ,CAACW,IAAI,CAAC;cACjBd,IAAI,EAAEU,IAAI;cACVT,IAAI,EAAE,MAAM;cACZC,IAAI,EAAEQ,IAAI;cACV9B,OAAO,EAAE4B,aAAa,CAACE,IAAI;YAC7B,CAAC,CAAC;UACJ;QACF;MACF,CAAC,CAAC;MAEF,OAAO;QACLtE,KAAK,EAAEoE,aAAa;QACpBJ,IAAI,EAAEA;MACR,CAAC;IACH,CAAC,CAAC,OAAOf,KAAK,EAAE;MACdD,OAAO,CAACC,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;;MAE5C;MACA,MAAMK,YAAY,GAAG;QACnB,YAAY,EAAE,0HAA0H;QACxI,WAAW,EAAE,oHAAoH;QACjI,WAAW,EAAE;MACf,CAAC;MAED,MAAMK,WAAW,GAAG;QAClBC,IAAI,EAAE,MAAM;QACZC,IAAI,EAAE,QAAQ;QACdC,IAAI,EAAE,EAAE;QACRC,QAAQ,EAAE,CACR;UACEH,IAAI,EAAE,YAAY;UAClBC,IAAI,EAAE,MAAM;UACZC,IAAI,EAAE,YAAY;UAClBtB,OAAO,EAAEc,YAAY,CAAC,YAAY;QACpC,CAAC,EACD;UACEM,IAAI,EAAE,WAAW;UACjBC,IAAI,EAAE,MAAM;UACZC,IAAI,EAAE,WAAW;UACjBtB,OAAO,EAAEc,YAAY,CAAC,WAAW;QACnC,CAAC,EACD;UACEM,IAAI,EAAE,WAAW;UACjBC,IAAI,EAAE,MAAM;UACZC,IAAI,EAAE,WAAW;UACjBtB,OAAO,EAAEc,YAAY,CAAC,WAAW;QACnC,CAAC;MAEL,CAAC;MAED,OAAO;QACLtD,KAAK,EAAEsD,YAAY;QACnBU,IAAI,EAAEL;MACR,CAAC;IACH;EACF,CAAC,EAAE,CAACvE,MAAM,EAAEiD,aAAa,CAAC,CAAC;;EAEzB;EACA,MAAMsC,gBAAgB,GAAGpG,WAAW,CAAEqG,SAAS,IAAK;IAClD,IAAIrF,SAAS,CAACsF,OAAO,EAAE;MACrBtF,SAAS,CAACsF,OAAO,CAACC,UAAU,CAAC,CAAC;IAChC;IAEA,MAAMC,MAAM,GAAGlG,EAAE,CAAC,uBAAuB,EAAE;MACzCmG,UAAU,EAAE,CAAC,WAAW,CAAC;MACzBC,OAAO,EAAE,KAAK;MACdC,oBAAoB,EAAE,CAAC;MACvBC,iBAAiB,EAAE,IAAI;MACvBC,OAAO,EAAE;IACX,CAAC,CAAC;IACNL,MAAM,CAACM,EAAE,CAAC,YAAY,EAAGC,GAAG,IAAK;MAC/BC,KAAK,CAACD,GAAG,CAAC,CAAC,CAAW;MACtBhG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAI;IACxB,CAAC,CAAC;IAEEyF,MAAM,CAACM,EAAE,CAAC,SAAS,EAAE,MAAM;MACzBrC,OAAO,CAACwC,GAAG,CAAC,wBAAwB,CAAC;MACrCnF,mBAAmB,CAAC,WAAW,CAAC;MAChCZ,cAAc,CAACoF,OAAO,GAAGE,MAAM,CAACU,EAAE;MAClCV,MAAM,CAACW,IAAI,CAAC,WAAW,EAAE;QACvBtG,MAAM;QACNU,QAAQ;QACRE,KAAK,EAAE4E;MACT,CAAC,CAAC;IACJ,CAAC,CAAC;IAEFG,MAAM,CAACM,EAAE,CAAC,YAAY,EAAE,MAAM;MAC5BrC,OAAO,CAACwC,GAAG,CAAC,6BAA6B,CAAC;MAC1CnF,mBAAmB,CAAC,cAAc,CAAC;IACrC,CAAC,CAAC;IAEF0E,MAAM,CAACM,EAAE,CAAC,WAAW,EAAE,MAAM;MAC3BrC,OAAO,CAACwC,GAAG,CAAC,0BAA0B,CAAC;MACvCnF,mBAAmB,CAAC,WAAW,CAAC;MAChC0E,MAAM,CAACW,IAAI,CAAC,WAAW,EAAE;QACvBtG,MAAM;QACNU,QAAQ;QACRE,KAAK,EAAEA;MACT,CAAC,CAAC;IACJ,CAAC,CAAC;IAEF+E,MAAM,CAACM,EAAE,CAAC,YAAY,EAAE,CAAC;MAAErF,KAAK,EAAE2F,SAAS;MAAErF,KAAK,EAAEsF;IAAU,CAAC,KAAK;MAClE5C,OAAO,CAACwC,GAAG,CAAC,yBAAyB,EAAE;QAAExF,KAAK,EAAEgC,MAAM,CAACC,IAAI,CAAC0D,SAAS,CAAC;QAAErF,KAAK,EAAEsF,SAAS,CAACzD;MAAO,CAAC,CAAC;MAClGlC,QAAQ,CAAC0F,SAAS,CAAC;MACnBpF,QAAQ,CAACqF,SAAS,CAAC;IACrB,CAAC,CAAC;IAENb,MAAM,CAACM,EAAE,CAAC,aAAa,EAAE,CAAC;MAAEQ,QAAQ;MAAEC,IAAI;MAAEC,MAAM;MAAEC,QAAQ;MAAElG,QAAQ,EAAEmG;IAAe,CAAC,KAAK;MAC3F,IAAIF,MAAM,KAAKtG,cAAc,CAACoF,OAAO,EAAE;QACrC7B,OAAO,CAACwC,GAAG,CAAC,qBAAqB,EAAES,cAAc,EAAE,KAAK,EAAEJ,QAAQ,CAAC;QAEnEjG,oBAAoB,CAACiF,OAAO,GAAG,IAAI;QACnC;;QAEA5E,QAAQ,CAACiG,SAAS,IAAI;UACpB,MAAMC,QAAQ,GAAG;YAAE,GAAGD,SAAS;YAAE,CAACL,QAAQ,GAAGC;UAAK,CAAC;;UAEnD;UACA,IAAID,QAAQ,KAAK3F,UAAU,IAAIR,SAAS,CAACmF,OAAO,EAAE;YAAA,IAAAuB,qBAAA;YAChD,MAAMC,KAAK,IAAAD,qBAAA,GAAG1G,SAAS,CAACmF,OAAO,CAACyB,MAAM,cAAAF,qBAAA,uBAAxBA,qBAAA,CAA2BP,QAAQ,CAAC;YAClD,IAAIQ,KAAK,IAAIA,KAAK,CAACE,QAAQ,CAAC,CAAC,KAAKT,IAAI,EAAE;cACtC;cACA,MAAMU,gBAAgB,GAAG9G,SAAS,CAACmF,OAAO,CAAC4B,YAAY,CAAC,CAAC;cACzD,MAAMC,UAAU,GAAGhH,SAAS,CAACmF,OAAO,CAAC8B,YAAY,CAAC,CAAC;;cAEnD;cACAN,KAAK,CAACO,QAAQ,CAACd,IAAI,CAAC;;cAEpB;cACA,IAAIU,gBAAgB,IAAI,CAACR,QAAQ,EAAE;gBACjCtG,SAAS,CAACmF,OAAO,CAACgC,YAAY,CAACL,gBAAgB,CAAC;gBAChD9G,SAAS,CAACmF,OAAO,CAACiC,YAAY,CAACJ,UAAU,CAAC;cAC5C;YACF;UACF;UAEA,OAAOP,QAAQ;QACjB,CAAC,CAAC;;QAGF;QACA5E,WAAW,CAACwF,QAAQ,IAAI;UACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;;UAE9B;UACA,MAAMC,OAAO,GAAGnE,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACiE,QAAQ,CAAC,CAAC;;UAEpD;UACA,MAAMG,iBAAiB,GAAIC,KAAK,IAAK;YACnC,KAAK,IAAIC,IAAI,IAAID,KAAK,EAAE;cACtB,IAAIC,IAAI,CAACtD,IAAI,KAAK+B,QAAQ,IAAIuB,IAAI,CAACvD,IAAI,KAAK,MAAM,EAAE;gBAClDuD,IAAI,CAAC5E,OAAO,GAAGsD,IAAI;gBACnB,OAAO,IAAI;cACb;cACA,IAAIsB,IAAI,CAACrD,QAAQ,IAAImD,iBAAiB,CAACE,IAAI,CAACrD,QAAQ,CAAC,EAAE;gBACrD,OAAO,IAAI;cACb;YACF;YACA,OAAO,KAAK;UACd,CAAC;UAEDmD,iBAAiB,CAACF,OAAO,CAACjD,QAAQ,CAAC;UACnC,OAAOiD,OAAO;QAChB,CAAC,CAAC;;QAEF;QACA,IAAIhB,QAAQ,EAAE;UACZnF,cAAc,CAACwG,IAAI,KAAK;YACtB,GAAGA,IAAI;YACP,CAACtB,MAAM,GAAG;cACR,GAAGsB,IAAI,CAACtB,MAAM,CAAC;cACfC,QAAQ;cACR9F,UAAU,EAAE2F,QAAQ;cACpB/F,QAAQ,EAAEmG;YACZ;UACF,CAAC,CAAC,CAAC;QACL;;QAEA;QACA,IAAIJ,QAAQ,KAAK3F,UAAU,EAAE;UAC3BS,cAAc,CAAC0G,IAAI,KAAK;YACtB,GAAGA,IAAI;YACP,CAACtB,MAAM,GAAG;cAAEjG,QAAQ,EAAEmG,cAAc;cAAEqB,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;YAAE;UAC9D,CAAC,CAAC,CAAC;QACL;QAEAC,UAAU,CAAC,MAAM;UACf7H,oBAAoB,CAACiF,OAAO,GAAG,KAAK;QACtC,CAAC,EAAE,GAAG,CAAC;MACT;IACF,CAAC,CAAC;IAEFE,MAAM,CAACM,EAAE,CAAC,cAAc,EAAE,CAAC;MAAEvB;IAAK,CAAC,KAAK;MACtC7D,QAAQ,CAACoH,IAAI,IAAI;QACf,MAAMlB,QAAQ,GAAG;UAAE,GAAGkB;QAAK,CAAC;QAC5B,OAAOlB,QAAQ,CAACrC,IAAI,CAAC;QACrB,OAAOqC,QAAQ;MACjB,CAAC,CAAC;MAEF5E,WAAW,CAACwF,QAAQ,IAAI;QACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;QAE9B,MAAMC,OAAO,GAAGnE,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACiE,QAAQ,CAAC,CAAC;QACpD,MAAMW,UAAU,GAAIP,KAAK,IAAK;UAC5B,KAAK,IAAIQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,KAAK,CAAChF,MAAM,EAAEwF,CAAC,EAAE,EAAE;YACrC,IAAIR,KAAK,CAACQ,CAAC,CAAC,CAAC7D,IAAI,KAAKA,IAAI,EAAE;cAC1BqD,KAAK,CAACS,MAAM,CAACD,CAAC,EAAE,CAAC,CAAC;cAClB,OAAO,IAAI;YACb;YACA,IAAIR,KAAK,CAACQ,CAAC,CAAC,CAAC5D,QAAQ,IAAI2D,UAAU,CAACP,KAAK,CAACQ,CAAC,CAAC,CAAC5D,QAAQ,CAAC,EAAE;cACtD,OAAO,IAAI;YACb;UACF;UACA,OAAO,KAAK;QACd,CAAC;QAED2D,UAAU,CAACV,OAAO,CAACjD,QAAQ,CAAC;QAC5B,OAAOiD,OAAO;MAChB,CAAC,CAAC;IACJ,CAAC,CAAC;IAEDjC,MAAM,CAACM,EAAE,CAAC,cAAc,EAAE,CAAC;MAAEwC,OAAO;MAAEC;IAAQ,CAAC,KAAK;MACnD7H,QAAQ,CAACoH,IAAI,IAAI;QACf,MAAMlB,QAAQ,GAAG;UAAE,GAAGkB;QAAK,CAAC;QAC5B,IAAIlB,QAAQ,CAAC0B,OAAO,CAAC,EAAE;UACrB1B,QAAQ,CAAC2B,OAAO,CAAC,GAAG3B,QAAQ,CAAC0B,OAAO,CAAC;UACrC,OAAO1B,QAAQ,CAAC0B,OAAO,CAAC;QAC1B;QACA,OAAO1B,QAAQ;MACjB,CAAC,CAAC;MAEF5E,WAAW,CAACwF,QAAQ,IAAI;QACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;QAE9B,MAAMC,OAAO,GAAGnE,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACiE,QAAQ,CAAC,CAAC;QACpD,MAAMgB,UAAU,GAAIZ,KAAK,IAAK;UAC5B,KAAK,IAAIC,IAAI,IAAID,KAAK,EAAE;YACtB,IAAIC,IAAI,CAACtD,IAAI,KAAK+D,OAAO,EAAE;cACzB,MAAMG,OAAO,GAAGF,OAAO,CAACG,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;cACxCd,IAAI,CAACxD,IAAI,GAAGoE,OAAO;cACnBZ,IAAI,CAACtD,IAAI,GAAGgE,OAAO;cACnB,OAAO,IAAI;YACb;YACA,IAAIV,IAAI,CAACrD,QAAQ,IAAIgE,UAAU,CAACX,IAAI,CAACrD,QAAQ,CAAC,EAAE;cAC9C,OAAO,IAAI;YACb;UACF;UACA,OAAO,KAAK;QACd,CAAC;QAEDgE,UAAU,CAACf,OAAO,CAACjD,QAAQ,CAAC;QAC5B,OAAOiD,OAAO;MAChB,CAAC,CAAC;MAEF,IAAI9G,UAAU,KAAK2H,OAAO,EAAE;QAC1B1H,aAAa,CAAC2H,OAAO,CAAC;MACxB;IACF,CAAC,CAAC;IACF/C,MAAM,CAACM,EAAE,CAAC,gBAAgB,EAAE,CAAC;MAAEwC,OAAO;MAAEC;IAAQ,CAAC,KAAK;MACpD;MACA7H,QAAQ,CAACoH,IAAI,IAAI;QACf,MAAMc,OAAO,GAAG,CAAC,CAAC;QAClB,KAAK,MAAMC,GAAG,IAAIf,IAAI,EAAE;UACtB,IAAIe,GAAG,CAACC,UAAU,CAACR,OAAO,CAAC,EAAE;YAC3B,MAAMS,MAAM,GAAGF,GAAG,CAACG,OAAO,CAACV,OAAO,EAAEC,OAAO,CAAC;YAC5CK,OAAO,CAACG,MAAM,CAAC,GAAGjB,IAAI,CAACe,GAAG,CAAC;UAC7B,CAAC,MAAM;YACLD,OAAO,CAACC,GAAG,CAAC,GAAGf,IAAI,CAACe,GAAG,CAAC;UAC1B;QACF;QACA,OAAOD,OAAO;MAChB,CAAC,CAAC;;MAEF;MACA5G,WAAW,CAACwF,QAAQ,IAAI;QACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;QAC9B,MAAMC,OAAO,GAAGnE,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACiE,QAAQ,CAAC,CAAC;QAEpD,MAAMyB,WAAW,GAAIrB,KAAK,IAAK;UAC7BA,KAAK,CAAC9C,OAAO,CAAE+C,IAAI,IAAK;YACtB,IAAIA,IAAI,CAACtD,IAAI,CAACuE,UAAU,CAACR,OAAO,CAAC,EAAE;cACjCT,IAAI,CAACtD,IAAI,GAAGsD,IAAI,CAACtD,IAAI,CAACyE,OAAO,CAACV,OAAO,EAAEC,OAAO,CAAC;cAC/C,IAAIV,IAAI,CAACvD,IAAI,KAAK,QAAQ,EAAE;gBAC1BuD,IAAI,CAACxD,IAAI,GAAGkE,OAAO,CAACS,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAACN,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;cACzD;YACF;YACA,IAAId,IAAI,CAACrD,QAAQ,EAAEyE,WAAW,CAACpB,IAAI,CAACrD,QAAQ,CAAC;UAC/C,CAAC,CAAC;QACJ,CAAC;QAEDyE,WAAW,CAACxB,OAAO,CAACjD,QAAQ,CAAC;QAC7B,OAAOiD,OAAO;MAChB,CAAC,CAAC;IACJ,CAAC,CAAC;IACFjC,MAAM,CAACM,EAAE,CAAC,gBAAgB,EAAE,CAAC;MAAEvB;IAAK,CAAC,KAAK;MACxC7D,QAAQ,CAACoH,IAAI,IAAI;QACf,MAAMc,OAAO,GAAG,CAAC,CAAC;QAClB,KAAK,MAAMC,GAAG,IAAIf,IAAI,EAAE;UACtB,IAAI,CAACe,GAAG,CAACC,UAAU,CAACvE,IAAI,CAAC,EAAE;YACzBqE,OAAO,CAACC,GAAG,CAAC,GAAGf,IAAI,CAACe,GAAG,CAAC;UAC1B;QACF;QACA,OAAOD,OAAO;MAChB,CAAC,CAAC;MAEF5G,WAAW,CAACwF,QAAQ,IAAI;QACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;QAC9B,MAAMC,OAAO,GAAGnE,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACiE,QAAQ,CAAC,CAAC;QAEpD,MAAM0B,YAAY,GAAItB,KAAK,IAAK;UAC9B,KAAK,IAAIQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,KAAK,CAAChF,MAAM,EAAEwF,CAAC,EAAE,EAAE;YACrC,IAAIR,KAAK,CAACQ,CAAC,CAAC,CAAC7D,IAAI,KAAKA,IAAI,EAAE;cAC1BqD,KAAK,CAACS,MAAM,CAACD,CAAC,EAAE,CAAC,CAAC;cAClB,OAAO,IAAI;YACb;YACA,IAAIR,KAAK,CAACQ,CAAC,CAAC,CAAC5D,QAAQ,IAAI0E,YAAY,CAACtB,KAAK,CAACQ,CAAC,CAAC,CAAC5D,QAAQ,CAAC,EAAE;cACxD,OAAO,IAAI;YACb;UACF;UACA,OAAO,KAAK;QACd,CAAC;QAED0E,YAAY,CAACzB,OAAO,CAACjD,QAAQ,CAAC;QAC9B,OAAOiD,OAAO;MAChB,CAAC,CAAC;IACJ,CAAC,CAAC;IAEEjC,MAAM,CAACM,EAAE,CAAC,aAAa,EAAE,CAAC;MAAEvD,MAAM;MAAEhC,QAAQ,EAAE4I;IAAY,CAAC,KAAK;MAC9D1F,OAAO,CAACwC,GAAG,CAAC,iBAAiB,EAAEkD,WAAW,CAAC;MAC3CnI,QAAQ,CAAC8G,IAAI,IAAI;QACf,MAAMsB,MAAM,GAAGtB,IAAI,CAACuB,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACpD,EAAE,KAAK3D,MAAM,CAAC;QAC9C,IAAI,CAAC6G,MAAM,EAAE;UACX,OAAO,CAAC,GAAGtB,IAAI,EAAE;YAAE5B,EAAE,EAAE3D,MAAM;YAAEhC,QAAQ,EAAE4I;UAAY,CAAC,CAAC;QACzD;QACA,OAAOrB,IAAI;MACb,CAAC,CAAC;IACJ,CAAC,CAAC;IAEFtC,MAAM,CAACM,EAAE,CAAC,WAAW,EAAE,CAAC;MAAEvD,MAAM;MAAEhC,QAAQ,EAAEgJ;IAAa,CAAC,KAAK;MAC7D9F,OAAO,CAACwC,GAAG,CAAC,eAAe,EAAEsD,YAAY,CAAC;MAC1CvI,QAAQ,CAAC8G,IAAI,IAAIA,IAAI,CAAC0B,MAAM,CAACF,CAAC,IAAIA,CAAC,CAACpD,EAAE,KAAK3D,MAAM,CAAC,CAAC;MACnDrB,cAAc,CAAC4G,IAAI,IAAI;QACrB,MAAM2B,SAAS,GAAG;UAAE,GAAG3B;QAAK,CAAC;QAC7B,OAAO2B,SAAS,CAAClH,MAAM,CAAC;QACxB,OAAOkH,SAAS;MAClB,CAAC,CAAC;MACFnI,cAAc,CAACwG,IAAI,IAAI;QACrB,MAAM4B,UAAU,GAAG;UAAE,GAAG5B;QAAK,CAAC;QAC9B,OAAO4B,UAAU,CAACnH,MAAM,CAAC;QACzB,OAAOmH,UAAU;MACnB,CAAC,CAAC;MACFtI,cAAc,CAAC0G,IAAI,IAAI;QACrB,MAAM6B,SAAS,GAAG;UAAE,GAAG7B;QAAK,CAAC;QAC7B,OAAO6B,SAAS,CAACpH,MAAM,CAAC;QACxB,OAAOoH,SAAS;MAClB,CAAC,CAAC;IACJ,CAAC,CAAC;IAEFnE,MAAM,CAACM,EAAE,CAAC,iBAAiB,EAAE,CAAC;MAAEvD,MAAM;MAAEhC,QAAQ,EAAEqJ,cAAc;MAAEnD,QAAQ;MAAE9F,UAAU,EAAEkJ;IAAe,CAAC,KAAK;MAC3G,IAAItH,MAAM,KAAKrC,cAAc,CAACoF,OAAO,IAAIuE,cAAc,KAAKlJ,UAAU,EAAE;QACtEW,cAAc,CAACwG,IAAI,KAAK;UACtB,GAAGA,IAAI;UACP,CAACvF,MAAM,GAAG;YACRkE,QAAQ;YACR9F,UAAU,EAAEkJ,cAAc;YAC1BtJ,QAAQ,EAAEqJ,cAAc;YACxB7B,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;UACtB;QACF,CAAC,CAAC,CAAC;MACL;IACF,CAAC,CAAC;IAEFzC,MAAM,CAACM,EAAE,CAAC,aAAa,EAAE,CAAC;MAAEvD,MAAM;MAAEhC,QAAQ,EAAEuJ,cAAc;MAAExD;IAAS,CAAC,KAAK;MAC3E,IAAI/D,MAAM,KAAKrC,cAAc,CAACoF,OAAO,IAAIgB,QAAQ,KAAK3F,UAAU,EAAE;QAChES,cAAc,CAAC0G,IAAI,KAAK;UACtB,GAAGA,IAAI;UACP,CAACvF,MAAM,GAAG;YAAEhC,QAAQ,EAAEuJ,cAAc;YAAE/B,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;UAAE;QAC9D,CAAC,CAAC,CAAC;MACL;IACF,CAAC,CAAC;IACN;IACAzC,MAAM,CAACM,EAAE,CAAC,qBAAqB,EAAE,CAAC;MAAEQ,QAAQ;MAAErD;IAAQ,CAAC,KAAK;MAC1DvC,QAAQ,CAACoH,IAAI,KAAK;QAAE,GAAGA,IAAI;QAAE,CAACxB,QAAQ,GAAGrD;MAAQ,CAAC,CAAC,CAAC;MAEpDjB,WAAW,CAACwF,QAAQ,IAAI;QACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;QAE9B,MAAMC,OAAO,GAAGnE,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACiE,QAAQ,CAAC,CAAC,CAAC,CAAC;QACtD,MAAMuC,KAAK,GAAGzD,QAAQ,CAACoC,KAAK,CAAC,GAAG,CAAC;QACjC,MAAMsB,QAAQ,GAAGD,KAAK,CAACpB,GAAG,CAAC,CAAC,CAAC,CAAC;QAC9B,MAAMsB,eAAe,GAAGF,KAAK;QAE7B,IAAIzE,OAAO,GAAGmC,OAAO;QAErB,KAAK,MAAMyC,IAAI,IAAID,eAAe,EAAE;UAClC,IAAIE,MAAM,GAAG7E,OAAO,CAACd,QAAQ,CAAC6E,IAAI,CAChCnE,KAAK,IAAIA,KAAK,CAACb,IAAI,KAAK6F,IAAI,IAAIhF,KAAK,CAACZ,IAAI,KAAK,QACjD,CAAC;UACD,IAAI,CAAC6F,MAAM,EAAE;YACXA,MAAM,GAAG;cACP9F,IAAI,EAAE6F,IAAI;cACV5F,IAAI,EAAE,QAAQ;cACdC,IAAI,EAAE,CAACe,OAAO,CAACf,IAAI,IAAI,EAAE,IAAI2F,IAAI,GAAG,GAAG;cACvC1F,QAAQ,EAAE;YACZ,CAAC;YACDc,OAAO,CAACd,QAAQ,CAACW,IAAI,CAACgF,MAAM,CAAC;UAC/B;UACA7E,OAAO,GAAG6E,MAAM;QAClB;;QAEA;QACA7E,OAAO,CAACd,QAAQ,CAACW,IAAI,CAAC;UACpBd,IAAI,EAAE2F,QAAQ;UACd1F,IAAI,EAAE,MAAM;UACZC,IAAI,EAAE+B,QAAQ;UACdrD;QACF,CAAC,CAAC;QAEF,OAAOwE,OAAO;MAChB,CAAC,CAAC;IACJ,CAAC,CAAC;;IAEF;IACAjC,MAAM,CAACM,EAAE,CAAC,uBAAuB,EAAE,CAAC;MAAEvB;IAAK,CAAC,KAAK;MAC/CvC,WAAW,CAACwF,QAAQ,IAAI;QACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;QAC9B,MAAM4B,MAAM,GAAG5B,QAAQ,CAAChD,QAAQ,CAACS,IAAI,CAACC,KAAK,IAAIA,KAAK,CAACX,IAAI,KAAKA,IAAI,CAAC;QACnE,IAAI,CAAC6E,MAAM,EAAE;UACX,OAAO;YACL,GAAG5B,QAAQ;YACXhD,QAAQ,EAAE,CACR,GAAGgD,QAAQ,CAAChD,QAAQ,EACpB;cACEH,IAAI,EAAEE,IAAI,CAACyE,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAACN,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;cAC9CrE,IAAI,EAAE,QAAQ;cACdC,IAAI;cACJC,QAAQ,EAAE;YACZ,CAAC;UAEL,CAAC;QACH;QACA,OAAOgD,QAAQ;MACjB,CAAC,CAAC;IACJ,CAAC,CAAC;IAEExH,SAAS,CAACsF,OAAO,GAAGE,MAAM;IAC1B,OAAOA,MAAM;EACf,CAAC,EAAE,CAACjF,QAAQ,EAAEV,MAAM,EAAEc,UAAU,EAAEF,KAAK,EAACV,QAAQ,CAAC,CAAC;;EAElD;EACAlB,SAAS,CAAC,MAAM;IACd,MAAMuL,QAAQ,GAAGC,WAAW,CAAC,MAAM;MACjC,MAAMpC,GAAG,GAAGD,IAAI,CAACC,GAAG,CAAC,CAAC;MACtB7G,cAAc,CAAC0G,IAAI,IAAI;QACrB,MAAMc,OAAO,GAAG;UAAE,GAAGd;QAAK,CAAC;QAC3BrF,MAAM,CAACC,IAAI,CAACkG,OAAO,CAAC,CAAC9D,OAAO,CAACvC,MAAM,IAAI;UACrC,IAAI0F,GAAG,GAAGW,OAAO,CAACrG,MAAM,CAAC,CAACwF,SAAS,GAAG,IAAI,EAAE;YAC1C,OAAOa,OAAO,CAACrG,MAAM,CAAC;UACxB;QACF,CAAC,CAAC;QACF,OAAOqG,OAAO;MAChB,CAAC,CAAC;IACJ,CAAC,EAAE,IAAI,CAAC;IAER,OAAO,MAAM0B,aAAa,CAACF,QAAQ,CAAC;EACtC,CAAC,EAAE,EAAE,CAAC;EAERvL,SAAS,CAAC,MAAM;IACd,IAAI,CAACmB,SAAS,CAACsF,OAAO,EAAE;IAExB,MAAME,MAAM,GAAGxF,SAAS,CAACsF,OAAO;IAEhCE,MAAM,CAACM,EAAE,CAAC,cAAc,EAAE,CAAC;MAAEvB;IAAK,CAAC,KAAK;MACtC7D,QAAQ,CAACoH,IAAI,IAAI;QACf,MAAMlB,QAAQ,GAAG;UAAE,GAAGkB;QAAK,CAAC;QAC5B,OAAOlB,QAAQ,CAACrC,IAAI,CAAC;QACrB,OAAOqC,QAAQ;MACjB,CAAC,CAAC;MAEF5E,WAAW,CAACwF,QAAQ,IAAI;QACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;QAC9B,MAAMC,OAAO,GAAGnE,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACiE,QAAQ,CAAC,CAAC;QACpD,MAAMW,UAAU,GAAIP,KAAK,IAAK;UAC5B,KAAK,IAAIQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,KAAK,CAAChF,MAAM,EAAEwF,CAAC,EAAE,EAAE;YACrC,IAAIR,KAAK,CAACQ,CAAC,CAAC,CAAC7D,IAAI,KAAKA,IAAI,EAAE;cAC1BqD,KAAK,CAACS,MAAM,CAACD,CAAC,EAAE,CAAC,CAAC;cAClB,OAAO,IAAI;YACb;YACA,IAAIR,KAAK,CAACQ,CAAC,CAAC,CAAC5D,QAAQ,IAAI2D,UAAU,CAACP,KAAK,CAACQ,CAAC,CAAC,CAAC5D,QAAQ,CAAC,EAAE;cACtD,OAAO,IAAI;YACb;UACF;UACA,OAAO,KAAK;QACd,CAAC;QACD2D,UAAU,CAACV,OAAO,CAACjD,QAAQ,CAAC;QAC5B,OAAOiD,OAAO;MAChB,CAAC,CAAC;IACJ,CAAC,CAAC;IAEFjC,MAAM,CAACM,EAAE,CAAC,cAAc,EAAE,CAAC;MAAEwC,OAAO;MAAEC;IAAQ,CAAC,KAAK;MAClD7H,QAAQ,CAACoH,IAAI,IAAI;QACf,MAAMlB,QAAQ,GAAG;UAAE,GAAGkB;QAAK,CAAC;QAC5B,IAAIlB,QAAQ,CAAC0B,OAAO,CAAC,EAAE;UACrB1B,QAAQ,CAAC2B,OAAO,CAAC,GAAG3B,QAAQ,CAAC0B,OAAO,CAAC;UACrC,OAAO1B,QAAQ,CAAC0B,OAAO,CAAC;QAC1B;QACA,OAAO1B,QAAQ;MACjB,CAAC,CAAC;MAEF5E,WAAW,CAACwF,QAAQ,IAAI;QACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;QAC9B,MAAMC,OAAO,GAAGnE,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACiE,QAAQ,CAAC,CAAC;QACpD,MAAMgB,UAAU,GAAIZ,KAAK,IAAK;UAC5B,KAAK,IAAIC,IAAI,IAAID,KAAK,EAAE;YACtB,IAAIC,IAAI,CAACtD,IAAI,KAAK+D,OAAO,EAAE;cACzB,MAAMG,OAAO,GAAGF,OAAO,CAACG,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;cACxCd,IAAI,CAACxD,IAAI,GAAGoE,OAAO;cACnBZ,IAAI,CAACtD,IAAI,GAAGgE,OAAO;cACnB,OAAO,IAAI;YACb;YACA,IAAIV,IAAI,CAACrD,QAAQ,IAAIgE,UAAU,CAACX,IAAI,CAACrD,QAAQ,CAAC,EAAE;cAC9C,OAAO,IAAI;YACb;UACF;UACA,OAAO,KAAK;QACd,CAAC;QACDgE,UAAU,CAACf,OAAO,CAACjD,QAAQ,CAAC;QAC5B,OAAOiD,OAAO;MAChB,CAAC,CAAC;MAEF,IAAI9G,UAAU,KAAK2H,OAAO,EAAE;QAC1B1H,aAAa,CAAC2H,OAAO,CAAC;MACxB;IACF,CAAC,CAAC;IAEF,OAAO,MAAM;MACX/C,MAAM,CAAC+E,GAAG,CAAC,cAAc,CAAC;MAC1B/E,MAAM,CAAC+E,GAAG,CAAC,cAAc,CAAC;IAC5B,CAAC;EACH,CAAC,EAAE,CAAC5J,UAAU,CAAC,CAAC;EAChB9B,SAAS,CAAC,MAAM;IACd,IAAI,CAACmB,SAAS,CAACsF,OAAO,EAAE;IACxB,MAAME,MAAM,GAAGxF,SAAS,CAACsF,OAAO;;IAEhC;IACAE,MAAM,CAACM,EAAE,CAAC,gBAAgB,EAAE,CAAC;MAAEwC,OAAO;MAAEC;IAAQ,CAAC,KAAK;MACpD7H,QAAQ,CAACoH,IAAI,IAAI;QACf,MAAMc,OAAO,GAAG,CAAC,CAAC;QAClB,KAAK,MAAMC,GAAG,IAAIf,IAAI,EAAE;UACtB,IAAIe,GAAG,CAACC,UAAU,CAACR,OAAO,CAAC,EAAE;YAC3B,MAAMkC,UAAU,GAAG3B,GAAG,CAACG,OAAO,CAACV,OAAO,EAAEC,OAAO,CAAC;YAChDK,OAAO,CAAC4B,UAAU,CAAC,GAAG1C,IAAI,CAACe,GAAG,CAAC;UACjC,CAAC,MAAM;YACLD,OAAO,CAACC,GAAG,CAAC,GAAGf,IAAI,CAACe,GAAG,CAAC;UAC1B;QACF;QACA,OAAOD,OAAO;MAChB,CAAC,CAAC;MAEF5G,WAAW,CAAC8F,IAAI,IAAI;QAClB,IAAI,CAACA,IAAI,EAAE,OAAOA,IAAI;QACtB,MAAMrD,IAAI,GAAGnB,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACuE,IAAI,CAAC,CAAC;QAC7C,MAAMmB,WAAW,GAAIrB,KAAK,IAAK;UAC7BA,KAAK,CAAC9C,OAAO,CAAC+C,IAAI,IAAI;YACpB,IAAIA,IAAI,CAACtD,IAAI,CAACuE,UAAU,CAACR,OAAO,CAAC,EAAE;cACjCT,IAAI,CAACtD,IAAI,GAAGsD,IAAI,CAACtD,IAAI,CAACyE,OAAO,CAACV,OAAO,EAAEC,OAAO,CAAC;cAC/C,IAAIV,IAAI,CAACvD,IAAI,KAAK,QAAQ,EAAE;gBAC1BuD,IAAI,CAACxD,IAAI,GAAGkE,OAAO,CAACS,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAACN,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;cACzD;YACF;YACA,IAAId,IAAI,CAACrD,QAAQ,EAAEyE,WAAW,CAACpB,IAAI,CAACrD,QAAQ,CAAC;UAC/C,CAAC,CAAC;QACJ,CAAC;QACDyE,WAAW,CAACxE,IAAI,CAACD,QAAQ,CAAC;QAC1B,OAAOC,IAAI;MACb,CAAC,CAAC;IACJ,CAAC,CAAC;;IAEF;IACAe,MAAM,CAACM,EAAE,CAAC,gBAAgB,EAAE,CAAC;MAAEvB;IAAK,CAAC,KAAK;MACxC7D,QAAQ,CAACoH,IAAI,IAAI;QACf,MAAMc,OAAO,GAAG,CAAC,CAAC;QAClB,KAAK,MAAMC,GAAG,IAAIf,IAAI,EAAE;UACtB,IAAI,CAACe,GAAG,CAACC,UAAU,CAACvE,IAAI,CAAC,EAAE;YACzBqE,OAAO,CAACC,GAAG,CAAC,GAAGf,IAAI,CAACe,GAAG,CAAC;UAC1B;QACF;QACA,OAAOD,OAAO;MAChB,CAAC,CAAC;MAEF5G,WAAW,CAAC8F,IAAI,IAAI;QAClB,IAAI,CAACA,IAAI,EAAE,OAAOA,IAAI;QACtB,MAAMrD,IAAI,GAAGnB,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACuE,IAAI,CAAC,CAAC;QAC7C,MAAMoB,YAAY,GAAItB,KAAK,IAAK;UAC9B,KAAK,IAAIQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,KAAK,CAAChF,MAAM,EAAEwF,CAAC,EAAE,EAAE;YACrC,IAAIR,KAAK,CAACQ,CAAC,CAAC,CAAC7D,IAAI,KAAKA,IAAI,EAAE;cAC1BqD,KAAK,CAACS,MAAM,CAACD,CAAC,EAAE,CAAC,CAAC;cAClB,OAAO,IAAI;YACb;YACA,IAAIR,KAAK,CAACQ,CAAC,CAAC,CAAC5D,QAAQ,IAAI0E,YAAY,CAACtB,KAAK,CAACQ,CAAC,CAAC,CAAC5D,QAAQ,CAAC,EAAE;cACxD,OAAO,IAAI;YACb;UACF;UACA,OAAO,KAAK;QACd,CAAC;QACD0E,YAAY,CAACzE,IAAI,CAACD,QAAQ,CAAC;QAC3B,OAAOC,IAAI;MACb,CAAC,CAAC;IACJ,CAAC,CAAC;IAEF,OAAO,MAAM;MACXe,MAAM,CAAC+E,GAAG,CAAC,gBAAgB,CAAC;MAC5B/E,MAAM,CAAC+E,GAAG,CAAC,gBAAgB,CAAC;IAC9B,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;;EAEJ;EACA1L,SAAS,CAAC,MAAM;IACd,IAAI,CAACgB,MAAM,EAAE;MACXE,QAAQ,CAAC,OAAO,CAAC;MACjB;IACF;IAEA,IAAIE,cAAc,CAACqF,OAAO,EAAE;IAC5BrF,cAAc,CAACqF,OAAO,GAAG,IAAI;IAE7B,MAAMmF,IAAI,GAAI3K,QAAQ,CAAC4K,KAAK,IAAI5K,QAAQ,CAAC4K,KAAK,CAACnK,QAAQ,IAC1CoK,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,IAChC,OAAO;IACpBpK,WAAW,CAACiK,IAAI,CAAC;IAEnB,MAAMI,UAAU,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI;QACF;QACA,MAAM;UAAEpK,KAAK,EAAE4E,SAAS;UAAEZ;QAAK,CAAC,GAAG,MAAMd,UAAU,CAAC,CAAC;;QAErD;QACAjD,QAAQ,CAAC2E,SAAS,CAAC;QACnBrD,WAAW,CAACyC,IAAI,CAAC,CAAC,CAAC;;QAEnB;QACAW,gBAAgB,CAACC,SAAS,CAAC;;QAE3B;QACAsF,YAAY,CAACG,OAAO,CAAC,UAAU,EAAEL,IAAI,CAAC;;QAEtC;QACA,IAAI,CAAC9J,UAAU,EAAE;UACfC,aAAa,CAAC,YAAY,CAAC;QAC7B;MACF,CAAC,CAAC,OAAO8C,KAAK,EAAE;QACdD,OAAO,CAACC,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;QAC7C5C,mBAAmB,CAAC,uBAAuB,CAAC;MAC9C;IACF,CAAC;IAEG+J,UAAU,CAAC,CAAC;IAEZ,OAAO,MAAM;MACX,IAAI7K,SAAS,CAACsF,OAAO,EAAE;QACrBtF,SAAS,CAACsF,OAAO,CAACC,UAAU,CAAC,CAAC;MAChC;IACF,CAAC;EACH,CAAC,EAAE,CAAC1F,MAAM,EAAEE,QAAQ,EAAED,QAAQ,CAAC4K,KAAK,EAAE/G,UAAU,EAAEyB,gBAAgB,EAACzE,UAAU,CAAC,CAAC;;EAE/E;EACA9B,SAAS,CAAC,MAAM;IAAA,IAAAkM,kBAAA;IACd,IAAI,CAAC5K,SAAS,CAACmF,OAAO,IAAI,GAAAyF,kBAAA,GAAC/K,SAAS,CAACsF,OAAO,cAAAyF,kBAAA,eAAjBA,kBAAA,CAAmBC,SAAS,GAAE;IAEzD,MAAMC,MAAM,GAAG9K,SAAS,CAACmF,OAAO;IAEhC,MAAM4F,kBAAkB,GAAGA,CAAA,KAAM;MAC/B,IAAI7K,oBAAoB,CAACiF,OAAO,EAAE;MAElC,MAAM6F,SAAS,GAAGF,MAAM,CAAC/D,YAAY,CAAC,CAAC;MACvC,IAAIiE,SAAS,EAAE;QACb,MAAM1E,QAAQ,GAAG;UACf2E,UAAU,EAAED,SAAS,CAACE,kBAAkB;UACxCC,MAAM,EAAEH,SAAS,CAACI;QACpB,CAAC;QAEDvL,SAAS,CAACsF,OAAO,CAACa,IAAI,CAAC,iBAAiB,EAAE;UACxCtG,MAAM;UACNyG,QAAQ,EAAE3F,UAAU;UACpB8F,QAAQ;UACRlG;QACF,CAAC,CAAC;MACJ;IACF,CAAC;IAED,MAAMiL,UAAU,GAAGP,MAAM,CAACQ,yBAAyB,CAACP,kBAAkB,CAAC;IACvE,OAAO,MAAMM,UAAU,CAACE,OAAO,CAAC,CAAC;EACnC,CAAC,EAAE,CAAC7L,MAAM,EAAEc,UAAU,EAAEJ,QAAQ,CAAC,CAAC;;EAElC;;EAEF,MAAMoL,eAAe,GAAE3M,WAAW,CAAE4M,CAAC,IAAK;IACxC,IAAI,CAACzJ,UAAU,EAAE;IAEjB,MAAM0J,SAAS,GAAGC,QAAQ,CAACC,aAAa,CAAC,cAAc,CAAC;IACxD,IAAI,CAACF,SAAS,EAAE;IAEhB,MAAMG,aAAa,GAAGH,SAAS,CAACI,qBAAqB,CAAC,CAAC;IACvD,MAAMC,cAAc,GAAGF,aAAa,CAACG,KAAK;IAC1C,MAAMC,MAAM,GAAGR,CAAC,CAACS,OAAO,GAAGL,aAAa,CAACM,IAAI;IAC7C,MAAMC,QAAQ,GAAIH,MAAM,GAAGF,cAAc,GAAI,GAAG;;IAEhD;IACAhK,aAAa,CAACsK,IAAI,CAACC,GAAG,CAACD,IAAI,CAACE,GAAG,CAACH,QAAQ,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;EACrD,CAAC,EAAC,CAACpK,UAAU,CAAC,CAAC;EACf,MAAMwK,aAAa,GAAE3N,WAAW,CAAE,MAAM;IACtCoD,aAAa,CAAC,KAAK,CAAC;IACpB0J,QAAQ,CAACzI,IAAI,CAACuJ,KAAK,CAACC,MAAM,GAAG,EAAE;IAC/Bf,QAAQ,CAACgB,mBAAmB,CAAC,WAAW,EAAEnB,eAAe,CAAC;IAC1DG,QAAQ,CAACgB,mBAAmB,CAAC,SAAS,EAAEH,aAAa,CAAC;EACxD,CAAC,EAAC,CAAChB,eAAe,CAAC,CAAC;EACpB;EACA9M,SAAS,CAAC,MAAM;IACd,OAAO,MAAM;MACXiN,QAAQ,CAACgB,mBAAmB,CAAC,WAAW,EAAEnB,eAAe,CAAC;MAC1DG,QAAQ,CAACgB,mBAAmB,CAAC,SAAS,EAAEH,aAAa,CAAC;IACxD,CAAC;EACH,CAAC,EAAE,CAAChB,eAAe,EAAEgB,aAAa,CAAC,CAAC;EAElC,MAAMI,eAAe,GAAG/N,WAAW,CAAE4M,CAAC,IAAK;IACzCA,CAAC,CAACoB,cAAc,CAAC,CAAC;IACpB5K,aAAa,CAAC,IAAI,CAAC;IACnB0J,QAAQ,CAACzI,IAAI,CAACuJ,KAAK,CAACC,MAAM,GAAG,YAAY;IACzCf,QAAQ,CAACmB,gBAAgB,CAAC,WAAW,EAAEtB,eAAe,CAAC;IACvDG,QAAQ,CAACmB,gBAAgB,CAAC,SAAS,EAAEN,aAAa,CAAC;EACrD,CAAC,EAAC,CAAChB,eAAe,EAAEgB,aAAa,CAAC,CAAC;EAEjC,MAAMO,gBAAgB,GAAGlO,WAAW,CAAEmO,KAAK,IAAK;IAC9C,IAAI,CAACA,KAAK,EAAEA,KAAK,GAAG,EAAE;IACtB,IAAI9M,oBAAoB,CAACiF,OAAO,EAAE;IAElC,MAAMyC,SAAS,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IAC5B3H,mBAAmB,CAACgF,OAAO,GAAGyC,SAAS;IAEvCrH,QAAQ,CAACoH,IAAI,IAAI;MACf,IAAIA,IAAI,CAACnH,UAAU,CAAC,KAAKwM,KAAK,EAAE;QAAA,IAAAC,mBAAA,EAAAC,qBAAA;QAC9B,MAAMzG,QAAQ,GAAG;UAAE,GAAGkB,IAAI;UAAE,CAACnH,UAAU,GAAGwM;QAAM,CAAC;QAEjD,KAAAC,mBAAA,GAAIpN,SAAS,CAACsF,OAAO,cAAA8H,mBAAA,eAAjBA,mBAAA,CAAmBpC,SAAS,EAAE;UAAA,IAAAsC,kBAAA;UAChC,MAAMnC,SAAS,IAAAmC,kBAAA,GAAGnN,SAAS,CAACmF,OAAO,cAAAgI,kBAAA,uBAAjBA,kBAAA,CAAmBpG,YAAY,CAAC,CAAC;UACnD,MAAMT,QAAQ,GAAG0E,SAAS,GAAG;YAC3BC,UAAU,EAAED,SAAS,CAACE,kBAAkB;YACxCC,MAAM,EAAEH,SAAS,CAACI;UACpB,CAAC,GAAG,IAAI;;UAER;UACAvL,SAAS,CAACsF,OAAO,CAACa,IAAI,CAAC,aAAa,EAAE;YACpCtG,MAAM;YACNyG,QAAQ,EAAE3F,UAAU;YACpB4F,IAAI,EAAE4G,KAAK;YACX1G,QAAQ;YACRsB,SAAS;YACTxH;UACF,CAAC,CAAC;;UAEF;UACAP,SAAS,CAACsF,OAAO,CAACa,IAAI,CAAC,aAAa,EAAE;YACpCtG,MAAM;YACNyG,QAAQ,EAAE3F,UAAU;YACpBJ;UACF,CAAC,CAAC;QACJ;;QAEA;QACA;QACA,CAAA8M,qBAAA,GAAAxK,gBAAgB,CAACyC,OAAO,cAAA+H,qBAAA,uBAAxBA,qBAAA,CAAAE,IAAA,CAAA1K,gBAAgB,EAAWhD,MAAM,EAAEc,UAAU,EAAEwM,KAAK,CAAC;QACrD,OAAOvG,QAAQ;MACjB;MACA,OAAOkB,IAAI;IACb,CAAC,CAAC;EACJ,CAAC,EAAE,CAACnH,UAAU,EAAEd,MAAM,EAAEiD,aAAa,EAAEvC,QAAQ,CAAC,CAAC;EACnD,MAAMiN,aAAa,GAAGA,CAAA,KAAM;IAC1BhM,mBAAmB,CAAC,IAAI,CAAC;EAC3B,CAAC;EAED,MAAMiM,eAAe,GAAGA,CAAA,KAAM;IAC5B/L,qBAAqB,CAAC,IAAI,CAAC;EAC7B,CAAC;EACD,MAAMgM,aAAa,GAAG,MAAAA,CAAA,KAAY;IAChC,IAAI,CAAC/L,WAAW,EAAE;IAElB,MAAMgM,OAAO,GAAGhM,WAAW,CAAC+G,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;IAC5C,IAAIiF,cAAc,GAAG,EAAE;IAEvB,IAAID,OAAO,KAAK,MAAM,EAAE;MACtBC,cAAc,GAAG,uGAAuG;IAC1H,CAAC,MAAM,IAAID,OAAO,KAAK,KAAK,EAAE;MAC5BC,cAAc,GAAG,qBAAqB;IACxC,CAAC,MAAM,IAAID,OAAO,KAAK,IAAI,EAAE;MAC3BC,cAAc,GAAG,yBAAyB;IAC5C;IAEA,IAAI;MAAA,IAAAC,mBAAA,EAAAC,mBAAA;MACF;MACA,MAAM5K,KAAK,CAAC,qCAAqC,EAAE;QACjDC,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/CC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnB1D,MAAM;UACNyG,QAAQ,EAAE3E,WAAW;UACrBsB,OAAO,EAAE2K;QACX,CAAC;MACH,CAAC,CAAC;;MAEF;MACAlN,QAAQ,CAACoH,IAAI,KAAK;QAAE,GAAGA,IAAI;QAAE,CAACnG,WAAW,GAAGiM;MAAe,CAAC,CAAC,CAAC;MAE9D5L,WAAW,CAACwF,QAAQ,IAAI;QACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;;QAE9B;QACA,MAAM4B,MAAM,GAAG5B,QAAQ,CAAChD,QAAQ,CAACS,IAAI,CAACC,KAAK,IACzCA,KAAK,CAACX,IAAI,KAAK5C,WACjB,CAAC;QAED,IAAI,CAACyH,MAAM,EAAE;UACX,OAAO;YACL,GAAG5B,QAAQ;YACXhD,QAAQ,EAAE,CACR,GAAGgD,QAAQ,CAAChD,QAAQ,EACpB;cACEH,IAAI,EAAE1C,WAAW;cACjB2C,IAAI,EAAE,MAAM;cACZC,IAAI,EAAE5C,WAAW;cACjBsB,OAAO,EAAE2K;YACX,CAAC;UAEL,CAAC;QACH;QACA,OAAOpG,QAAQ;MACjB,CAAC,CAAC;MACE,KAAAqG,mBAAA,GAAI7N,SAAS,CAACsF,OAAO,cAAAuI,mBAAA,eAAjBA,mBAAA,CAAmB7C,SAAS,EAAE;QACpChL,SAAS,CAACsF,OAAO,CAACa,IAAI,CAAC,kBAAkB,EAAE;UACzCtG,MAAM;UACNyG,QAAQ,EAAE3E,WAAW;UACrBsB,OAAO,EAAE2K,cAAc;UACvBrN;QACF,CAAC,CAAC;MACJ;MAEAK,aAAa,CAACe,WAAW,CAAC;MAC1BH,mBAAmB,CAAC,KAAK,CAAC;MAC1BI,cAAc,CAAC,EAAE,CAAC;;MAElB;MACA,KAAAkM,mBAAA,GAAI9N,SAAS,CAACsF,OAAO,cAAAwI,mBAAA,eAAjBA,mBAAA,CAAmB9C,SAAS,EAAE;QAChChL,SAAS,CAACsF,OAAO,CAACa,IAAI,CAAC,aAAa,EAAE;UACpCtG,MAAM;UACNyG,QAAQ,EAAE3E,WAAW;UACrB4E,IAAI,EAAEqH,cAAc;UACpBrN;QACF,CAAC,CAAC;MACJ;IACF,CAAC,CAAC,OAAOmD,KAAK,EAAE;MACdD,OAAO,CAACC,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;IAC9C;EACF,CAAC;EACD,MAAMqK,gBAAgB,GAAG,MAAOxJ,IAAI,IAAK;IAAA,IAAAyJ,mBAAA;IACvC,MAAML,OAAO,GAAGpJ,IAAI,CAACmE,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;IACrC,IAAIiF,cAAc,GAAG,EAAE;IACvB,IAAID,OAAO,KAAK,MAAM,EAAEC,cAAc,GAAG,qFAAqF;IAC9H,IAAID,OAAO,KAAK,KAAK,EAAEC,cAAc,GAAG,gBAAgB;IACxD,IAAID,OAAO,KAAK,IAAI,EAAEC,cAAc,GAAG,YAAY;IAEnD,MAAM1K,KAAK,CAAC,qCAAqC,EAAE;MACjDC,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QAAE,cAAc,EAAE;MAAmB,CAAC;MAC/CC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QAAE1D,MAAM;QAAEyG,QAAQ,EAAE/B,IAAI;QAAEtB,OAAO,EAAE2K;MAAe,CAAC;IAC1E,CAAC,CAAC;IAEFlN,QAAQ,CAACoH,IAAI,KAAK;MAAE,GAAGA,IAAI;MAAE,CAACvD,IAAI,GAAGqJ;IAAe,CAAC,CAAC,CAAC;IACvD5L,WAAW,CAACwF,QAAQ,IAAI;MACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;MAE9B,MAAMyG,OAAO,GAAG;QACd5J,IAAI,EAAEE,IAAI,CAACmE,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;QAC3BrE,IAAI,EAAE,MAAM;QACZC,IAAI;QACJtB,OAAO,EAAE2K;MACX,CAAC;;MAED;MACA,MAAMM,UAAU,GAAGA,CAACzJ,IAAI,EAAE0J,UAAU,KAAK;QACvC,IAAI1J,IAAI,CAACF,IAAI,KAAK4J,UAAU,EAAE;UAC5B1J,IAAI,CAACD,QAAQ,CAACW,IAAI,CAAC8I,OAAO,CAAC;UAC3B,OAAO,IAAI;QACb;QACA,KAAK,MAAM/I,KAAK,IAAIT,IAAI,CAACD,QAAQ,EAAE;UACjC,IAAIU,KAAK,CAACZ,IAAI,KAAK,QAAQ,IAAI4J,UAAU,CAAChJ,KAAK,EAAEiJ,UAAU,CAAC,EAAE,OAAO,IAAI;QAC3E;QACA,OAAO,KAAK;MACd,CAAC;MAED,MAAMC,WAAW,GAAG9K,IAAI,CAACoE,KAAK,CAACpE,IAAI,CAACC,SAAS,CAACiE,QAAQ,CAAC,CAAC;MACxD0G,UAAU,CAACE,WAAW,EAAE7J,IAAI,CAAC8J,SAAS,CAAC,CAAC,EAAE9J,IAAI,CAAC+J,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;MACrE,OAAOF,WAAW;IACpB,CAAC,CAAC;IAEF,KAAAJ,mBAAA,GAAIhO,SAAS,CAACsF,OAAO,cAAA0I,mBAAA,eAAjBA,mBAAA,CAAmBhD,SAAS,EAAE;MAChChL,SAAS,CAACsF,OAAO,CAACa,IAAI,CAAC,kBAAkB,EAAE;QACzCtG,MAAM;QACNyG,QAAQ,EAAE/B,IAAI;QACdtB,OAAO,EAAE2K,cAAc;QACvBrN;MACF,CAAC,CAAC;IACJ;EACF,CAAC;EAED,MAAMgO,eAAe,GAAG,MAAAA,CAAA,KAAY;IAClC,IAAI,CAAC1M,aAAa,EAAE;IAEpB,IAAI;MAAA,IAAA2M,mBAAA;MACF;MACA,MAAML,UAAU,GAAGtM,aAAa,CAACmD,QAAQ,CAAC,GAAG,CAAC,GAC5CnD,aAAa,GAAG,GAAGA,aAAa,GAAG;;MAErC;MACA,MAAMqB,KAAK,CAAC,6CAA6C,EAAE;QACzDC,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/CC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnB1D,MAAM;UACN0E,IAAI,EAAE4J;QACR,CAAC;MACH,CAAC,CAAC;;MAEF;MACAnM,WAAW,CAACwF,QAAQ,IAAI;QACtB,IAAI,CAACA,QAAQ,EAAE,OAAOA,QAAQ;;QAE9B;QACA,MAAM4B,MAAM,GAAG5B,QAAQ,CAAChD,QAAQ,CAACS,IAAI,CAACC,KAAK,IACzCA,KAAK,CAACX,IAAI,KAAK4J,UACjB,CAAC;QAED,IAAI,CAAC/E,MAAM,EAAE;UACX,OAAO;YACL,GAAG5B,QAAQ;YACXhD,QAAQ,EAAE,CACR,GAAGgD,QAAQ,CAAChD,QAAQ,EACpB;cACEH,IAAI,EAAExC,aAAa;cACnByC,IAAI,EAAE,QAAQ;cACdC,IAAI,EAAE4J,UAAU;cAChB3J,QAAQ,EAAE;YACZ,CAAC;UAEL,CAAC;QACH;QACA,OAAOgD,QAAQ;MACjB,CAAC,CAAC;MAEF9F,qBAAqB,CAAC,KAAK,CAAC;MAC5BI,gBAAgB,CAAC,EAAE,CAAC;MAChB,KAAA0M,mBAAA,GAAIxO,SAAS,CAACsF,OAAO,cAAAkJ,mBAAA,eAAjBA,mBAAA,CAAmBxD,SAAS,EAAE;QACpChL,SAAS,CAACsF,OAAO,CAACa,IAAI,CAAC,oBAAoB,EAAE;UAC3CtG,MAAM;UACN0E,IAAI,EAAE4J,UAAU;UAChB5N;QACF,CAAC,CAAC;MACJ;IAEF,CAAC,CAAC,OAAOmD,KAAK,EAAE;MACdD,OAAO,CAACC,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;IAChD;EACF,CAAC;EACC;EACA,MAAM+K,SAAS,GAAGA,CAAA,KAAM;IACtB,IAAI,CAAChO,KAAK,IAAI,CAACL,SAAS,CAACkF,OAAO,EAAE;IAElC,MAAMoJ,IAAI,GAAGjO,KAAK,CAAC,YAAY,CAAC,IAAI,EAAE;IACtC,MAAMkO,GAAG,GAAGlO,KAAK,CAAC,WAAW,CAAC,IAAI,EAAE;IACpC,MAAMmO,EAAE,GAAGnO,KAAK,CAAC,WAAW,CAAC,IAAI,EAAE;IAEnC,MAAMoO,QAAQ,GAAG;AACrB;AACA;AACA;AACA;AACA;AACA,mBAAmBF,GAAG;AACtB;AACA;AACA,YAAYD,IAAI;AAChB;AACA;AACA;AACA;AACA;AACA;AACA,cAAcE,EAAE;AAChB;AACA;AACA;AACA,KAAK;IAED,MAAME,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACF,QAAQ,CAAC,EAAE;MAAEvK,IAAI,EAAE;IAAY,CAAC,CAAC;IACxD,MAAM0K,GAAG,GAAGC,GAAG,CAACC,eAAe,CAACJ,IAAI,CAAC;IACrC1O,SAAS,CAACkF,OAAO,CAAC6J,GAAG,GAAGH,GAAG;IAC3B9G,UAAU,CAAC,MAAM+G,GAAG,CAACG,eAAe,CAACJ,GAAG,CAAC,EAAE,IAAI,CAAC;EAClD,CAAC;;EAED;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACD,MAAMK,iBAAiB,GAAGA,CAACpE,MAAM,EAAEqE,MAAM,KAAK;IAC7CnP,SAAS,CAACmF,OAAO,GAAG2F,MAAM;;IAE1B;IACA,IAAI,CAAC9K,SAAS,CAACmF,OAAO,CAACyB,MAAM,EAAE;MAC7B5G,SAAS,CAACmF,OAAO,CAACyB,MAAM,GAAG,CAAC,CAAC;IAC/B;;IAEA;IACAtE,MAAM,CAACyB,OAAO,CAACzD,KAAK,CAAC,CAACqE,OAAO,CAAC,CAAC,CAACwB,QAAQ,EAAErD,OAAO,CAAC,KAAK;MACrD,IAAI,CAAC9C,SAAS,CAACmF,OAAO,CAACyB,MAAM,CAACT,QAAQ,CAAC,EAAE;QACvC,MAAMiJ,IAAI,GAAGC,WAAW,CAAClJ,QAAQ,CAAC;QAClCnG,SAAS,CAACmF,OAAO,CAACyB,MAAM,CAACT,QAAQ,CAAC,GAAGgJ,MAAM,CAACrE,MAAM,CAACwE,WAAW,CAACxM,OAAO,EAAEsM,IAAI,CAAC;MAC/E;IACF,CAAC,CAAC;;IAEF;IACA,MAAMG,WAAW,GAAGvP,SAAS,CAACmF,OAAO,CAACyB,MAAM,CAACpG,UAAU,CAAC;IACxD,IAAI+O,WAAW,EAAE;MACfzE,MAAM,CAAC0E,QAAQ,CAACD,WAAW,CAAC;IAC9B;;IAEA;IACAzE,MAAM,CAACQ,yBAAyB,CAAC,MAAM;MAAA,IAAAmE,mBAAA;MACrC,IAAI,CAAAA,mBAAA,GAAA5P,SAAS,CAACsF,OAAO,cAAAsK,mBAAA,eAAjBA,mBAAA,CAAmB5E,SAAS,IAAI,CAAC3K,oBAAoB,CAACiF,OAAO,EAAE;QACjE,MAAM6F,SAAS,GAAGF,MAAM,CAAC/D,YAAY,CAAC,CAAC;QACvC,IAAIiE,SAAS,EAAE;UACb,MAAM1E,QAAQ,GAAG;YACf2E,UAAU,EAAED,SAAS,CAACE,kBAAkB;YACxCC,MAAM,EAAEH,SAAS,CAACI;UACpB,CAAC;UACDvL,SAAS,CAACsF,OAAO,CAACa,IAAI,CAAC,iBAAiB,EAAE;YACxCtG,MAAM;YACNyG,QAAQ,EAAE3F,UAAU;YACpB8F,QAAQ;YACRlG;UACF,CAAC,CAAC;QACJ;MACF;IACF,CAAC,CAAC;EACJ,CAAC;EACD,MAAMsP,gBAAgB,GAAI7F,QAAQ,IAAK;IAAA,IAAA8F,mBAAA,EAAAC,qBAAA;IACrCnP,aAAa,CAACoJ,QAAQ,CAAC;IAEvB,MAAMlD,KAAK,IAAAgJ,mBAAA,GAAG3P,SAAS,CAACmF,OAAO,cAAAwK,mBAAA,wBAAAC,qBAAA,GAAjBD,mBAAA,CAAmB/I,MAAM,cAAAgJ,qBAAA,uBAAzBA,qBAAA,CAA4B/F,QAAQ,CAAC;IACnD,IAAIlD,KAAK,EAAE;MACT3G,SAAS,CAACmF,OAAO,CAACqK,QAAQ,CAAC7I,KAAK,CAAC,CAAC,CAAE;IACtC;EACF,CAAC;;EAGC;EACA1H,eAAe,CAAC,MAAM;IACpB,IAAIY,SAAS,CAACsF,OAAO,EAAE;MACrBtF,SAAS,CAACsF,OAAO,CAACC,UAAU,CAAC,CAAC;IAChC;EACF,CAAC,CAAC;EAEF,MAAMiK,WAAW,GAAIzK,IAAI,IAAK;IAC5B,IAAIA,IAAI,CAACC,QAAQ,CAAC,KAAK,CAAC,EAAE,OAAO,YAAY;IAC7C,IAAID,IAAI,CAACC,QAAQ,CAAC,OAAO,CAAC,EAAE,OAAO,MAAM;IACzC,IAAID,IAAI,CAACC,QAAQ,CAAC,MAAM,CAAC,EAAE,OAAO,KAAK;IACvC,OAAO,WAAW;EACpB,CAAC;EAED,IAAI,CAACvE,KAAK,IAAI,CAACsB,QAAQ,EAAE;IACvB,oBACErC,OAAA;MAAKsQ,SAAS,EAAC,gBAAgB;MAAAxL,QAAA,eAC7B9E,OAAA;QAAKsQ,SAAS,EAAC,gBAAgB;QAAAxL,QAAA,gBAC7B9E,OAAA;UAAKsQ,SAAS,EAAC;QAAiB;UAAAhG,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAAM,CAAC,eACvCxQ,OAAA;UAAA8E,QAAA,EAAK;QAA+B;UAAAwF,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAAK,CAAC,eAC1CxQ,OAAA;UAAKsQ,SAAS,EAAC,mBAAmB;UAAAxL,QAAA,EAAE3D;QAAgB;UAAAmJ,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAAM,CAAC;MAAA;QAAAlG,QAAA,EAAAiG,YAAA;QAAA7E,UAAA;QAAA8E,YAAA;MAAA,OACxD;IAAC;MAAAlG,QAAA,EAAAiG,YAAA;MAAA7E,UAAA;MAAA8E,YAAA;IAAA,OACH,CAAC;EAEV;EAEA,MAAMC,eAAe,GAAG1N,MAAM,CAAC2N,MAAM,CAACjP,WAAW,CAAC;EAElD,oBACEzB,OAAA;IAAKsQ,SAAS,EAAC,gBAAgB;IAAAxL,QAAA,gBAC7B9E,OAAA;MAAKsQ,SAAS,EAAC,mBAAmB;MAAAxL,QAAA,gBAChC9E,OAAA;QAAKsQ,SAAS,EAAC,WAAW;QAAAxL,QAAA,gBACxB9E,OAAA;UAAA8E,QAAA,EAAQ;QAAK;UAAAwF,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAAQ,CAAC,KAAC,EAACrQ,MAAM,EAAC,KAAG,eAAAH,OAAA;UAAA8E,QAAA,EAAQ;QAAK;UAAAwF,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAAQ,CAAC,KAAC,EAAC3P,QAAQ,eAClEb,OAAA;UAAMsQ,SAAS,EAAE,qBAAqBnP,gBAAgB,KAAK,WAAW,GAAG,WAAW,GAAG,cAAc,EAAG;UAAA2D,QAAA,GAAC,SACrG,EAAC3D,gBAAgB;QAAA;UAAAmJ,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OACf,CAAC;MAAA;QAAAlG,QAAA,EAAAiG,YAAA;QAAA7E,UAAA;QAAA8E,YAAA;MAAA,OACJ,CAAC,eAENxQ,OAAA;QAAKsQ,SAAS,EAAC,cAAc;QAAAxL,QAAA,gBAC3B9E,OAAA;UAAMsQ,SAAS,EAAC,aAAa;UAAAxL,QAAA,GAAC,UAAQ,EAACzD,KAAK,CAAC6B,MAAM,EAAC,IAAE;QAAA;UAAAoH,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAAM,CAAC,EAC5DnP,KAAK,CAACoD,GAAG,CAACsG,IAAI,iBACb/K,OAAA;UAEEsQ,SAAS,EAAC,YAAY;UACtBpD,KAAK,EAAE;YAAEyD,eAAe,EAAE/N,YAAY,CAACmI,IAAI,CAACvE,EAAE;UAAE,CAAE;UAAA1B,QAAA,GAEjDiG,IAAI,CAAClK,QAAQ,EACbkK,IAAI,CAACvE,EAAE,KAAKhG,cAAc,CAACoF,OAAO,IAAI,QAAQ;QAAA,GAL1CmF,IAAI,CAACvE,EAAE;UAAA8D,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAMT,CACN,CAAC;MAAA;QAAAlG,QAAA,EAAAiG,YAAA;QAAA7E,UAAA;QAAA8E,YAAA;MAAA,OACC,CAAC,EAELC,eAAe,CAACvN,MAAM,GAAG,CAAC,iBACzBlD,OAAA;QAAKsQ,SAAS,EAAC,kBAAkB;QAAAxL,QAAA,gBAC/B9E,OAAA;UAAMsQ,SAAS,EAAC,aAAa;UAAAxL,QAAA,EAAC;QAAG;UAAAwF,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAAM,CAAC,EACvCC,eAAe,CAAChM,GAAG,CAACmM,CAAC,IAAIA,CAAC,CAAC/P,QAAQ,CAAC,CAACgQ,IAAI,CAAC,IAAI,CAAC,EAC/CJ,eAAe,CAACvN,MAAM,KAAK,CAAC,GAAG,KAAK,GAAG,MAAM,EAAC,aAAW,EAACjC,UAAU,EAAC,KACxE;MAAA;QAAAqJ,QAAA,EAAAiG,YAAA;QAAA7E,UAAA;QAAA8E,YAAA;MAAA,OAAK,CACN;IAAA;MAAAlG,QAAA,EAAAiG,YAAA;MAAA7E,UAAA;MAAA8E,YAAA;IAAA,OACE,CAAC,eAENxQ,OAAA;MAAKsQ,SAAS,EAAC,kBAAkB;MAACpD,KAAK,EAAE;QAAE4D,aAAa,EAAE;MAAM,CAAE;MAAAhM,QAAA,gBAChE9E,OAAA;QAAKsQ,SAAS,EAAC,SAAS;QAAAxL,QAAA,eACtB9E,OAAA,CAACH,WAAW;UACVkF,IAAI,EAAE1C,QAAS;UAChBpB,UAAU,EAAEA,UAAW;UACzBC,aAAa,EAAEiP,gBAAiB;UAChCY,SAAS,EAAEjD,aAAc;UACrBkD,WAAW,EAAEjD,eAAgB;UAC3BkD,iBAAiB,EAAE5C,gBAAiB;UACpClO,MAAM,EAAEA,MAAO;UACfa,QAAQ,EAAEA,QAAS,CAAW;UAAA;UACnCsB,WAAW,EAAEA,WAAY,CAAK;UAAA;UAClChC,SAAS,EAAEA,SAAU,CAAS;UAAA;UAC9BO,QAAQ,EAAEA;QAAS;UAAAyJ,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OACd;MAAC;QAAAlG,QAAA,EAAAiG,YAAA;QAAA7E,UAAA;QAAA8E,YAAA;MAAA,OACC,CAAC,eAENxQ,OAAA;QAAKsQ,SAAS,EAAC,sBAAsB;QAACpD,KAAK,EAAE;UAAEgE,OAAO,EAAE,MAAM;UAAEJ,aAAa,EAAE,KAAK;UAAEK,IAAI,EAAE;QAAE,CAAE;QAAArM,QAAA,gBAE9F9E,OAAA;UAAKkN,KAAK,EAAE;YAAET,KAAK,EAAE,GAAGlK,UAAU,GAAG;YAAE2O,OAAO,EAAE,MAAM;YAAEJ,aAAa,EAAE,QAAQ;YAACM,QAAQ,EAAE;UAAQ,CAAE;UAAAtM,QAAA,gBACpG9E,OAAA;YAAKsQ,SAAS,EAAC,eAAe;YAAAxL,QAAA,gBAC5B9E,OAAA;cAAKsQ,SAAS,EAAC,WAAW;cAAAxL,QAAA,gBACxB9E,OAAA;gBAAA8E,QAAA,EAAS7D;cAAU;gBAAAqJ,QAAA,EAAAiG,YAAA;gBAAA7E,UAAA;gBAAA8E,YAAA;cAAA,OAAS,CAAC,eAC7BxQ,OAAA;gBAAMsQ,SAAS,EAAC,eAAe;gBAAAxL,QAAA,GAAC,GAAC,EAACgL,WAAW,CAAC7O,UAAU,CAAC,EAAC,GAAC;cAAA;gBAAAqJ,QAAA,EAAAiG,YAAA;gBAAA7E,UAAA;gBAAA8E,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAlG,QAAA,EAAAiG,YAAA;cAAA7E,UAAA;cAAA8E,YAAA;YAAA,OAC/D,CAAC,eACNxQ,OAAA;cAAQsQ,SAAS,EAAC,YAAY;cAACe,OAAO,EAAEtC,SAAU;cAAAjK,QAAA,EAAC;YAEnD;cAAAwF,QAAA,EAAAiG,YAAA;cAAA7E,UAAA;cAAA8E,YAAA;YAAA,OAAQ,CAAC,eACTxQ,OAAA;cAAQsQ,SAAS,EAAC,iBAAiB;cAACe,OAAO,EAAEvR,oBAAqB;cAAAgF,QAAA,EAAC;YAEpE;cAAAwF,QAAA,EAAAiG,YAAA;cAAA7E,UAAA;cAAA8E,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAlG,QAAA,EAAAiG,YAAA;YAAA7E,UAAA;YAAA8E,YAAA;UAAA,OACL,CAAC,eAENxQ,OAAA;YAAKsQ,SAAS,EAAC,+BAA+B;YAAAxL,QAAA,gBAC5C9E,OAAA,CAACL,MAAM;cACL2R,MAAM,EAAC,MAAM;cACbC,QAAQ,EAAEzB,WAAW,CAAC7O,UAAU,CAAE;cAClCwM,KAAK,EAAE1M,KAAK,CAACE,UAAU,CAAC,IAAI,EAAG;cAC/BuQ,QAAQ,EAAEhE,gBAAiB;cAC3BiE,OAAO,EAAE9B,iBAAkB;cACzC;cACA;cACA;cACA;;cAEA;cACA;cACA;cACA;cACA;cACA;;cAEA;;cAEA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;;cAEA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;cACA;cAAA;;cAGc+B,KAAK,EAAC,SAAS;cACfC,OAAO,EAAE;gBACPC,OAAO,EAAE;kBAAEC,OAAO,EAAE;gBAAM,CAAC;gBAC3BC,QAAQ,EAAE,EAAE;gBACZC,QAAQ,EAAE,IAAI;gBACdC,eAAe,EAAE,IAAI;gBACrBC,oBAAoB,EAAE,KAAK;gBAC3BC,gBAAgB,EAAE,WAAW;gBAC7BC,eAAe,EAAE,IAAI;gBACrBC,cAAc,EAAE,QAAQ;gBACxBC,0BAA0B,EAAE;cAC9B;YAAE;cAAA/H,QAAA,EAAAiG,YAAA;cAAA7E,UAAA;cAAA8E,YAAA;YAAA,OACH,CAAC,EAGDzN,MAAM,CAACyB,OAAO,CAAC7C,WAAW,CAAC,CAAC8C,GAAG,CAAC,CAAC,CAAC5B,MAAM,EAAEsK,MAAM,CAAC;cAAA,IAAAmF,gBAAA,EAAAC,iBAAA;cAAA,OAChDpF,MAAM,CAAClM,UAAU,KAAKA,UAAU,iBAC9BjB,OAAA;gBAEEsQ,SAAS,EAAC,aAAa;gBACvBpD,KAAK,EAAE;kBACLnG,QAAQ,EAAE,UAAU;kBACpByL,GAAG,EAAE,GAAG,CAAC,EAAAF,gBAAA,GAAAnF,MAAM,CAACpG,QAAQ,cAAAuL,gBAAA,uBAAfA,gBAAA,CAAiB5G,UAAU,KAAI,CAAC,IAAI,EAAE,IAAI;kBACnDkB,IAAI,EAAE,GAAG,CAAC,EAAA2F,iBAAA,GAAApF,MAAM,CAACpG,QAAQ,cAAAwL,iBAAA,uBAAfA,iBAAA,CAAiB3G,MAAM,KAAI,CAAC,IAAI,CAAC,IAAI;kBAC/C6G,UAAU,EAAE,aAAa7P,YAAY,CAACC,MAAM,CAAC,EAAE;kBAC/CyO,MAAM,EAAE,MAAM;kBACdoB,aAAa,EAAE,MAAM;kBACrBC,MAAM,EAAE;gBACV,CAAE;gBAAA7N,QAAA,eAEF9E,OAAA;kBACEsQ,SAAS,EAAC,mBAAmB;kBAC7BpD,KAAK,EAAE;oBACLyD,eAAe,EAAE/N,YAAY,CAACC,MAAM,CAAC;oBACrC+P,KAAK,EAAE,OAAO;oBACdC,OAAO,EAAE,SAAS;oBAClBC,YAAY,EAAE,KAAK;oBACnBhB,QAAQ,EAAE,MAAM;oBAChB/K,QAAQ,EAAE,UAAU;oBACpByL,GAAG,EAAE,OAAO;oBACZ5F,IAAI,EAAE,GAAG;oBACTmG,UAAU,EAAE;kBACd,CAAE;kBAAAjO,QAAA,EAEDqI,MAAM,CAACtM;gBAAQ;kBAAAyJ,QAAA,EAAAiG,YAAA;kBAAA7E,UAAA;kBAAA8E,YAAA;gBAAA,OACb;cAAC,GA3BD3N,MAAM;gBAAAyH,QAAA,EAAAiG,YAAA;gBAAA7E,UAAA;gBAAA8E,YAAA;cAAA,OA4BR,CACN;YAAA,CACF,CAAC;UAAA;YAAAlG,QAAA,EAAAiG,YAAA;YAAA7E,UAAA;YAAA8E,YAAA;UAAA,OACC,CAAC;QAAA;UAAAlG,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OACD,CAAC,eAChBxQ,OAAA;UACIsQ,SAAS,EAAC,eAAe;UACzB0C,WAAW,EAAE3F,eAAgB;UAC7BH,KAAK,EAAE;YACLT,KAAK,EAAE,KAAK;YACZU,MAAM,EAAE,YAAY;YACpBwD,eAAe,EAAElO,UAAU,GAAG,SAAS,GAAG,SAAS;YACnDwQ,UAAU,EAAE;UACd;QAAE;UAAA3I,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OACH,CAAC,eACMxQ,OAAA;UAAKsQ,SAAS,EAAC,cAAc;UAACpD,KAAK,EAAE;YAAET,KAAK,EAAE,GAAG,GAAG,GAAGlK,UAAU,GAAG;YAAE6O,QAAQ,EAAE;UAAQ,CAAE;UAAAtM,QAAA,gBACxF9E,OAAA;YAAKsQ,SAAS,EAAC,eAAe;YAAAxL,QAAA,gBAC5B9E,OAAA;cAAA8E,QAAA,EAAQ;YAAc;cAAAwF,QAAA,EAAAiG,YAAA;cAAA7E,UAAA;cAAA8E,YAAA;YAAA,OAAQ,CAAC,eAC/BxQ,OAAA;cAAQsQ,SAAS,EAAC,gBAAgB;cAACe,OAAO,EAAEtC,SAAU;cAAAjK,QAAA,EAAC;YAEvD;cAAAwF,QAAA,EAAAiG,YAAA;cAAA7E,UAAA;cAAA8E,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAlG,QAAA,EAAAiG,YAAA;YAAA7E,UAAA;YAAA8E,YAAA;UAAA,OACN,CAAC,eACNxQ,OAAA;YACEkT,GAAG,EAAExS,SAAU;YACfyS,KAAK,EAAC,kBAAkB;YACxB7C,SAAS,EAAC,cAAc;YACtBpD,KAAK,EAAE;cAAEiE,IAAI,EAAE,CAAC;cAAEiC,MAAM,EAAE,MAAM;cAAEC,UAAU,EAAE,OAAO;cAAE5G,KAAK,EAAE,MAAM;cAAE6E,MAAM,EAAE;YAAO,CAAE;YACzFgC,OAAO,EAAC;UAA6C;YAAAhJ,QAAA,EAAAiG,YAAA;YAAA7E,UAAA;YAAA8E,YAAA;UAAA,OACtD,CAAC;QAAA;UAAAlG,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OACC,CAAC;MAAA;QAAAlG,QAAA,EAAAiG,YAAA;QAAA7E,UAAA;QAAA8E,YAAA;MAAA,OACH,CAAC;IAAA;MAAAlG,QAAA,EAAAiG,YAAA;MAAA7E,UAAA;MAAA8E,YAAA;IAAA,OACH,CAAC,EACL3O,gBAAgB,iBACf7B,OAAA;MAAKsQ,SAAS,EAAC,eAAe;MAAAxL,QAAA,eAC5B9E,OAAA;QAAKsQ,SAAS,EAAC,OAAO;QAAAxL,QAAA,gBACpB9E,OAAA;UAAA8E,QAAA,EAAI;QAAe;UAAAwF,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAAI,CAAC,eACxBxQ,OAAA;UACE4E,IAAI,EAAC,MAAM;UACX2O,WAAW,EAAC,wBAAwB;UACpC9F,KAAK,EAAExL,WAAY;UACnBuP,QAAQ,EAAGtF,CAAC,IAAKhK,cAAc,CAACgK,CAAC,CAACsH,MAAM,CAAC/F,KAAK;QAAE;UAAAnD,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OACjD,CAAC,eACFxQ,OAAA;UAAKsQ,SAAS,EAAC,eAAe;UAAAxL,QAAA,gBAC5B9E,OAAA;YAAQqR,OAAO,EAAEA,CAAA,KAAMvP,mBAAmB,CAAC,KAAK,CAAE;YAAAgD,QAAA,EAAC;UAAM;YAAAwF,QAAA,EAAAiG,YAAA;YAAA7E,UAAA;YAAA8E,YAAA;UAAA,OAAQ,CAAC,eAClExQ,OAAA;YAAQqR,OAAO,EAAErD,aAAc;YAAAlJ,QAAA,EAAC;UAAM;YAAAwF,QAAA,EAAAiG,YAAA;YAAA7E,UAAA;YAAA8E,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAAlG,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAC5C,CAAC;MAAA;QAAAlG,QAAA,EAAAiG,YAAA;QAAA7E,UAAA;QAAA8E,YAAA;MAAA,OACH;IAAC;MAAAlG,QAAA,EAAAiG,YAAA;MAAA7E,UAAA;MAAA8E,YAAA;IAAA,OACH,CACN,EAEAzO,kBAAkB,iBACjB/B,OAAA;MAAKsQ,SAAS,EAAC,eAAe;MAAAxL,QAAA,eAC5B9E,OAAA;QAAKsQ,SAAS,EAAC,OAAO;QAAAxL,QAAA,gBACpB9E,OAAA;UAAA8E,QAAA,EAAI;QAAiB;UAAAwF,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAAI,CAAC,eAC1BxQ,OAAA;UACE4E,IAAI,EAAC,MAAM;UACX2O,WAAW,EAAC,aAAa;UACzB9F,KAAK,EAAEtL,aAAc;UACrBqP,QAAQ,EAAGtF,CAAC,IAAK9J,gBAAgB,CAAC8J,CAAC,CAACsH,MAAM,CAAC/F,KAAK;QAAE;UAAAnD,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OACnD,CAAC,eACFxQ,OAAA;UAAKsQ,SAAS,EAAC,eAAe;UAAAxL,QAAA,gBAC5B9E,OAAA;YAAQqR,OAAO,EAAEA,CAAA,KAAMrP,qBAAqB,CAAC,KAAK,CAAE;YAAA8C,QAAA,EAAC;UAAM;YAAAwF,QAAA,EAAAiG,YAAA;YAAA7E,UAAA;YAAA8E,YAAA;UAAA,OAAQ,CAAC,eACpExQ,OAAA;YAAQqR,OAAO,EAAExC,eAAgB;YAAA/J,QAAA,EAAC;UAAM;YAAAwF,QAAA,EAAAiG,YAAA;YAAA7E,UAAA;YAAA8E,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAAlG,QAAA,EAAAiG,YAAA;UAAA7E,UAAA;UAAA8E,YAAA;QAAA,OAC9C,CAAC;MAAA;QAAAlG,QAAA,EAAAiG,YAAA;QAAA7E,UAAA;QAAA8E,YAAA;MAAA,OACH;IAAC;MAAAlG,QAAA,EAAAiG,YAAA;MAAA7E,UAAA;MAAA8E,YAAA;IAAA,OACH,CACN;EAAA;IAAAlG,QAAA,EAAAiG,YAAA;IAAA7E,UAAA;IAAA8E,YAAA;EAAA,OACE,CAAC;AAEV;AAACtQ,EAAA,CAj7CQD,UAAU;EAAA,QACET,SAAS,EACXD,WAAW,EACXE,WAAW,EAirC5BC,eAAe;AAAA;AAAA+T,EAAA,GAprCRxT,UAAU;AAo7CnB,SAASoD,QAAQA,CAACqQ,IAAI,EAAEC,IAAI,EAAE;EAC5B,IAAIxN,OAAO;EACX,OAAO,SAASyN,gBAAgBA,CAAC,GAAGC,IAAI,EAAE;IACxC,MAAMC,KAAK,GAAGA,CAAA,KAAM;MAClBC,YAAY,CAAC5N,OAAO,CAAC;MACrBuN,IAAI,CAAC,GAAGG,IAAI,CAAC;IACf,CAAC;IACDE,YAAY,CAAC5N,OAAO,CAAC;IACrBA,OAAO,GAAGqC,UAAU,CAACsL,KAAK,EAAEH,IAAI,CAAC;EACnC,CAAC;AACH;AAEA,eAAe1T,UAAU;AAAC,IAAAwT,EAAA;AAAAO,YAAA,CAAAP,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}