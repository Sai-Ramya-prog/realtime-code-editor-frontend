{"ast":null,"code":"var _jsxFileName = \"D:\\\\realtime-code-editor\\\\client\\\\src\\\\pages\\\\EditorPage.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useLocation, useParams, useNavigate, useBeforeUnload } from 'react-router-dom';\nimport Editor from '@monaco-editor/react';\nimport { io } from 'socket.io-client';\nimport FileSidebar from '../components/FileSidebar';\nimport '../styles/editor.css';\nimport JSZip from 'jszip';\nimport { saveAs } from 'file-saver';\nimport debounce from 'lodash.debounce';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction EditorPage() {\n  _s();\n  const {\n    roomId\n  } = useParams();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const socketRef = useRef(null);\n  const initializedRef = useRef(false);\n  const currentUserRef = useRef(null);\n  const editorRef = useRef(null);\n  const iframeRef = useRef(null);\n  const isUpdatingFromSocket = useRef(false);\n  const lastChangeTimestamp = useRef(0);\n  const [username, setUsername] = useState('');\n  const [files, setFiles] = useState({});\n  const [activeFile, setActiveFile] = useState('index.html');\n  const [connectionStatus, setConnectionStatus] = useState('Connecting...');\n  const [users, setUsers] = useState([]);\n  const [activeUsers, setActiveUsers] = useState({});\n  const [typingUsers, setTypingUsers] = useState({});\n  const [userCursors, setUserCursors] = useState({});\n\n  // Colors for different users\n  const userColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];\n  const getUserColor = userId => {\n    const index = Object.keys(activeUsers).indexOf(userId);\n    return userColors[index % userColors.length];\n  };\n\n  // Debounced save function using lodash.debounce\n  const debouncedSave = useCallback(debounce(async (roomId, filename, content) => {\n    try {\n      await fetch('http://localhost:5000/api/code/save', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          roomId,\n          filename,\n          content\n        })\n      });\n    } catch (err) {\n      console.error('Error saving file:', err);\n    }\n  }, 2000), []);\n\n  // Cleanup debounce on unmount\n  useEffect(() => {\n    return () => {\n      debouncedSave.cancel();\n    };\n  }, [debouncedSave]);\n\n  // Fetch files from backend\n  const fetchFiles = useCallback(async () => {\n    if (!roomId) return;\n    try {\n      const response = await fetch(`http://localhost:5000/api/code/${roomId}`);\n      if (!response.ok) {\n        if (response.status === 404) {\n          const defaultFiles = {\n            'index.html': '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>',\n            'style.css': '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}',\n            'script.js': '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");'\n          };\n          await Promise.all(Object.entries(defaultFiles).map(([filename, content]) => debouncedSave(roomId, filename, content)));\n          return defaultFiles;\n        }\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const data = await response.json();\n      const requiredFiles = ['index.html', 'style.css', 'script.js'];\n      const completeFiles = {\n        ...data\n      };\n      requiredFiles.forEach(file => {\n        if (!completeFiles[file]) {\n          completeFiles[file] = file.endsWith('.html') ? '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>' : file.endsWith('.css') ? '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}' : '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");';\n        }\n      });\n      return completeFiles;\n    } catch (error) {\n      console.error('Error loading files:', error);\n      return {\n        'index.html': '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>',\n        'style.css': '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}',\n        'script.js': '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");'\n      };\n    }\n  }, [roomId, debouncedSave]);\n\n  // Initialize socket connection\n  const initializeSocket = useCallback(filesData => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n    }\n    const socket = io('http://localhost:5000', {\n      transports: ['websocket'],\n      upgrade: false,\n      reconnectionAttempts: 5,\n      reconnectionDelay: 1000,\n      timeout: 10000\n    });\n    socket.on('connect', () => {\n      console.log('游릭 Connected to server');\n      setConnectionStatus('Connected');\n      currentUserRef.current = socket.id;\n      socket.emit('join-room', {\n        roomId,\n        username,\n        files: filesData\n      });\n    });\n    socket.on('disconnect', () => {\n      console.log('游댮 Disconnected from server');\n      setConnectionStatus('Disconnected');\n    });\n    socket.on('reconnect', () => {\n      console.log('游리 Reconnected to server');\n      setConnectionStatus('Connected');\n      socket.emit('join-room', {\n        roomId,\n        username,\n        files: files\n      });\n    });\n    socket.on('room-state', ({\n      files: roomFiles,\n      users: roomUsers\n    }) => {\n      console.log('游늶 Received room state:', {\n        files: Object.keys(roomFiles),\n        users: roomUsers.length\n      });\n      setFiles(roomFiles);\n      setUsers(roomUsers);\n    });\n    socket.on('user-file-switch', ({\n      userId,\n      username: switchUsername,\n      filePath\n    }) => {\n      if (userId !== currentUserRef.current) {\n        setUserCursors(prev => ({\n          ...prev,\n          [userId]: {\n            ...prev[userId],\n            activeFile: filePath,\n            username: switchUsername\n          }\n        }));\n      }\n    });\n    socket.on('code-update', ({\n      filePath,\n      code,\n      sender,\n      position,\n      username: senderUsername\n    }) => {\n      if (sender !== currentUserRef.current) {\n        console.log('游닇 Code update from', senderUsername, 'for', filePath);\n        isUpdatingFromSocket.current = true;\n        setFiles(prev => {\n          const newFiles = {\n            ...prev,\n            [filePath]: code\n          };\n          if (filePath === activeFile && editorRef.current) {\n            const model = editorRef.current.getModel();\n            if (model && model.getValue() !== code) {\n              const currentSelection = editorRef.current.getSelection();\n              const scrollInfo = editorRef.current.getScrollTop();\n              model.setValue(code);\n              if (currentSelection && !position) {\n                editorRef.current.setSelection(currentSelection);\n                editorRef.current.setScrollTop(scrollInfo);\n              }\n            }\n          }\n          return newFiles;\n        });\n        if (position) {\n          setUserCursors(prev => ({\n            ...prev,\n            [sender]: {\n              ...prev[sender],\n              position,\n              activeFile: filePath,\n              username: senderUsername\n            }\n          }));\n        }\n        if (filePath === activeFile) {\n          setTypingUsers(prev => ({\n            ...prev,\n            [sender]: {\n              username: senderUsername,\n              timestamp: Date.now()\n            }\n          }));\n        }\n        setTimeout(() => {\n          isUpdatingFromSocket.current = false;\n        }, 100);\n      }\n    });\n    socket.on('user-joined', ({\n      userId,\n      username: newUsername\n    }) => {\n      console.log('游녻 User joined:', newUsername);\n      setUsers(prev => {\n        const exists = prev.find(u => u.id === userId);\n        if (!exists) {\n          return [...prev, {\n            id: userId,\n            username: newUsername\n          }];\n        }\n        return prev;\n      });\n    });\n    socket.on('new-file', ({\n      filename\n    }) => {\n      setFiles(prev => {\n        if (!prev[filename]) {\n          return {\n            ...prev,\n            [filename]: ''\n          };\n        }\n        return prev;\n      });\n    });\n    socket.on('file-removed', ({\n      filename\n    }) => {\n      setFiles(prev => {\n        const updated = {\n          ...prev\n        };\n        delete updated[filename];\n        return updated;\n      });\n    });\n    socket.on('user-left', ({\n      userId,\n      username: leftUsername\n    }) => {\n      console.log('游녻 User left:', leftUsername);\n      setUsers(prev => prev.filter(u => u.id !== userId));\n      setActiveUsers(prev => {\n        const newActive = {\n          ...prev\n        };\n        delete newActive[userId];\n        return newActive;\n      });\n      setUserCursors(prev => {\n        const newCursors = {\n          ...prev\n        };\n        delete newCursors[userId];\n        return newCursors;\n      });\n      setTypingUsers(prev => {\n        const newTyping = {\n          ...prev\n        };\n        delete newTyping[userId];\n        return newTyping;\n      });\n    });\n    socket.on('cursor-position', ({\n      userId,\n      username: cursorUsername,\n      position,\n      activeFile: userActiveFile\n    }) => {\n      if (userId !== currentUserRef.current && userActiveFile === activeFile) {\n        setUserCursors(prev => ({\n          ...prev,\n          [userId]: {\n            position,\n            activeFile: userActiveFile,\n            username: cursorUsername,\n            timestamp: Date.now()\n          }\n        }));\n      }\n    });\n    socket.on('user-typing', ({\n      userId,\n      username: typingUsername,\n      filePath\n    }) => {\n      if (userId !== currentUserRef.current && filePath === activeFile) {\n        setTypingUsers(prev => ({\n          ...prev,\n          [userId]: {\n            username: typingUsername,\n            timestamp: Date.now()\n          }\n        }));\n      }\n    });\n    socketRef.current = socket;\n    return socket;\n  }, [username, roomId, activeFile, files]);\n\n  // Clear old typing indicators\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = Date.now();\n      setTypingUsers(prev => {\n        const updated = {\n          ...prev\n        };\n        Object.keys(updated).forEach(userId => {\n          if (now - updated[userId].timestamp > 3000) {\n            delete updated[userId];\n          }\n        });\n        return updated;\n      });\n    }, 1000);\n    return () => clearInterval(interval);\n  }, []);\n\n  // Main initialization effect\n  useEffect(() => {\n    if (!roomId) {\n      navigate('/room');\n      return;\n    }\n    if (initializedRef.current) return;\n    initializedRef.current = true;\n    const user = location.state && location.state.username || localStorage.getItem('username') || 'Guest';\n    setUsername(user);\n    const initialize = async () => {\n      try {\n        const filesData = await fetchFiles();\n        setFiles(filesData);\n        initializeSocket(filesData);\n        localStorage.setItem('username', user);\n      } catch (error) {\n        console.error('Initialization error:', error);\n        setConnectionStatus('Initialization failed');\n      }\n    };\n    initialize();\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.disconnect();\n      }\n    };\n  }, [roomId, navigate, location.state, fetchFiles, initializeSocket]);\n\n  // Track cursor position\n  useEffect(() => {\n    var _socketRef$current;\n    if (!editorRef.current || !((_socketRef$current = socketRef.current) !== null && _socketRef$current !== void 0 && _socketRef$current.connected)) return;\n    const editor = editorRef.current;\n    const handleCursorChange = () => {\n      if (isUpdatingFromSocket.current) return;\n      const selection = editor.getSelection();\n      if (selection) {\n        const position = {\n          lineNumber: selection.positionLineNumber,\n          column: selection.positionColumn\n        };\n        socketRef.current.emit('cursor-position', {\n          roomId,\n          filePath: activeFile,\n          position,\n          username\n        });\n      }\n    };\n    const disposable = editor.onDidChangeCursorPosition(handleCursorChange);\n    return () => disposable.dispose();\n  }, [roomId, activeFile, username]);\n\n  // Handle code changes with real-time sync\n  const handleCodeChange = useCallback(value => {\n    if (!value) value = '';\n    if (isUpdatingFromSocket.current) return;\n    const timestamp = Date.now();\n    lastChangeTimestamp.current = timestamp;\n    setFiles(prev => {\n      if (prev[activeFile] !== value) {\n        var _socketRef$current2;\n        const newFiles = {\n          ...prev,\n          [activeFile]: value\n        };\n        if ((_socketRef$current2 = socketRef.current) !== null && _socketRef$current2 !== void 0 && _socketRef$current2.connected) {\n          var _editorRef$current;\n          const selection = (_editorRef$current = editorRef.current) === null || _editorRef$current === void 0 ? void 0 : _editorRef$current.getSelection();\n          const position = selection ? {\n            lineNumber: selection.positionLineNumber,\n            column: selection.positionColumn\n          } : null;\n          socketRef.current.emit('code-change', {\n            roomId,\n            filePath: activeFile,\n            code: value,\n            position,\n            timestamp,\n            username\n          });\n          socketRef.current.emit('user-typing', {\n            roomId,\n            filePath: activeFile,\n            username\n          });\n        }\n        debouncedSave(roomId, activeFile, value);\n        return newFiles;\n      }\n      return prev;\n    });\n  }, [activeFile, roomId, debouncedSave, username]);\n\n  // Handle running the code\n  const handleRun = () => {\n    if (!files || !iframeRef.current) return;\n    const htmlFiles = Object.entries(files).filter(([f]) => f.endsWith('.html'));\n    const cssFiles = Object.entries(files).filter(([f]) => f.endsWith('.css'));\n    const jsFiles = Object.entries(files).filter(([f]) => f.endsWith('.js'));\n    const combined = `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          ${cssFiles.map(([_, css]) => `<style>${css}</style>`).join('\\n')}\n        </head>\n        <body>\n          ${htmlFiles.map(([_, html]) => html).join('\\n')}\n          ${jsFiles.map(([_, js]) => `<script>${js}</script>`).join('\\n')}\n        </body>\n      </html>\n    `;\n    const blob = new Blob([combined], {\n      type: 'text/html'\n    });\n    const url = URL.createObjectURL(blob);\n    iframeRef.current.src = url;\n    setTimeout(() => URL.revokeObjectURL(url), 1000);\n  };\n  const handleDownloadProject = () => {\n    const zip = new JSZip();\n    Object.entries(files).forEach(([filename, content]) => {\n      zip.file(filename, content);\n    });\n    zip.generateAsync({\n      type: 'blob'\n    }).then(content => {\n      saveAs(content, `${roomId || 'project'}.zip`);\n    });\n  };\n  const handleAddFile = () => {\n    const newFileName = prompt('Enter new file name (e.g. `utils/helper.js`):');\n    if (newFileName && !files[newFileName]) {\n      setFiles(prev => ({\n        ...prev,\n        [newFileName]: ''\n      }));\n      setActiveFile(newFileName);\n      debouncedSave(roomId, newFileName, '');\n      if (socketRef.current) {\n        socketRef.current.emit('new-file', {\n          roomId,\n          filename: newFileName\n        });\n      }\n    }\n  };\n  const handleRenameFile = async (oldPath, newPath) => {\n    try {\n      if (files[newPath]) {\n        alert('A file with that name already exists');\n        return;\n      }\n      setFiles(prev => {\n        const updated = {\n          ...prev\n        };\n        updated[newPath] = updated[oldPath];\n        delete updated[oldPath];\n        return updated;\n      });\n      if (activeFile === oldPath) {\n        setActiveFile(newPath);\n      }\n      await debouncedSave(roomId, newPath, files[oldPath]);\n      await fetch(`http://localhost:5000/api/code/delete/${roomId}/${encodeURIComponent(oldPath)}`, {\n        method: 'DELETE'\n      });\n    } catch (err) {\n      console.error('Error renaming file:', err);\n      alert('Error renaming file');\n    }\n  };\n  const handleDeleteFile = async fileName => {\n    if (fileName === activeFile) {\n      const remaining = Object.keys(files).filter(f => f !== fileName);\n      setActiveFile(remaining[0] || '');\n    }\n    try {\n      await fetch(`http://localhost:5000/api/code/delete/${roomId}/${encodeURIComponent(fileName)}`, {\n        method: 'DELETE'\n      });\n      const updatedFiles = {\n        ...files\n      };\n      delete updatedFiles[fileName];\n      setFiles(updatedFiles);\n      if (socketRef.current) {\n        socketRef.current.emit('file-deleted', {\n          roomId,\n          filename: fileName\n        });\n      }\n    } catch (err) {\n      console.error('Error deleting file:', err);\n      alert('Error deleting file');\n    }\n  };\n  const handleFileSwitch = fileName => {\n    var _socketRef$current3;\n    setActiveFile(fileName);\n    if ((_socketRef$current3 = socketRef.current) !== null && _socketRef$current3 !== void 0 && _socketRef$current3.connected) {\n      socketRef.current.emit('file-switch', {\n        roomId,\n        filePath: fileName,\n        username\n      });\n    }\n  };\n  const getLanguage = file => {\n    if (file.endsWith('.js')) return 'javascript';\n    if (file.endsWith('.html')) return 'html';\n    if (file.endsWith('.css')) return 'css';\n    return 'plaintext';\n  };\n  useBeforeUnload(() => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n    }\n  });\n  if (!files) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-wrapper\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-screen\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"loading-spinner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 562,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"Loading collaborative editor...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 563,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"connection-status\",\n          children: connectionStatus\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 564,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 561,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 560,\n      columnNumber: 7\n    }, this);\n  }\n  const typingUsersList = Object.values(typingUsers);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"editor-wrapper\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"collaboration-bar\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"room-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Room:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 576,\n          columnNumber: 11\n        }, this), \" \", roomId, \" | \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"User:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 576,\n          columnNumber: 45\n        }, this), \" \", username, /*#__PURE__*/_jsxDEV(\"span\", {\n          className: `connection-status ${connectionStatus === 'Connected' ? 'connected' : 'disconnected'}`,\n          children: [\"\\u25CF \", connectionStatus]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 577,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 575,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"online-users\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"users-label\",\n          children: [\"Online (\", users.length, \"):\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 583,\n          columnNumber: 11\n        }, this), users.map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"user-badge\",\n          style: {\n            backgroundColor: getUserColor(user.id)\n          },\n          children: [user.username, user.id === currentUserRef.current && ' (You)']\n        }, user.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 585,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 582,\n        columnNumber: 9\n      }, this), typingUsersList.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"typing-indicator\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"typing-dots\",\n          children: \"\\u25CF\\u25CF\\u25CF\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 598,\n          columnNumber: 13\n        }, this), typingUsersList.map(t => t.username).join(', '), typingUsersList.length === 1 ? ' is' : ' are', \" typing in \", activeFile, \"...\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 597,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 574,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sidebar\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleAddFile,\n          style: {\n            marginBottom: '10px',\n            padding: '5px',\n            width: '100%'\n          },\n          children: \"\\u2795 Add File\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 607,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FileSidebar, {\n          files: Object.keys(files),\n          activeFile: activeFile,\n          setActiveFile: handleFileSwitch,\n          onAddFile: handleAddFile,\n          onDownload: handleDownloadProject,\n          onDeleteFile: handleDeleteFile,\n          onRenameFile: handleRenameFile\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 613,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 606,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main-editor\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"editor-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"file-info\",\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: activeFile\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 627,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"file-language\",\n              children: [\"(\", getLanguage(activeFile), \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 628,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 626,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"run-button\",\n            onClick: handleRun,\n            children: \"\\u25B6 Run Code\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 630,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 625,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"editor-container-with-cursors\",\n          children: [/*#__PURE__*/_jsxDEV(Editor, {\n            height: \"50vh\",\n            language: getLanguage(activeFile),\n            value: files[activeFile] || \"\",\n            onChange: handleCodeChange,\n            onMount: editor => {\n              editorRef.current = editor;\n              editor.onDidChangeCursorPosition(() => {\n                var _socketRef$current4;\n                if ((_socketRef$current4 = socketRef.current) !== null && _socketRef$current4 !== void 0 && _socketRef$current4.connected && !isUpdatingFromSocket.current) {\n                  const selection = editor.getSelection();\n                  if (selection) {\n                    const position = {\n                      lineNumber: selection.positionLineNumber,\n                      column: selection.positionColumn\n                    };\n                    socketRef.current.emit('cursor-position', {\n                      roomId,\n                      filePath: activeFile,\n                      position,\n                      username\n                    });\n                  }\n                }\n              });\n            },\n            theme: \"vs-dark\",\n            options: {\n              minimap: {\n                enabled: false\n              },\n              fontSize: 14,\n              wordWrap: 'on',\n              automaticLayout: true,\n              scrollBeyondLastLine: false,\n              renderWhitespace: 'selection',\n              smoothScrolling: true,\n              cursorBlinking: 'smooth',\n              cursorSmoothCaretAnimation: true\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 636,\n            columnNumber: 13\n          }, this), Object.entries(userCursors).map(([userId, cursor]) => {\n            var _cursor$position, _cursor$position2;\n            return cursor.activeFile === activeFile && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"user-cursor\",\n              style: {\n                position: 'absolute',\n                top: `${(((_cursor$position = cursor.position) === null || _cursor$position === void 0 ? void 0 : _cursor$position.lineNumber) || 0) * 18}px`,\n                left: `${(((_cursor$position2 = cursor.position) === null || _cursor$position2 === void 0 ? void 0 : _cursor$position2.column) || 0) * 8}px`,\n                borderLeft: `2px solid ${getUserColor(userId)}`,\n                height: '18px',\n                pointerEvents: 'none',\n                zIndex: 1000\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"user-cursor-label\",\n                style: {\n                  backgroundColor: getUserColor(userId),\n                  color: 'white',\n                  padding: '2px 6px',\n                  borderRadius: '3px',\n                  fontSize: '11px',\n                  position: 'absolute',\n                  top: '-20px',\n                  left: '0',\n                  whiteSpace: 'nowrap'\n                },\n                children: cursor.username\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 691,\n                columnNumber: 19\n              }, this)\n            }, userId, false, {\n              fileName: _jsxFileName,\n              lineNumber: 678,\n              columnNumber: 17\n            }, this);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 635,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"output-panel\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"output-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Output Preview\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 714,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"refresh-output\",\n              onClick: handleRun,\n              children: \"\\uD83D\\uDD04 Refresh\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 715,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 713,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"iframe\", {\n            ref: iframeRef,\n            title: \"Live Code Output\",\n            className: \"output-frame\",\n            sandbox: \"allow-scripts allow-same-origin allow-forms\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 719,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 712,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 624,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 605,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 573,\n    columnNumber: 5\n  }, this);\n}\n_s(EditorPage, \"jnshknJATRrh/J3C9Yvdj/sM+fE=\", false, function () {\n  return [useParams, useLocation, useNavigate, useBeforeUnload];\n});\n_c = EditorPage;\nexport default EditorPage;\nvar _c;\n$RefreshReg$(_c, \"EditorPage\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useLocation","useParams","useNavigate","useBeforeUnload","Editor","io","FileSidebar","JSZip","saveAs","debounce","jsxDEV","_jsxDEV","EditorPage","_s","roomId","location","navigate","socketRef","initializedRef","currentUserRef","editorRef","iframeRef","isUpdatingFromSocket","lastChangeTimestamp","username","setUsername","files","setFiles","activeFile","setActiveFile","connectionStatus","setConnectionStatus","users","setUsers","activeUsers","setActiveUsers","typingUsers","setTypingUsers","userCursors","setUserCursors","userColors","getUserColor","userId","index","Object","keys","indexOf","length","debouncedSave","filename","content","fetch","method","headers","body","JSON","stringify","err","console","error","cancel","fetchFiles","response","ok","status","defaultFiles","Promise","all","entries","map","Error","data","json","requiredFiles","completeFiles","forEach","file","endsWith","initializeSocket","filesData","current","disconnect","socket","transports","upgrade","reconnectionAttempts","reconnectionDelay","timeout","on","log","id","emit","roomFiles","roomUsers","switchUsername","filePath","prev","code","sender","position","senderUsername","newFiles","model","getModel","getValue","currentSelection","getSelection","scrollInfo","getScrollTop","setValue","setSelection","setScrollTop","timestamp","Date","now","setTimeout","newUsername","exists","find","u","updated","leftUsername","filter","newActive","newCursors","newTyping","cursorUsername","userActiveFile","typingUsername","interval","setInterval","clearInterval","user","state","localStorage","getItem","initialize","setItem","_socketRef$current","connected","editor","handleCursorChange","selection","lineNumber","positionLineNumber","column","positionColumn","disposable","onDidChangeCursorPosition","dispose","handleCodeChange","value","_socketRef$current2","_editorRef$current","handleRun","htmlFiles","f","cssFiles","jsFiles","combined","_","css","join","html","js","blob","Blob","type","url","URL","createObjectURL","src","revokeObjectURL","handleDownloadProject","zip","generateAsync","then","handleAddFile","newFileName","prompt","handleRenameFile","oldPath","newPath","alert","encodeURIComponent","handleDeleteFile","fileName","remaining","updatedFiles","handleFileSwitch","_socketRef$current3","getLanguage","className","children","_jsxFileName","columnNumber","typingUsersList","values","style","backgroundColor","t","onClick","marginBottom","padding","width","onAddFile","onDownload","onDeleteFile","onRenameFile","height","language","onChange","onMount","_socketRef$current4","theme","options","minimap","enabled","fontSize","wordWrap","automaticLayout","scrollBeyondLastLine","renderWhitespace","smoothScrolling","cursorBlinking","cursorSmoothCaretAnimation","cursor","_cursor$position","_cursor$position2","top","left","borderLeft","pointerEvents","zIndex","color","borderRadius","whiteSpace","ref","title","sandbox","_c","$RefreshReg$"],"sources":["D:/realtime-code-editor/client/src/pages/EditorPage.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useLocation, useParams, useNavigate, useBeforeUnload } from 'react-router-dom';\r\nimport Editor from '@monaco-editor/react';\r\nimport { io } from 'socket.io-client';\r\nimport FileSidebar from '../components/FileSidebar';\r\nimport '../styles/editor.css';\r\nimport JSZip from 'jszip';\r\nimport { saveAs } from 'file-saver';\r\nimport debounce from 'lodash.debounce';\r\n\r\nfunction EditorPage() {\r\n  const { roomId } = useParams();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const socketRef = useRef(null);\r\n  const initializedRef = useRef(false);\r\n  const currentUserRef = useRef(null);\r\n  const editorRef = useRef(null);\r\n  const iframeRef = useRef(null);\r\n  const isUpdatingFromSocket = useRef(false);\r\n  const lastChangeTimestamp = useRef(0);\r\n\r\n  const [username, setUsername] = useState('');\r\n  const [files, setFiles] = useState({});\r\n  const [activeFile, setActiveFile] = useState('index.html');\r\n  const [connectionStatus, setConnectionStatus] = useState('Connecting...');\r\n  const [users, setUsers] = useState([]);\r\n  const [activeUsers, setActiveUsers] = useState({});\r\n  const [typingUsers, setTypingUsers] = useState({});\r\n  const [userCursors, setUserCursors] = useState({});\r\n\r\n  // Colors for different users\r\n  const userColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];\r\n  const getUserColor = (userId) => {\r\n    const index = Object.keys(activeUsers).indexOf(userId);\r\n    return userColors[index % userColors.length];\r\n  };\r\n\r\n  // Debounced save function using lodash.debounce\r\n  const debouncedSave = useCallback(\r\n    debounce(async (roomId, filename, content) => {\r\n      try {\r\n        await fetch('http://localhost:5000/api/code/save', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ roomId, filename, content }),\r\n        });\r\n      } catch (err) {\r\n        console.error('Error saving file:', err);\r\n      }\r\n    }, 2000),\r\n    []\r\n  );\r\n\r\n  // Cleanup debounce on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      debouncedSave.cancel();\r\n    };\r\n  }, [debouncedSave]);\r\n\r\n  // Fetch files from backend\r\n  const fetchFiles = useCallback(async () => {\r\n    if (!roomId) return;\r\n\r\n    try {\r\n      const response = await fetch(`http://localhost:5000/api/code/${roomId}`);\r\n      \r\n      if (!response.ok) {\r\n        if (response.status === 404) {\r\n          const defaultFiles = {\r\n            'index.html': '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>',\r\n            'style.css': '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}',\r\n            'script.js': '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");',\r\n          };\r\n          \r\n          await Promise.all(\r\n            Object.entries(defaultFiles).map(([filename, content]) =>\r\n              debouncedSave(roomId, filename, content)\r\n          )\r\n        )\r\n          return defaultFiles;\r\n        }\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      const requiredFiles = ['index.html', 'style.css', 'script.js'];\r\n      const completeFiles = { ...data };\r\n      \r\n      requiredFiles.forEach(file => {\r\n        if (!completeFiles[file]) {\r\n          completeFiles[file] = file.endsWith('.html') ? '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>' :\r\n                          file.endsWith('.css') ? '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}' :\r\n                          '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");';\r\n        }\r\n      });\r\n      \r\n      return completeFiles;\r\n    } catch (error) {\r\n      console.error('Error loading files:', error);\r\n      return {\r\n        'index.html': '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>',\r\n        'style.css': '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}',\r\n        'script.js': '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");',\r\n      };\r\n    }\r\n  }, [roomId, debouncedSave]);\r\n\r\n  // Initialize socket connection\r\n  const initializeSocket = useCallback((filesData) => {\r\n    if (socketRef.current) {\r\n      socketRef.current.disconnect();\r\n    }\r\n\r\n    const socket = io('http://localhost:5000', {\r\n      transports: ['websocket'],\r\n      upgrade: false,\r\n      reconnectionAttempts: 5,\r\n      reconnectionDelay: 1000,\r\n      timeout: 10000,\r\n    });\r\n\r\n    socket.on('connect', () => {\r\n      console.log('游릭 Connected to server');\r\n      setConnectionStatus('Connected');\r\n      currentUserRef.current = socket.id;\r\n      socket.emit('join-room', { \r\n        roomId, \r\n        username,\r\n        files: filesData \r\n      });\r\n    });\r\n\r\n    socket.on('disconnect', () => {\r\n      console.log('游댮 Disconnected from server');\r\n      setConnectionStatus('Disconnected');\r\n    });\r\n\r\n    socket.on('reconnect', () => {\r\n      console.log('游리 Reconnected to server');\r\n      setConnectionStatus('Connected');\r\n      socket.emit('join-room', { \r\n        roomId, \r\n        username,\r\n        files: files \r\n      });\r\n    });\r\n\r\n    socket.on('room-state', ({ files: roomFiles, users: roomUsers }) => {\r\n      console.log('游늶 Received room state:', { files: Object.keys(roomFiles), users: roomUsers.length });\r\n      setFiles(roomFiles);\r\n      setUsers(roomUsers);\r\n    });\r\n\r\n    socket.on('user-file-switch', ({ userId, username: switchUsername, filePath }) => {\r\n      if (userId !== currentUserRef.current) {\r\n        setUserCursors(prev => ({\r\n          ...prev,\r\n          [userId]: { \r\n            ...prev[userId], \r\n            activeFile: filePath,\r\n            username: switchUsername\r\n          }\r\n        }));\r\n      }\r\n    });\r\n\r\n    socket.on('code-update', ({ filePath, code, sender, position, username: senderUsername }) => {\r\n      if (sender !== currentUserRef.current) {\r\n        console.log('游닇 Code update from', senderUsername, 'for', filePath);\r\n        \r\n        isUpdatingFromSocket.current = true;\r\n        \r\n        setFiles(prev => {\r\n          const newFiles = { ...prev, [filePath]: code };\r\n          \r\n          if (filePath === activeFile && editorRef.current) {\r\n            const model = editorRef.current.getModel();\r\n            if (model && model.getValue() !== code) {\r\n              const currentSelection = editorRef.current.getSelection();\r\n              const scrollInfo = editorRef.current.getScrollTop();\r\n              \r\n              model.setValue(code);\r\n              \r\n              if (currentSelection && !position) {\r\n                editorRef.current.setSelection(currentSelection);\r\n                editorRef.current.setScrollTop(scrollInfo);\r\n              }\r\n            }\r\n          }\r\n          \r\n          return newFiles;\r\n        });\r\n\r\n        if (position) {\r\n          setUserCursors(prev => ({\r\n            ...prev,\r\n            [sender]: { \r\n              ...prev[sender], \r\n              position, \r\n              activeFile: filePath,\r\n              username: senderUsername\r\n            }\r\n          }));\r\n        }\r\n\r\n        if (filePath === activeFile) {\r\n          setTypingUsers(prev => ({\r\n            ...prev,\r\n            [sender]: { username: senderUsername, timestamp: Date.now() }\r\n          }));\r\n        }\r\n\r\n        setTimeout(() => {\r\n          isUpdatingFromSocket.current = false;\r\n        }, 100);\r\n      }\r\n    });\r\n\r\n    socket.on('user-joined', ({ userId, username: newUsername }) => {\r\n      console.log('游녻 User joined:', newUsername);\r\n      setUsers(prev => {\r\n        const exists = prev.find(u => u.id === userId);\r\n        if (!exists) {\r\n          return [...prev, { id: userId, username: newUsername }];\r\n        }\r\n        return prev;\r\n      });\r\n    });\r\n\r\n    socket.on('new-file', ({ filename }) => {\r\n      setFiles(prev => {\r\n        if (!prev[filename]) {\r\n          return { ...prev, [filename]: '' };\r\n        }\r\n        return prev;\r\n      });\r\n    });\r\n\r\n    socket.on('file-removed', ({ filename }) => {\r\n      setFiles(prev => {\r\n        const updated = { ...prev };\r\n        delete updated[filename];\r\n        return updated;\r\n      });\r\n    });\r\n\r\n    socket.on('user-left', ({ userId, username: leftUsername }) => {\r\n      console.log('游녻 User left:', leftUsername);\r\n      setUsers(prev => prev.filter(u => u.id !== userId));\r\n      setActiveUsers(prev => {\r\n        const newActive = { ...prev };\r\n        delete newActive[userId];\r\n        return newActive;\r\n      });\r\n      setUserCursors(prev => {\r\n        const newCursors = { ...prev };\r\n        delete newCursors[userId];\r\n        return newCursors;\r\n      });\r\n      setTypingUsers(prev => {\r\n        const newTyping = { ...prev };\r\n        delete newTyping[userId];\r\n        return newTyping;\r\n      });\r\n    });\r\n\r\n    socket.on('cursor-position', ({ userId, username: cursorUsername, position, activeFile: userActiveFile }) => {\r\n      if (userId !== currentUserRef.current && userActiveFile === activeFile) {\r\n        setUserCursors(prev => ({\r\n          ...prev,\r\n          [userId]: { \r\n            position, \r\n            activeFile: userActiveFile, \r\n            username: cursorUsername,\r\n            timestamp: Date.now()\r\n          }\r\n        }));\r\n      }\r\n    });\r\n\r\n    socket.on('user-typing', ({ userId, username: typingUsername, filePath }) => {\r\n      if (userId !== currentUserRef.current && filePath === activeFile) {\r\n        setTypingUsers(prev => ({\r\n          ...prev,\r\n          [userId]: { username: typingUsername, timestamp: Date.now() }\r\n        }));\r\n      }\r\n    });\r\n\r\n    socketRef.current = socket;\r\n    return socket;\r\n  }, [username, roomId, activeFile, files]);\r\n\r\n  // Clear old typing indicators\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      const now = Date.now();\r\n      setTypingUsers(prev => {\r\n        const updated = { ...prev };\r\n        Object.keys(updated).forEach(userId => {\r\n          if (now - updated[userId].timestamp > 3000) {\r\n            delete updated[userId];\r\n          }\r\n        });\r\n        return updated;\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // Main initialization effect\r\n  useEffect(() => {\r\n    if (!roomId) {\r\n      navigate('/room');\r\n      return;\r\n    }\r\n\r\n    if (initializedRef.current) return;\r\n    initializedRef.current = true;\r\n\r\n    const user = (location.state && location.state.username) ||\r\n                 localStorage.getItem('username') ||\r\n                 'Guest';\r\n    setUsername(user);\r\n\r\n    const initialize = async () => {\r\n      try {\r\n        const filesData = await fetchFiles();\r\n        setFiles(filesData);\r\n        initializeSocket(filesData);\r\n        localStorage.setItem('username', user);\r\n      } catch (error) {\r\n        console.error('Initialization error:', error);\r\n        setConnectionStatus('Initialization failed');\r\n      }\r\n    };\r\n\r\n    initialize();\r\n\r\n    return () => {\r\n      if (socketRef.current) {\r\n        socketRef.current.disconnect();\r\n      }\r\n    };\r\n  }, [roomId, navigate, location.state, fetchFiles, initializeSocket]);\r\n\r\n  // Track cursor position\r\n  useEffect(() => {\r\n    if (!editorRef.current || !socketRef.current?.connected) return;\r\n\r\n    const editor = editorRef.current;\r\n    \r\n    const handleCursorChange = () => {\r\n      if (isUpdatingFromSocket.current) return;\r\n      \r\n      const selection = editor.getSelection();\r\n      if (selection) {\r\n        const position = {\r\n          lineNumber: selection.positionLineNumber,\r\n          column: selection.positionColumn\r\n        };\r\n        \r\n        socketRef.current.emit('cursor-position', {\r\n          roomId,\r\n          filePath: activeFile,\r\n          position,\r\n          username\r\n        });\r\n      }\r\n    };\r\n\r\n    const disposable = editor.onDidChangeCursorPosition(handleCursorChange);\r\n    return () => disposable.dispose();\r\n  }, [roomId, activeFile, username]);\r\n\r\n  // Handle code changes with real-time sync\r\n  const handleCodeChange = useCallback((value) => {\r\n    if (!value) value = '';\r\n    if (isUpdatingFromSocket.current) return;\r\n    \r\n    const timestamp = Date.now();\r\n    lastChangeTimestamp.current = timestamp;\r\n    \r\n    setFiles(prev => {\r\n      if (prev[activeFile] !== value) {\r\n        const newFiles = { ...prev, [activeFile]: value };\r\n        \r\n        if (socketRef.current?.connected) {\r\n          const selection = editorRef.current?.getSelection();\r\n          const position = selection ? {\r\n            lineNumber: selection.positionLineNumber,\r\n            column: selection.positionColumn\r\n          } : null;\r\n          \r\n          socketRef.current.emit('code-change', {\r\n            roomId,\r\n            filePath: activeFile,\r\n            code: value,\r\n            position,\r\n            timestamp,\r\n            username\r\n          });\r\n\r\n          socketRef.current.emit('user-typing', {\r\n            roomId,\r\n            filePath: activeFile,\r\n            username\r\n          });\r\n        }\r\n        \r\n        debouncedSave(roomId, activeFile, value);\r\n        return newFiles;\r\n      }\r\n      return prev;\r\n    });\r\n  }, [activeFile, roomId, debouncedSave, username]);\r\n\r\n  // Handle running the code\r\n  const handleRun = () => {\r\n    if (!files || !iframeRef.current) return;\r\n\r\n    const htmlFiles = Object.entries(files).filter(([f]) => f.endsWith('.html'));\r\n    const cssFiles = Object.entries(files).filter(([f]) => f.endsWith('.css'));\r\n    const jsFiles = Object.entries(files).filter(([f]) => f.endsWith('.js'));\r\n\r\n    const combined = `\r\n      <!DOCTYPE html>\r\n      <html>\r\n        <head>\r\n          ${cssFiles.map(([_, css]) => `<style>${css}</style>`).join('\\n')}\r\n        </head>\r\n        <body>\r\n          ${htmlFiles.map(([_, html]) => html).join('\\n')}\r\n          ${jsFiles.map(([_, js]) => `<script>${js}</script>`).join('\\n')}\r\n        </body>\r\n      </html>\r\n    `;\r\n\r\n    const blob = new Blob([combined], { type: 'text/html' });\r\n    const url = URL.createObjectURL(blob);\r\n    iframeRef.current.src = url;\r\n    setTimeout(() => URL.revokeObjectURL(url), 1000);\r\n  };\r\n\r\n  const handleDownloadProject = () => {\r\n    const zip = new JSZip();\r\n    Object.entries(files).forEach(([filename, content]) => {\r\n      zip.file(filename, content);\r\n    });\r\n\r\n    zip.generateAsync({ type: 'blob' }).then(content => {\r\n      saveAs(content, `${roomId || 'project'}.zip`);\r\n    });\r\n  };\r\n\r\n  const handleAddFile = () => {\r\n    const newFileName = prompt('Enter new file name (e.g. `utils/helper.js`):');\r\n    if (newFileName && !files[newFileName]) {\r\n      setFiles(prev => ({\r\n        ...prev,\r\n        [newFileName]: ''\r\n      }));\r\n      setActiveFile(newFileName);\r\n      \r\n      debouncedSave(roomId, newFileName, '');\r\n      \r\n      if (socketRef.current) {\r\n        socketRef.current.emit('new-file', { \r\n          roomId, \r\n          filename: newFileName \r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleRenameFile = async (oldPath, newPath) => {\r\n    try {\r\n      if (files[newPath]) {\r\n        alert('A file with that name already exists');\r\n        return;\r\n      }\r\n      \r\n      setFiles(prev => {\r\n        const updated = { ...prev };\r\n        updated[newPath] = updated[oldPath];\r\n        delete updated[oldPath];\r\n        return updated;\r\n      });\r\n      \r\n      if (activeFile === oldPath) {\r\n        setActiveFile(newPath);\r\n      }\r\n      \r\n      await debouncedSave(roomId, newPath, files[oldPath]);\r\n      await fetch(`http://localhost:5000/api/code/delete/${roomId}/${encodeURIComponent(oldPath)}`, {\r\n        method: 'DELETE'\r\n      });\r\n    } catch (err) {\r\n      console.error('Error renaming file:', err);\r\n      alert('Error renaming file');\r\n    }\r\n  };\r\n\r\n  const handleDeleteFile = async (fileName) => {\r\n    if (fileName === activeFile) {\r\n      const remaining = Object.keys(files).filter(f => f !== fileName);\r\n      setActiveFile(remaining[0] || '');\r\n    }\r\n\r\n    try {\r\n      await fetch(`http://localhost:5000/api/code/delete/${roomId}/${encodeURIComponent(fileName)}`, {\r\n        method: 'DELETE'\r\n      });\r\n      \r\n      const updatedFiles = { ...files };\r\n      delete updatedFiles[fileName];\r\n      setFiles(updatedFiles);\r\n      \r\n      if (socketRef.current) {\r\n        socketRef.current.emit('file-deleted', {\r\n          roomId,\r\n          filename: fileName\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.error('Error deleting file:', err);\r\n      alert('Error deleting file');\r\n    }\r\n  };\r\n\r\n  const handleFileSwitch = (fileName) => {\r\n    setActiveFile(fileName);\r\n    if (socketRef.current?.connected) {\r\n      socketRef.current.emit('file-switch', {\r\n        roomId,\r\n        filePath: fileName,\r\n        username\r\n      });\r\n    }\r\n  };\r\n\r\n  const getLanguage = (file) => {\r\n    if (file.endsWith('.js')) return 'javascript';\r\n    if (file.endsWith('.html')) return 'html';\r\n    if (file.endsWith('.css')) return 'css';\r\n    return 'plaintext';\r\n  };\r\n\r\n  useBeforeUnload(() => {\r\n    if (socketRef.current) {\r\n      socketRef.current.disconnect();\r\n    }\r\n  });\r\n\r\n  if (!files) {\r\n    return (\r\n      <div className=\"editor-wrapper\">\r\n        <div className=\"loading-screen\">\r\n          <div className=\"loading-spinner\"></div>\r\n          <div>Loading collaborative editor...</div>\r\n          <div className=\"connection-status\">{connectionStatus}</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const typingUsersList = Object.values(typingUsers);\r\n\r\n  return (\r\n    <div className=\"editor-wrapper\">\r\n      <div className=\"collaboration-bar\">\r\n        <div className=\"room-info\">\r\n          <strong>Room:</strong> {roomId} | <strong>User:</strong> {username}\r\n          <span className={`connection-status ${connectionStatus === 'Connected' ? 'connected' : 'disconnected'}`}>\r\n            餃 {connectionStatus}\r\n          </span>\r\n        </div>\r\n        \r\n        <div className=\"online-users\">\r\n          <span className=\"users-label\">Online ({users.length}):</span>\r\n          {users.map(user => (\r\n            <div \r\n              key={user.id} \r\n              className=\"user-badge\"\r\n              style={{ backgroundColor: getUserColor(user.id) }}\r\n            >\r\n              {user.username}\r\n              {user.id === currentUserRef.current && ' (You)'}\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {typingUsersList.length > 0 && (\r\n          <div className=\"typing-indicator\">\r\n            <span className=\"typing-dots\">餃餃餃</span>\r\n            {typingUsersList.map(t => t.username).join(', ')} \r\n            {typingUsersList.length === 1 ? ' is' : ' are'} typing in {activeFile}...\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"editor-container\">\r\n        <div className=\"sidebar\">\r\n          <button \r\n            onClick={handleAddFile} \r\n            style={{ marginBottom: '10px', padding: '5px', width: '100%' }}\r\n          >\r\n            俱 Add File\r\n          </button>\r\n          <FileSidebar\r\n            files={Object.keys(files)}\r\n            activeFile={activeFile}\r\n            setActiveFile={handleFileSwitch}\r\n            onAddFile={handleAddFile}\r\n            onDownload={handleDownloadProject}\r\n            onDeleteFile={handleDeleteFile}\r\n            onRenameFile={handleRenameFile}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"main-editor\">\r\n          <div className=\"editor-header\">\r\n            <div className=\"file-info\">\r\n              <strong>{activeFile}</strong>\r\n              <span className=\"file-language\">({getLanguage(activeFile)})</span>\r\n            </div>\r\n            <button className=\"run-button\" onClick={handleRun}>\r\n              郊 Run Code\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"editor-container-with-cursors\">\r\n            <Editor\r\n              height=\"50vh\"\r\n              language={getLanguage(activeFile)}\r\n              value={files[activeFile] || \"\"}\r\n              onChange={handleCodeChange}\r\n              onMount={editor => {\r\n                editorRef.current = editor;\r\n                editor.onDidChangeCursorPosition(() => {\r\n                  if (socketRef.current?.connected && !isUpdatingFromSocket.current) {\r\n                    const selection = editor.getSelection();\r\n                    if (selection) {\r\n                      const position = {\r\n                        lineNumber: selection.positionLineNumber,\r\n                        column: selection.positionColumn\r\n                      };\r\n                      \r\n                      socketRef.current.emit('cursor-position', {\r\n                        roomId,\r\n                        filePath: activeFile,\r\n                        position,\r\n                        username\r\n                      });\r\n                    }\r\n                  }\r\n                });\r\n              }}\r\n              theme=\"vs-dark\"\r\n              options={{\r\n                minimap: { enabled: false },\r\n                fontSize: 14,\r\n                wordWrap: 'on',\r\n                automaticLayout: true,\r\n                scrollBeyondLastLine: false,\r\n                renderWhitespace: 'selection',\r\n                smoothScrolling: true,\r\n                cursorBlinking: 'smooth',\r\n                cursorSmoothCaretAnimation: true,\r\n              }}\r\n            />\r\n            \r\n            {Object.entries(userCursors).map(([userId, cursor]) => (\r\n              cursor.activeFile === activeFile && (\r\n                <div\r\n                  key={userId}\r\n                  className=\"user-cursor\"\r\n                  style={{\r\n                    position: 'absolute',\r\n                    top: `${(cursor.position?.lineNumber || 0) * 18}px`,\r\n                    left: `${(cursor.position?.column || 0) * 8}px`,\r\n                    borderLeft: `2px solid ${getUserColor(userId)}`,\r\n                    height: '18px',\r\n                    pointerEvents: 'none',\r\n                    zIndex: 1000,\r\n                  }}\r\n                >\r\n                  <div\r\n                    className=\"user-cursor-label\"\r\n                    style={{\r\n                      backgroundColor: getUserColor(userId),\r\n                      color: 'white',\r\n                      padding: '2px 6px',\r\n                      borderRadius: '3px',\r\n                      fontSize: '11px',\r\n                      position: 'absolute',\r\n                      top: '-20px',\r\n                      left: '0',\r\n                      whiteSpace: 'nowrap',\r\n                    }}\r\n                  >\r\n                    {cursor.username}\r\n                  </div>\r\n                </div>\r\n              )\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"output-panel\">\r\n            <div className=\"output-header\">\r\n              <strong>Output Preview</strong>\r\n              <button className=\"refresh-output\" onClick={handleRun}>\r\n                游댃 Refresh\r\n              </button>\r\n            </div>\r\n            <iframe\r\n              ref={iframeRef}\r\n              title=\"Live Code Output\"\r\n              className=\"output-frame\"\r\n              sandbox=\"allow-scripts allow-same-origin allow-forms\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default EditorPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}