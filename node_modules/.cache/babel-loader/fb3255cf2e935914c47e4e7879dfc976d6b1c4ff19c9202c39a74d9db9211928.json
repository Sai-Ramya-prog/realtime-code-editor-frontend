{"ast":null,"code":"import React,{useEffect,useRef,useState,useCallback}from'react';import{useLocation,useParams,useNavigate,useBeforeUnload}from'react-router-dom';import Editor from'@monaco-editor/react';import{io}from'socket.io-client';import FileSidebar from'../components/FileSidebar';import'../styles/editor.css';import{downloadProjectAsZip}from'../utils/downloadZip';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function EditorPage(){const{roomId}=useParams();const location=useLocation();const navigate=useNavigate();const socketRef=useRef(null);const initializedRef=useRef(false);const currentUserRef=useRef(null);const editorRef=useRef(null);const iframeRef=useRef(null);const isUpdatingFromSocket=useRef(false);const lastChangeTimestamp=useRef(0);const[username,setUsername]=useState('');const[files,setFiles]=useState(null);const[activeFile,setActiveFile]=useState('index.html');const[connectionStatus,setConnectionStatus]=useState('Connecting...');const[users,setUsers]=useState([]);const[activeUsers,setActiveUsers]=useState({});const[typingUsers,setTypingUsers]=useState({});const[userCursors,setUserCursors]=useState({});const[showNewFileModal,setShowNewFileModal]=useState(false);const[showNewFolderModal,setShowNewFolderModal]=useState(false);const[newFileName,setNewFileName]=useState('');const[newFolderName,setNewFolderName]=useState('');// Add to your existing state\nconst[fileTree,setFileTree]=useState(null);const[panelWidth,setPanelWidth]=useState(65);const[isDragging,setIsDragging]=useState(false);// Colors for different users\nconst userColors=['#FF6B6B','#4ECDC4','#45B7D1','#96CEB4','#FFEAA7','#DDA0DD','#98D8C8'];const getUserColor=userId=>{const index=Object.keys(activeUsers).indexOf(userId);return userColors[index%userColors.length];};// Debounced save function\n// const debouncedSave = useCallback(\n//   debounce(async (roomId, filename, content) => {\n//     try {\n//       await fetch('http://localhost:5000/api/code/save', {\n//         method: 'POST',\n//         headers: { 'Content-Type': 'application/json' },\n//         body: JSON.stringify({ roomId, filename, content }),\n//       });\n//     } catch (err) {\n//       console.error('Error saving file:', err);\n//     }\n//   }, 2000),\n//   [roomId]);\nconst debouncedSave=debounce(async(roomId,filename,content)=>{try{await fetch('https://realtime-code-editor-backend-l2ok.onrender.com/api/code/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({roomId,filename,content})});}catch(err){console.error('Error saving file:',err);}},2000);//const debouncedSave = useCallback(debouncedFunction, []);\nconst fetchFiles=useCallback(async()=>{if(!roomId)return;try{const response=await fetch(`https://realtime-code-editor-backend-l2ok.onrender.com/api/code/${roomId}`);if(!response.ok){if(response.status===404){// Create default files structure\nconst defaultFiles={'index.html':'<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>','style.css':'/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}','script.js':'// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");'};// Save default files to database\nawait Promise.all(Object.entries(defaultFiles).map(_ref=>{let[filename,content]=_ref;return debouncedSave(roomId,filename,content);}));// Create default tree structure\nconst defaultTree={name:'root',type:'folder',path:'',children:[{name:'index.html',type:'file',path:'index.html',content:defaultFiles['index.html']},{name:'style.css',type:'file',path:'style.css',content:defaultFiles['style.css']},{name:'script.js',type:'file',path:'script.js',content:defaultFiles['script.js']}]};return{files:defaultFiles,tree:defaultTree};}throw new Error(`HTTP error! status: ${response.status}`);}const{files,tree}=await response.json();// Ensure required files exist\nconst requiredFiles=['index.html','style.css','script.js'];const completeFiles={...files};requiredFiles.forEach(file=>{if(!completeFiles[file]){completeFiles[file]=file.endsWith('.html')?'<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>':file.endsWith('.css')?'/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}':'// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");';// Add missing file to tree if it doesn't exist\nif(!tree.children.some(child=>child.name===file)){tree.children.push({name:file,type:'file',path:file,content:completeFiles[file]});}}});return{files:completeFiles,tree:tree};}catch(error){console.error('Error loading files:',error);// Fallback to default structure\nconst defaultFiles={'index.html':'<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>','style.css':'/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}','script.js':'// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");'};const defaultTree={name:'root',type:'folder',path:'',children:[{name:'index.html',type:'file',path:'index.html',content:defaultFiles['index.html']},{name:'style.css',type:'file',path:'style.css',content:defaultFiles['style.css']},{name:'script.js',type:'file',path:'script.js',content:defaultFiles['script.js']}]};return{files:defaultFiles,tree:defaultTree};}},[roomId,debouncedSave]);// Initialize socket connection\nconst initializeSocket=useCallback(filesData=>{if(socketRef.current){socketRef.current.disconnect();}const socket=io('https://realtime-code-editor-backend-l2ok.onrender.com',{transports:['websocket'],upgrade:false,reconnectionAttempts:5,reconnectionDelay:1000,timeout:10000});socket.on('room-error',msg=>{alert(msg);// Show the error message\nnavigate('/room');// Redirect user back to RoomPage\n});socket.on('connect',()=>{console.log('🟢 Connected to server');setConnectionStatus('Connected');currentUserRef.current=socket.id;socket.emit('join-room',{roomId,username,files:filesData});});socket.on('disconnect',()=>{console.log('🔴 Disconnected from server');setConnectionStatus('Disconnected');});socket.on('reconnect',()=>{console.log('🟡 Reconnected to server');setConnectionStatus('Connected');socket.emit('join-room',{roomId,username,files:files});});socket.on('room-state',_ref2=>{let{files:roomFiles,users:roomUsers}=_ref2;console.log('📋 Received room state:',{files:Object.keys(roomFiles),users:roomUsers.length});setFiles(roomFiles);setUsers(roomUsers);});socket.on('code-update',_ref3=>{let{filePath,code,sender,position,username:senderUsername}=_ref3;if(sender!==currentUserRef.current){console.log('📝 Code update from',senderUsername,'for',filePath);isUpdatingFromSocket.current=true;// Update both files state and file tree state in a single batch\nsetFiles(prevFiles=>{const newFiles={...prevFiles,[filePath]:code};// Update editor content if it's the active file\nif(filePath===activeFile&&editorRef.current){var _editorRef$current$mo;const model=(_editorRef$current$mo=editorRef.current.models)===null||_editorRef$current$mo===void 0?void 0:_editorRef$current$mo[filePath];if(model&&model.getValue()!==code){// Save current cursor position\nconst currentSelection=editorRef.current.getSelection();const scrollInfo=editorRef.current.getScrollTop();// Update content\nmodel.setValue(code);// Restore cursor position if it was the current user's cursor\nif(currentSelection&&!position){editorRef.current.setSelection(currentSelection);editorRef.current.setScrollTop(scrollInfo);}}}return newFiles;});// Update the file tree structure\nsetFileTree(prevTree=>{if(!prevTree)return prevTree;// Create a deep clone of the tree\nconst newTree=JSON.parse(JSON.stringify(prevTree));// Function to find and update the file in the tree\nconst updateFileContent=nodes=>{for(let node of nodes){if(node.path===filePath&&node.type==='file'){node.content=code;return true;}if(node.children&&updateFileContent(node.children)){return true;}}return false;};updateFileContent(newTree.children);return newTree;});// Update user cursor position\nif(position){setUserCursors(prev=>({...prev,[sender]:{...prev[sender],position,activeFile:filePath,username:senderUsername}}));}// Show typing indicator\nif(filePath===activeFile){setTypingUsers(prev=>({...prev,[sender]:{username:senderUsername,timestamp:Date.now()}}));}setTimeout(()=>{isUpdatingFromSocket.current=false;},100);}});socket.on('file-deleted',_ref4=>{let{path}=_ref4;setFiles(prev=>{const newFiles={...prev};delete newFiles[path];return newFiles;});setFileTree(prevTree=>{if(!prevTree)return prevTree;const newTree=JSON.parse(JSON.stringify(prevTree));const removeNode=nodes=>{for(let i=0;i<nodes.length;i++){if(nodes[i].path===path){nodes.splice(i,1);return true;}if(nodes[i].children&&removeNode(nodes[i].children)){return true;}}return false;};removeNode(newTree.children);return newTree;});});socket.on('file-renamed',_ref5=>{let{oldPath,newPath}=_ref5;setFiles(prev=>{const newFiles={...prev};if(newFiles[oldPath]){newFiles[newPath]=newFiles[oldPath];delete newFiles[oldPath];}return newFiles;});setFileTree(prevTree=>{if(!prevTree)return prevTree;const newTree=JSON.parse(JSON.stringify(prevTree));const updateNode=nodes=>{for(let node of nodes){if(node.path===oldPath){const newName=newPath.split('/').pop();node.name=newName;node.path=newPath;return true;}if(node.children&&updateNode(node.children)){return true;}}return false;};updateNode(newTree.children);return newTree;});if(activeFile===oldPath){setActiveFile(newPath);}});socket.on('folder-renamed',_ref6=>{let{oldPath,newPath}=_ref6;// Update files\nsetFiles(prev=>{const updated={};for(const key in prev){if(key.startsWith(oldPath)){const newKey=key.replace(oldPath,newPath);updated[newKey]=prev[key];}else{updated[key]=prev[key];}}return updated;});// Update file tree\nsetFileTree(prevTree=>{if(!prevTree)return prevTree;const newTree=JSON.parse(JSON.stringify(prevTree));const updatePaths=nodes=>{nodes.forEach(node=>{if(node.path.startsWith(oldPath)){node.path=node.path.replace(oldPath,newPath);if(node.type==='folder'){node.name=newPath.replace(/\\/$/,'').split('/').pop();}}if(node.children)updatePaths(node.children);});};updatePaths(newTree.children);return newTree;});});socket.on('folder-deleted',_ref7=>{let{path}=_ref7;setFiles(prev=>{const updated={};for(const key in prev){if(!key.startsWith(path)){updated[key]=prev[key];}}return updated;});setFileTree(prevTree=>{if(!prevTree)return prevTree;const newTree=JSON.parse(JSON.stringify(prevTree));const removeFolder=nodes=>{for(let i=0;i<nodes.length;i++){if(nodes[i].path===path){nodes.splice(i,1);return true;}if(nodes[i].children&&removeFolder(nodes[i].children)){return true;}}return false;};removeFolder(newTree.children);return newTree;});});socket.on('user-joined',_ref8=>{let{userId,username:newUsername}=_ref8;console.log('👤 User joined:',newUsername);setUsers(prev=>{const exists=prev.find(u=>u.id===userId);if(!exists){return[...prev,{id:userId,username:newUsername}];}return prev;});});socket.on('user-left',_ref9=>{let{userId,username:leftUsername}=_ref9;console.log('👤 User left:',leftUsername);setUsers(prev=>prev.filter(u=>u.id!==userId));setActiveUsers(prev=>{const newActive={...prev};delete newActive[userId];return newActive;});setUserCursors(prev=>{const newCursors={...prev};delete newCursors[userId];return newCursors;});setTypingUsers(prev=>{const newTyping={...prev};delete newTyping[userId];return newTyping;});});socket.on('cursor-position',_ref0=>{let{userId,username:cursorUsername,position,activeFile:userActiveFile}=_ref0;if(userId!==currentUserRef.current&&userActiveFile===activeFile){setUserCursors(prev=>({...prev,[userId]:{position,activeFile:userActiveFile,username:cursorUsername,timestamp:Date.now()}}));}});socket.on('user-typing',_ref1=>{let{userId,username:typingUsername,filePath}=_ref1;if(userId!==currentUserRef.current&&filePath===activeFile){setTypingUsers(prev=>({...prev,[userId]:{username:typingUsername,timestamp:Date.now()}}));}});// Listen for remote file creation\nsocket.on('remote-file-created',_ref10=>{let{filePath,content}=_ref10;setFiles(prev=>({...prev,[filePath]:content}));setFileTree(prevTree=>{if(!prevTree)return prevTree;const newTree=JSON.parse(JSON.stringify(prevTree));// Deep copy\nconst parts=filePath.split('/');const fileName=parts.pop();// last item is the file name\nconst folderPathParts=parts;let current=newTree;for(const part of folderPathParts){let folder=current.children.find(child=>child.name===part&&child.type==='folder');if(!folder){folder={name:part,type:'folder',path:(current.path||'')+part+'/',children:[]};current.children.push(folder);}current=folder;}// Add the new file under the right folder\ncurrent.children.push({name:fileName,type:'file',path:filePath,content});return newTree;});});// Listen for remote folder creation\nsocket.on('remote-folder-created',_ref11=>{let{path}=_ref11;setFileTree(prevTree=>{if(!prevTree)return prevTree;const exists=prevTree.children.some(child=>child.path===path);if(!exists){return{...prevTree,children:[...prevTree.children,{name:path.replace(/\\/$/,'').split('/').pop(),type:'folder',path,children:[]}]};}return prevTree;});});socketRef.current=socket;return socket;},[username,roomId,activeFile,files,navigate]);// Clear old typing indicators\nuseEffect(()=>{const interval=setInterval(()=>{const now=Date.now();setTypingUsers(prev=>{const updated={...prev};Object.keys(updated).forEach(userId=>{if(now-updated[userId].timestamp>3000){delete updated[userId];}});return updated;});},1000);return()=>clearInterval(interval);},[]);useEffect(()=>{if(!socketRef.current)return;const socket=socketRef.current;socket.on('file-deleted',_ref12=>{let{path}=_ref12;setFiles(prev=>{const newFiles={...prev};delete newFiles[path];return newFiles;});setFileTree(prevTree=>{if(!prevTree)return prevTree;const newTree=JSON.parse(JSON.stringify(prevTree));const removeNode=nodes=>{for(let i=0;i<nodes.length;i++){if(nodes[i].path===path){nodes.splice(i,1);return true;}if(nodes[i].children&&removeNode(nodes[i].children)){return true;}}return false;};removeNode(newTree.children);return newTree;});});socket.on('file-renamed',_ref13=>{let{oldPath,newPath}=_ref13;setFiles(prev=>{const newFiles={...prev};if(newFiles[oldPath]){newFiles[newPath]=newFiles[oldPath];delete newFiles[oldPath];}return newFiles;});setFileTree(prevTree=>{if(!prevTree)return prevTree;const newTree=JSON.parse(JSON.stringify(prevTree));const updateNode=nodes=>{for(let node of nodes){if(node.path===oldPath){const newName=newPath.split('/').pop();node.name=newName;node.path=newPath;return true;}if(node.children&&updateNode(node.children)){return true;}}return false;};updateNode(newTree.children);return newTree;});if(activeFile===oldPath){setActiveFile(newPath);}});return()=>{socket.off('file-deleted');socket.off('file-renamed');};},[activeFile]);useEffect(()=>{if(!socketRef.current)return;const socket=socketRef.current;// 🔁 Folder Renamed\nsocket.on('folder-renamed',_ref14=>{let{oldPath,newPath}=_ref14;setFiles(prev=>{const updated={};for(const key in prev){if(key.startsWith(oldPath)){const updatedKey=key.replace(oldPath,newPath);updated[updatedKey]=prev[key];}else{updated[key]=prev[key];}}return updated;});setFileTree(prev=>{if(!prev)return prev;const tree=JSON.parse(JSON.stringify(prev));const updatePaths=nodes=>{nodes.forEach(node=>{if(node.path.startsWith(oldPath)){node.path=node.path.replace(oldPath,newPath);if(node.type==='folder'){node.name=newPath.replace(/\\/$/,'').split('/').pop();}}if(node.children)updatePaths(node.children);});};updatePaths(tree.children);return tree;});});// 🗑️ Folder Deleted\nsocket.on('folder-deleted',_ref15=>{let{path}=_ref15;setFiles(prev=>{const updated={};for(const key in prev){if(!key.startsWith(path)){updated[key]=prev[key];}}return updated;});setFileTree(prev=>{if(!prev)return prev;const tree=JSON.parse(JSON.stringify(prev));const removeFolder=nodes=>{for(let i=0;i<nodes.length;i++){if(nodes[i].path===path){nodes.splice(i,1);return true;}if(nodes[i].children&&removeFolder(nodes[i].children)){return true;}}return false;};removeFolder(tree.children);return tree;});});return()=>{socket.off('folder-renamed');socket.off('folder-deleted');};},[]);// Main initialization effect\nuseEffect(()=>{if(!roomId){navigate('/room');return;}if(initializedRef.current)return;initializedRef.current=true;const user=location.state&&location.state.username||localStorage.getItem('username')||'Guest';setUsername(user);const initialize=async()=>{try{// 1. Fetch files - now returns { files, tree }\nconst{files:filesData,tree}=await fetchFiles();// 2. Set both states\nsetFiles(filesData);setFileTree(tree);// Make sure you have this state: const [fileTree, setFileTree] = useState(null);\n// 3. Initialize socket with the flat files data\ninitializeSocket(filesData);// 4. Set username (unchanged)\nlocalStorage.setItem('username',user);// 5. Set default active file if needed\nif(!activeFile){setActiveFile('index.html');}}catch(error){console.error('Initialization error:',error);setConnectionStatus('Initialization failed');}};initialize();return()=>{if(socketRef.current){socketRef.current.disconnect();}};},[roomId,navigate,location.state,fetchFiles,initializeSocket,activeFile]);// Track cursor position more frequently\nuseEffect(()=>{var _socketRef$current;if(!editorRef.current||!((_socketRef$current=socketRef.current)!==null&&_socketRef$current!==void 0&&_socketRef$current.connected))return;const editor=editorRef.current;const handleCursorChange=()=>{if(isUpdatingFromSocket.current)return;const selection=editor.getSelection();if(selection){const position={lineNumber:selection.positionLineNumber,column:selection.positionColumn};socketRef.current.emit('cursor-position',{roomId,filePath:activeFile,position,username});}};const disposable=editor.onDidChangeCursorPosition(handleCursorChange);return()=>disposable.dispose();},[roomId,activeFile,username]);// Handle code changes with real-time sync\nconst handleMouseMove=useCallback(e=>{if(!isDragging)return;const container=document.querySelector('.main-editor');if(!container)return;const containerRect=container.getBoundingClientRect();const containerWidth=containerRect.width;const mouseX=e.clientX-containerRect.left;const newWidth=mouseX/containerWidth*100;// Limit the width between 20% and 80%\nsetPanelWidth(Math.min(Math.max(newWidth,30),70));},[isDragging]);const handleMouseUp=useCallback(()=>{setIsDragging(false);document.body.style.cursor='';document.removeEventListener('mousemove',handleMouseMove);document.removeEventListener('mouseup',handleMouseUp);},[handleMouseMove]);// Add this to your cleanup effects\nuseEffect(()=>{return()=>{document.removeEventListener('mousemove',handleMouseMove);document.removeEventListener('mouseup',handleMouseUp);};},[handleMouseMove,handleMouseUp]);const handleMouseDown=useCallback(e=>{e.preventDefault();setIsDragging(true);document.body.style.cursor='col-resize';document.addEventListener('mousemove',handleMouseMove);document.addEventListener('mouseup',handleMouseUp);},[handleMouseMove,handleMouseUp]);const handleCodeChange=useCallback(value=>{if(!value)value='';if(isUpdatingFromSocket.current)return;const timestamp=Date.now();lastChangeTimestamp.current=timestamp;setFiles(prev=>{if(prev[activeFile]!==value){var _socketRef$current2;const newFiles={...prev,[activeFile]:value};if((_socketRef$current2=socketRef.current)!==null&&_socketRef$current2!==void 0&&_socketRef$current2.connected){var _editorRef$current;const selection=(_editorRef$current=editorRef.current)===null||_editorRef$current===void 0?void 0:_editorRef$current.getSelection();const position=selection?{lineNumber:selection.positionLineNumber,column:selection.positionColumn}:null;// Emit real-time changes\nsocketRef.current.emit('code-change',{roomId,filePath:activeFile,code:value,position,timestamp,username});// Emit typing indicator\nsocketRef.current.emit('user-typing',{roomId,filePath:activeFile,username});}// Debounced save to database\ndebouncedSave(roomId,activeFile,value);return newFiles;}return prev;});},[activeFile,roomId,debouncedSave,username]);const handleAddFile=()=>{setShowNewFileModal(true);};const handleAddFolder=()=>{setShowNewFolderModal(true);};const createNewFile=async()=>{if(!newFileName)return;const fileExt=newFileName.split('.').pop();let defaultContent='';if(fileExt==='html'){defaultContent='<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>New File</title>\\n</head>\\n<body>\\n    \\n</body>\\n</html>';}else if(fileExt==='css'){defaultContent='/* Your CSS here */';}else if(fileExt==='js'){defaultContent='// Your JavaScript here';}try{var _socketRef$current3,_socketRef$current4;// Save to backend first\nawait fetch('https://realtime-code-editor-backend-l2ok.onrender.com/api/code/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({roomId,filePath:newFileName,content:defaultContent})});// Then update local state\nsetFiles(prev=>({...prev,[newFileName]:defaultContent}));setFileTree(prevTree=>{if(!prevTree)return prevTree;// Check if file already exists in tree\nconst exists=prevTree.children.some(child=>child.path===newFileName);if(!exists){return{...prevTree,children:[...prevTree.children,{name:newFileName,type:'file',path:newFileName,content:defaultContent}]};}return prevTree;});if((_socketRef$current3=socketRef.current)!==null&&_socketRef$current3!==void 0&&_socketRef$current3.connected){socketRef.current.emit('new-file-created',{roomId,filePath:newFileName,content:defaultContent,username});}setActiveFile(newFileName);setShowNewFileModal(false);setNewFileName('');// Notify other users\nif((_socketRef$current4=socketRef.current)!==null&&_socketRef$current4!==void 0&&_socketRef$current4.connected){socketRef.current.emit('code-change',{roomId,filePath:newFileName,code:defaultContent,username});}}catch(error){console.error('Error creating file:',error);}};const createFileAtPath=async path=>{var _socketRef$current5;const fileExt=path.split('.').pop();let defaultContent='';if(fileExt==='html')defaultContent='<!DOCTYPE html>\\n<html>\\n<head>\\n<title></title>\\n</head>\\n<body>\\n</body>\\n</html>';if(fileExt==='css')defaultContent='/* CSS here */';if(fileExt==='js')defaultContent='// JS here';await fetch('https://realtime-code-editor-backend-l2ok.onrender.com/api/code/save',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({roomId,filePath:path,content:defaultContent})});setFiles(prev=>({...prev,[path]:defaultContent}));setFileTree(prevTree=>{if(!prevTree)return prevTree;const newNode={name:path.split('/').pop(),type:'file',path,content:defaultContent};// Recursively insert file under the correct folder\nconst insertFile=(tree,folderPath)=>{if(tree.path===folderPath){tree.children.push(newNode);return true;}for(const child of tree.children){if(child.type==='folder'&&insertFile(child,folderPath))return true;}return false;};const updatedTree=JSON.parse(JSON.stringify(prevTree));insertFile(updatedTree,path.substring(0,path.lastIndexOf('/')+1));return updatedTree;});if((_socketRef$current5=socketRef.current)!==null&&_socketRef$current5!==void 0&&_socketRef$current5.connected){socketRef.current.emit('new-file-created',{roomId,filePath:path,content:defaultContent,username});}};const createNewFolder=async()=>{if(!newFolderName)return;try{var _socketRef$current6;// Ensure folder path ends with /\nconst folderPath=newFolderName.endsWith('/')?newFolderName:`${newFolderName}/`;// Save to backend\nawait fetch('https://realtime-code-editor-backend-l2ok.onrender.com/api/code/createFolder',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({roomId,path:folderPath})});// Update local state\nsetFileTree(prevTree=>{if(!prevTree)return prevTree;// Check if folder already exists\nconst exists=prevTree.children.some(child=>child.path===folderPath);if(!exists){return{...prevTree,children:[...prevTree.children,{name:newFolderName,type:'folder',path:folderPath,children:[]}]};}return prevTree;});setShowNewFolderModal(false);setNewFolderName('');if((_socketRef$current6=socketRef.current)!==null&&_socketRef$current6!==void 0&&_socketRef$current6.connected){socketRef.current.emit('new-folder-created',{roomId,path:folderPath,username});}}catch(error){console.error('Error creating folder:',error);}};// Handle running the code\nconst handleRun=()=>{if(!files||!iframeRef.current)return;const html=files['index.html']||'';const css=files['style.css']||'';const js=files['script.js']||'';const combined=`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <style>${css}</style>\n        </head>\n        <body>\n          ${html}\n          <script>\n            // Error handling for iframe\n            window.onerror = function(msg, url, line, col, error) {\n              console.error('Error:', msg, 'at', line + ':' + col);\n              return false;\n            };\n            ${js}\n          </script>\n        </body>\n      </html>\n    `;const blob=new Blob([combined],{type:'text/html'});const url=URL.createObjectURL(blob);iframeRef.current.src=url;setTimeout(()=>URL.revokeObjectURL(url),1000);};// Handle file switching\n// const handleFileSwitch = (fileName) => {\n//   setActiveFile(fileName);\n//    if (editorRef.current?.models?.[fileName]) {\n//   editorRef.current.setModel(editorRef.current.models[fileName]);\n// }\n//   if (socketRef.current?.connected) {\n//     socketRef.current.emit('file-switch', {\n//       roomId,\n//       filePath: fileName,\n//       username\n//     });\n//   }\n// };\nconst handleEditorMount=(editor,monaco)=>{editorRef.current=editor;// Initialize models object if not present\nif(!editorRef.current.models){editorRef.current.models={};}// Create or reuse a separate model for each file\nObject.entries(files).forEach(_ref16=>{let[filePath,content]=_ref16;if(!editorRef.current.models[filePath]){const lang=getLanguage(filePath);editorRef.current.models[filePath]=monaco.editor.createModel(content,lang);}});// Set current active model\nconst activeModel=editorRef.current.models[activeFile];if(activeModel){editor.setModel(activeModel);}// Cursor tracking\neditor.onDidChangeCursorPosition(()=>{var _socketRef$current7;if((_socketRef$current7=socketRef.current)!==null&&_socketRef$current7!==void 0&&_socketRef$current7.connected&&!isUpdatingFromSocket.current){const selection=editor.getSelection();if(selection){const position={lineNumber:selection.positionLineNumber,column:selection.positionColumn};socketRef.current.emit('cursor-position',{roomId,filePath:activeFile,position,username});}}});};const handleFileSwitch=fileName=>{var _editorRef$current2,_editorRef$current2$m;setActiveFile(fileName);const model=(_editorRef$current2=editorRef.current)===null||_editorRef$current2===void 0?void 0:(_editorRef$current2$m=_editorRef$current2.models)===null||_editorRef$current2$m===void 0?void 0:_editorRef$current2$m[fileName];if(model){editorRef.current.setModel(model);// ✅ this is correct\n}};// Cleanup on page unload\nuseBeforeUnload(()=>{if(socketRef.current){socketRef.current.disconnect();}});const getLanguage=file=>{if(file.endsWith('.js'))return'javascript';if(file.endsWith('.html'))return'html';if(file.endsWith('.css'))return'css';return'plaintext';};if(!files||!fileTree){return/*#__PURE__*/_jsx(\"div\",{className:\"editor-wrapper\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"loading-screen\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"div\",{children:\"Loading collaborative editor...\"}),/*#__PURE__*/_jsx(\"div\",{className:\"connection-status\",children:connectionStatus})]})});}const typingUsersList=Object.values(typingUsers);return/*#__PURE__*/_jsxs(\"div\",{className:\"editor-wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"collaboration-bar\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"room-info\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Room:\"}),\" \",roomId,\" | \",/*#__PURE__*/_jsx(\"strong\",{children:\"User:\"}),\" \",username,/*#__PURE__*/_jsxs(\"span\",{className:`connection-status ${connectionStatus==='Connected'?'connected':'disconnected'}`,children:[\"\\u25CF \",connectionStatus]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"online-users\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"users-label\",children:[\"Online (\",users.length,\"):\"]}),users.map(user=>/*#__PURE__*/_jsxs(\"div\",{className:\"user-badge\",style:{backgroundColor:getUserColor(user.id)},children:[user.username,user.id===currentUserRef.current&&' (You)']},user.id))]}),typingUsersList.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"typing-indicator\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"typing-dots\",children:\"\\u25CF\\u25CF\\u25CF\"}),typingUsersList.map(t=>t.username).join(', '),typingUsersList.length===1?' is':' are',\" typing in \",activeFile,\"...\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"editor-container\",style:{flexDirection:'row'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"sidebar\",children:/*#__PURE__*/_jsx(FileSidebar,{tree:fileTree,activeFile:activeFile,setActiveFile:handleFileSwitch,onAddFile:handleAddFile,onAddFolder:handleAddFolder,onAddFileToFolder:createFileAtPath,roomId:roomId,setFiles:setFiles// Pass down the setter\n,setFileTree:setFileTree// Pass down the setter\n,socketRef:socketRef// Pass down the ref\n,username:username})}),/*#__PURE__*/_jsxs(\"div\",{className:\"main-editor noselect\",style:{display:'flex',flexDirection:'row',flex:1},children:[/*#__PURE__*/_jsxs(\"div\",{style:{width:`${panelWidth}%`,display:'flex',flexDirection:'column',minWidth:'300px'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"editor-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"file-info\",children:[/*#__PURE__*/_jsx(\"strong\",{children:activeFile}),/*#__PURE__*/_jsxs(\"span\",{className:\"file-language\",children:[\"(\",getLanguage(activeFile),\")\"]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"run-button\",onClick:handleRun,children:\"\\u25B6 Run\"}),/*#__PURE__*/_jsx(\"button\",{className:\"download-button\",onClick:downloadProjectAsZip,children:\"\\u2B07 Download ZIP\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"editor-container-with-cursors\",children:[/*#__PURE__*/_jsx(Editor,{height:\"50vh\",language:getLanguage(activeFile),value:files[activeFile]||\"\",onChange:handleCodeChange,onMount:handleEditorMount//(editor,monaco) => {\n//                 editorRef.current = editor;\n//                  if (!editorRef.current.models) {\n//     editorRef.current.models = {};\n//   }\n//   Object.entries(files).forEach(([filePath, content]) => {\n//     if (!editorRef.current.models[filePath]) {\n//       const language = getLanguage(filePath);\n//       editorRef.current.models[filePath] = monaco.editor.createModel(content, language);\n//     } \n//   });\n//   editor.setModel(editorRef.current.models[activeFile]);\n//   // Save the models for reuse\n// //  editorRef.current.models = models;\n//                 // Add cursor tracking\n//                 editor.onDidChangeCursorPosition(() => {\n//                   if (socketRef.current?.connected && !isUpdatingFromSocket.current) {\n//                     const selection = editor.getSelection();\n//                     if (selection) {\n//                       const position = {\n//                         lineNumber: selection.positionLineNumber,\n//                         column: selection.positionColumn\n//                       };\n//                       socketRef.current.emit('cursor-position', {\n//                         roomId,\n//                         filePath: activeFile,\n//                         position,\n//                         username\n//                       });\n//                     }\n//                   }\n//                 });\n//               }}\n,theme:\"vs-dark\",options:{minimap:{enabled:false},fontSize:14,wordWrap:'on',automaticLayout:true,scrollBeyondLastLine:false,renderWhitespace:'selection',smoothScrolling:true,cursorBlinking:'smooth',cursorSmoothCaretAnimation:true}}),Object.entries(userCursors).map(_ref17=>{var _cursor$position,_cursor$position2;let[userId,cursor]=_ref17;return cursor.activeFile===activeFile&&/*#__PURE__*/_jsx(\"div\",{className:\"user-cursor\",style:{position:'absolute',top:`${(((_cursor$position=cursor.position)===null||_cursor$position===void 0?void 0:_cursor$position.lineNumber)||0)*18}px`,left:`${(((_cursor$position2=cursor.position)===null||_cursor$position2===void 0?void 0:_cursor$position2.column)||0)*8}px`,borderLeft:`2px solid ${getUserColor(userId)}`,height:'18px',pointerEvents:'none',zIndex:1000},children:/*#__PURE__*/_jsx(\"div\",{className:\"user-cursor-label\",style:{backgroundColor:getUserColor(userId),color:'white',padding:'2px 6px',borderRadius:'3px',fontSize:'11px',position:'absolute',top:'-20px',left:'0',whiteSpace:'nowrap'},children:cursor.username})},userId);})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"resize-handle\",onMouseDown:handleMouseDown,style:{width:'5px',cursor:'col-resize',backgroundColor:isDragging?'#007acc':'#3e3e42',transition:'background-color 0.2s ease'}}),/*#__PURE__*/_jsxs(\"div\",{className:\"output-panel\",style:{width:`${100-panelWidth}%`,minWidth:'300px'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"output-header\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Output Preview\"}),/*#__PURE__*/_jsx(\"button\",{className:\"refresh-output\",onClick:handleRun,children:\"\\uD83D\\uDD04 Refresh\"})]}),/*#__PURE__*/_jsx(\"iframe\",{ref:iframeRef,title:\"Live Code Output\",className:\"output-frame\",style:{flex:1,border:'none',background:'white',width:'100%',height:'100%'},sandbox:\"allow-scripts allow-same-origin allow-forms\"})]})]})]}),showNewFileModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Create New File\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"filename.html/.css/.js\",value:newFileName,onChange:e=>setNewFileName(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowNewFileModal(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{onClick:createNewFile,children:\"Create\"})]})]})}),showNewFolderModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Create New Folder\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Folder name\",value:newFolderName,onChange:e=>setNewFolderName(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowNewFolderModal(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{onClick:createNewFolder,children:\"Create\"})]})]})})]});}function debounce(func,wait){let timeout;return function executedFunction(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}const later=()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};}export default EditorPage;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useLocation","useParams","useNavigate","useBeforeUnload","Editor","io","FileSidebar","downloadProjectAsZip","jsx","_jsx","jsxs","_jsxs","EditorPage","roomId","location","navigate","socketRef","initializedRef","currentUserRef","editorRef","iframeRef","isUpdatingFromSocket","lastChangeTimestamp","username","setUsername","files","setFiles","activeFile","setActiveFile","connectionStatus","setConnectionStatus","users","setUsers","activeUsers","setActiveUsers","typingUsers","setTypingUsers","userCursors","setUserCursors","showNewFileModal","setShowNewFileModal","showNewFolderModal","setShowNewFolderModal","newFileName","setNewFileName","newFolderName","setNewFolderName","fileTree","setFileTree","panelWidth","setPanelWidth","isDragging","setIsDragging","userColors","getUserColor","userId","index","Object","keys","indexOf","length","debouncedSave","debounce","filename","content","fetch","method","headers","body","JSON","stringify","err","console","error","fetchFiles","response","ok","status","defaultFiles","Promise","all","entries","map","_ref","defaultTree","name","type","path","children","tree","Error","json","requiredFiles","completeFiles","forEach","file","endsWith","some","child","push","initializeSocket","filesData","current","disconnect","socket","transports","upgrade","reconnectionAttempts","reconnectionDelay","timeout","on","msg","alert","log","id","emit","_ref2","roomFiles","roomUsers","_ref3","filePath","code","sender","position","senderUsername","prevFiles","newFiles","_editorRef$current$mo","model","models","getValue","currentSelection","getSelection","scrollInfo","getScrollTop","setValue","setSelection","setScrollTop","prevTree","newTree","parse","updateFileContent","nodes","node","prev","timestamp","Date","now","setTimeout","_ref4","removeNode","i","splice","_ref5","oldPath","newPath","updateNode","newName","split","pop","_ref6","updated","key","startsWith","newKey","replace","updatePaths","_ref7","removeFolder","_ref8","newUsername","exists","find","u","_ref9","leftUsername","filter","newActive","newCursors","newTyping","_ref0","cursorUsername","userActiveFile","_ref1","typingUsername","_ref10","parts","fileName","folderPathParts","part","folder","_ref11","interval","setInterval","clearInterval","_ref12","_ref13","off","_ref14","updatedKey","_ref15","user","state","localStorage","getItem","initialize","setItem","_socketRef$current","connected","editor","handleCursorChange","selection","lineNumber","positionLineNumber","column","positionColumn","disposable","onDidChangeCursorPosition","dispose","handleMouseMove","e","container","document","querySelector","containerRect","getBoundingClientRect","containerWidth","width","mouseX","clientX","left","newWidth","Math","min","max","handleMouseUp","style","cursor","removeEventListener","handleMouseDown","preventDefault","addEventListener","handleCodeChange","value","_socketRef$current2","_editorRef$current","handleAddFile","handleAddFolder","createNewFile","fileExt","defaultContent","_socketRef$current3","_socketRef$current4","createFileAtPath","_socketRef$current5","newNode","insertFile","folderPath","updatedTree","substring","lastIndexOf","createNewFolder","_socketRef$current6","handleRun","html","css","js","combined","blob","Blob","url","URL","createObjectURL","src","revokeObjectURL","handleEditorMount","monaco","_ref16","lang","getLanguage","createModel","activeModel","setModel","_socketRef$current7","handleFileSwitch","_editorRef$current2","_editorRef$current2$m","className","typingUsersList","values","backgroundColor","t","join","flexDirection","onAddFile","onAddFolder","onAddFileToFolder","display","flex","minWidth","onClick","height","language","onChange","onMount","theme","options","minimap","enabled","fontSize","wordWrap","automaticLayout","scrollBeyondLastLine","renderWhitespace","smoothScrolling","cursorBlinking","cursorSmoothCaretAnimation","_ref17","_cursor$position","_cursor$position2","top","borderLeft","pointerEvents","zIndex","color","padding","borderRadius","whiteSpace","onMouseDown","transition","ref","title","border","background","sandbox","placeholder","target","func","wait","executedFunction","_len","arguments","args","Array","_key","later","clearTimeout"],"sources":["D:/realtime-code-editor/client/src/pages/EditorPage.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useLocation, useParams, useNavigate, useBeforeUnload } from 'react-router-dom';\r\nimport Editor from '@monaco-editor/react';\r\nimport { io } from 'socket.io-client';\r\nimport FileSidebar from '../components/FileSidebar';\r\nimport '../styles/editor.css';\r\nimport { downloadProjectAsZip } from '../utils/downloadZip';\r\n\r\nfunction EditorPage() {\r\n  const { roomId } = useParams();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const socketRef = useRef(null);\r\n  const initializedRef = useRef(false);\r\n  const currentUserRef = useRef(null);\r\n  const editorRef = useRef(null);\r\n  const iframeRef = useRef(null);\r\n  const isUpdatingFromSocket = useRef(false);\r\n  const lastChangeTimestamp = useRef(0);\r\n\r\n  const [username, setUsername] = useState('');\r\n  const [files, setFiles] = useState(null);\r\n  const [activeFile, setActiveFile] = useState('index.html');\r\n  const [connectionStatus, setConnectionStatus] = useState('Connecting...');\r\n  const [users, setUsers] = useState([]);\r\n  const [activeUsers, setActiveUsers] = useState({});\r\n  const [typingUsers, setTypingUsers] = useState({});\r\n  const [userCursors, setUserCursors] = useState({});\r\nconst [showNewFileModal, setShowNewFileModal] = useState(false);\r\nconst [showNewFolderModal, setShowNewFolderModal] = useState(false);\r\nconst [newFileName, setNewFileName] = useState('');\r\nconst [newFolderName, setNewFolderName] = useState('');\r\n// Add to your existing state\r\nconst [fileTree, setFileTree] = useState(null);\r\n \r\n  const [panelWidth, setPanelWidth] = useState(65); \r\nconst [isDragging, setIsDragging] = useState(false);\r\n\r\n // Colors for different users\r\n  const userColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];\r\n  const getUserColor = (userId) => {\r\n    const index = Object.keys(activeUsers).indexOf(userId);\r\n    return userColors[index % userColors.length];\r\n  };\r\n\r\n  // Debounced save function\r\n  // const debouncedSave = useCallback(\r\n  //   debounce(async (roomId, filename, content) => {\r\n  //     try {\r\n  //       await fetch('http://localhost:5000/api/code/save', {\r\n  //         method: 'POST',\r\n  //         headers: { 'Content-Type': 'application/json' },\r\n  //         body: JSON.stringify({ roomId, filename, content }),\r\n  //       });\r\n  //     } catch (err) {\r\n  //       console.error('Error saving file:', err);\r\n  //     }\r\n  //   }, 2000),\r\n  //   [roomId]);\r\n\r\nconst debouncedSave = debounce(async (roomId, filename, content) => {\r\n  try {\r\n    await fetch('https://realtime-code-editor-backend-l2ok.onrender.com/api/code/save', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ roomId, filename, content }),\r\n    });\r\n  } catch (err) {\r\n    console.error('Error saving file:', err);\r\n  }\r\n}, 2000);\r\n\r\n//const debouncedSave = useCallback(debouncedFunction, []);\r\n\r\n  const fetchFiles = useCallback(async () => {\r\n  if (!roomId) return;\r\n\r\n  try {\r\n    const response = await fetch(`https://realtime-code-editor-backend-l2ok.onrender.com/api/code/${roomId}`);\r\n    \r\n    if (!response.ok) {\r\n      if (response.status === 404) {\r\n        // Create default files structure\r\n        const defaultFiles = {\r\n          'index.html': '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>',\r\n          'style.css': '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}',\r\n          'script.js': '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");'\r\n        };\r\n\r\n        // Save default files to database\r\n        await Promise.all(\r\n          Object.entries(defaultFiles).map(([filename, content]) =>\r\n            debouncedSave(roomId, filename, content)\r\n        ));\r\n\r\n        // Create default tree structure\r\n        const defaultTree = {\r\n          name: 'root',\r\n          type: 'folder',\r\n          path: '',\r\n          children: [\r\n            {\r\n              name: 'index.html',\r\n              type: 'file',\r\n              path: 'index.html',\r\n              content: defaultFiles['index.html']\r\n            },\r\n            {\r\n              name: 'style.css',\r\n              type: 'file',\r\n              path: 'style.css',\r\n              content: defaultFiles['style.css']\r\n            },\r\n            {\r\n              name: 'script.js',\r\n              type: 'file',\r\n              path: 'script.js',\r\n              content: defaultFiles['script.js']\r\n            }\r\n          ]\r\n        };\r\n\r\n        return {\r\n          files: defaultFiles,\r\n          tree: defaultTree\r\n        };\r\n      }\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n    \r\n    const { files, tree } = await response.json();\r\n    \r\n    // Ensure required files exist\r\n    const requiredFiles = ['index.html', 'style.css', 'script.js'];\r\n    const completeFiles = { ...files };\r\n    \r\n    requiredFiles.forEach(file => {\r\n      if (!completeFiles[file]) {\r\n        completeFiles[file] = file.endsWith('.html') ? \r\n          '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>' :\r\n          file.endsWith('.css') ? \r\n          '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}' :\r\n          '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");';\r\n        \r\n        // Add missing file to tree if it doesn't exist\r\n        if (!tree.children.some(child => child.name === file)) {\r\n          tree.children.push({\r\n            name: file,\r\n            type: 'file',\r\n            path: file,\r\n            content: completeFiles[file]\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    return {\r\n      files: completeFiles,\r\n      tree: tree\r\n    };\r\n  } catch (error) {\r\n    console.error('Error loading files:', error);\r\n    \r\n    // Fallback to default structure\r\n    const defaultFiles = {\r\n      'index.html': '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>My App</title>\\n</head>\\n<body>\\n    <h1>Hello World!</h1>\\n</body>\\n</html>',\r\n      'style.css': '/* Add your CSS styles here */\\nbody {\\n    font-family: Arial, sans-serif;\\n    margin: 0;\\n    padding: 20px;\\n}',\r\n      'script.js': '// Add your JavaScript code here\\nconsole.log(\"Hello from JavaScript!\");'\r\n    };\r\n\r\n    const defaultTree = {\r\n      name: 'root',\r\n      type: 'folder',\r\n      path: '',\r\n      children: [\r\n        {\r\n          name: 'index.html',\r\n          type: 'file',\r\n          path: 'index.html',\r\n          content: defaultFiles['index.html']\r\n        },\r\n        {\r\n          name: 'style.css',\r\n          type: 'file',\r\n          path: 'style.css',\r\n          content: defaultFiles['style.css']\r\n        },\r\n        {\r\n          name: 'script.js',\r\n          type: 'file',\r\n          path: 'script.js',\r\n          content: defaultFiles['script.js']\r\n        }\r\n      ]\r\n    };\r\n\r\n    return {\r\n      files: defaultFiles,\r\n      tree: defaultTree\r\n    };\r\n  }\r\n}, [roomId, debouncedSave]);\r\n\r\n  // Initialize socket connection\r\n  const initializeSocket = useCallback((filesData) => {\r\n    if (socketRef.current) {\r\n      socketRef.current.disconnect();\r\n    }\r\n\r\n    const socket = io('https://realtime-code-editor-backend-l2ok.onrender.com', {\r\n      transports: ['websocket'],\r\n      upgrade: false,\r\n      reconnectionAttempts: 5,\r\n      reconnectionDelay: 1000,\r\n      timeout: 10000,\r\n    });\r\nsocket.on('room-error', (msg) => {\r\n  alert(msg);           // Show the error message\r\n  navigate('/room');    // Redirect user back to RoomPage\r\n});\r\n\r\n    socket.on('connect', () => {\r\n      console.log('🟢 Connected to server');\r\n      setConnectionStatus('Connected');\r\n      currentUserRef.current = socket.id;\r\n      socket.emit('join-room', { \r\n        roomId, \r\n        username,\r\n        files: filesData \r\n      });\r\n    });\r\n\r\n    socket.on('disconnect', () => {\r\n      console.log('🔴 Disconnected from server');\r\n      setConnectionStatus('Disconnected');\r\n    });\r\n\r\n    socket.on('reconnect', () => {\r\n      console.log('🟡 Reconnected to server');\r\n      setConnectionStatus('Connected');\r\n      socket.emit('join-room', { \r\n        roomId, \r\n        username,\r\n        files: files \r\n      });\r\n    });\r\n\r\n    socket.on('room-state', ({ files: roomFiles, users: roomUsers }) => {\r\n      console.log('📋 Received room state:', { files: Object.keys(roomFiles), users: roomUsers.length });\r\n      setFiles(roomFiles);\r\n      setUsers(roomUsers);\r\n    });\r\n\r\nsocket.on('code-update', ({ filePath, code, sender, position, username: senderUsername }) => {\r\n  if (sender !== currentUserRef.current) {\r\n    console.log('📝 Code update from', senderUsername, 'for', filePath);\r\n    \r\n    isUpdatingFromSocket.current = true;\r\n    // Update both files state and file tree state in a single batch\r\n     \r\n    setFiles(prevFiles => {\r\n      const newFiles = { ...prevFiles, [filePath]: code };\r\n     \r\n      // Update editor content if it's the active file\r\n      if (filePath === activeFile && editorRef.current) {\r\n        const model = editorRef.current.models?.[filePath];\r\n        if (model && model.getValue() !== code) {\r\n          // Save current cursor position\r\n          const currentSelection = editorRef.current.getSelection();\r\n          const scrollInfo = editorRef.current.getScrollTop();\r\n          \r\n          // Update content\r\n          model.setValue(code);\r\n          \r\n          // Restore cursor position if it was the current user's cursor\r\n          if (currentSelection && !position) {\r\n            editorRef.current.setSelection(currentSelection);\r\n            editorRef.current.setScrollTop(scrollInfo);\r\n          }\r\n        }\r\n      }\r\n      \r\n      return newFiles;\r\n    });\r\n  \r\n\r\n    // Update the file tree structure\r\n    setFileTree(prevTree => {\r\n      if (!prevTree) return prevTree;\r\n      \r\n      // Create a deep clone of the tree\r\n      const newTree = JSON.parse(JSON.stringify(prevTree));\r\n      \r\n      // Function to find and update the file in the tree\r\n      const updateFileContent = (nodes) => {\r\n        for (let node of nodes) {\r\n          if (node.path === filePath && node.type === 'file') {\r\n            node.content = code;\r\n            return true;\r\n          }\r\n          if (node.children && updateFileContent(node.children)) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      };\r\n      \r\n      updateFileContent(newTree.children);\r\n      return newTree;\r\n    });\r\n\r\n    // Update user cursor position\r\n    if (position) {\r\n      setUserCursors(prev => ({\r\n        ...prev,\r\n        [sender]: { \r\n          ...prev[sender], \r\n          position, \r\n          activeFile: filePath,\r\n          username: senderUsername\r\n        }\r\n      }));\r\n    }\r\n\r\n    // Show typing indicator\r\n    if (filePath === activeFile) {\r\n      setTypingUsers(prev => ({\r\n        ...prev,\r\n        [sender]: { username: senderUsername, timestamp: Date.now() }\r\n      }));\r\n    }\r\n\r\n    setTimeout(() => {\r\n      isUpdatingFromSocket.current = false;\r\n    }, 100);\r\n  }\r\n});\r\n\r\nsocket.on('file-deleted', ({ path }) => {\r\n  setFiles(prev => {\r\n    const newFiles = { ...prev };\r\n    delete newFiles[path];\r\n    return newFiles;\r\n  });\r\n\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n    \r\n    const newTree = JSON.parse(JSON.stringify(prevTree));\r\n    const removeNode = (nodes) => {\r\n      for (let i = 0; i < nodes.length; i++) {\r\n        if (nodes[i].path === path) {\r\n          nodes.splice(i, 1);\r\n          return true;\r\n        }\r\n        if (nodes[i].children && removeNode(nodes[i].children)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    \r\n    removeNode(newTree.children);\r\n    return newTree;\r\n  });\r\n});\r\n\r\n socket.on('file-renamed', ({ oldPath, newPath }) => {\r\n  setFiles(prev => {\r\n    const newFiles = { ...prev };\r\n    if (newFiles[oldPath]) {\r\n      newFiles[newPath] = newFiles[oldPath];\r\n      delete newFiles[oldPath];\r\n    }\r\n    return newFiles;\r\n  });\r\n\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n    \r\n    const newTree = JSON.parse(JSON.stringify(prevTree));\r\n    const updateNode = (nodes) => {\r\n      for (let node of nodes) {\r\n        if (node.path === oldPath) {\r\n          const newName = newPath.split('/').pop();\r\n          node.name = newName;\r\n          node.path = newPath;\r\n          return true;\r\n        }\r\n        if (node.children && updateNode(node.children)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    \r\n    updateNode(newTree.children);\r\n    return newTree;\r\n  });\r\n\r\n  if (activeFile === oldPath) {\r\n    setActiveFile(newPath);\r\n  }\r\n});\r\nsocket.on('folder-renamed', ({ oldPath, newPath }) => {\r\n  // Update files\r\n  setFiles(prev => {\r\n    const updated = {};\r\n    for (const key in prev) {\r\n      if (key.startsWith(oldPath)) {\r\n        const newKey = key.replace(oldPath, newPath);\r\n        updated[newKey] = prev[key];\r\n      } else {\r\n        updated[key] = prev[key];\r\n      }\r\n    }\r\n    return updated;\r\n  });\r\n\r\n  // Update file tree\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n    const newTree = JSON.parse(JSON.stringify(prevTree));\r\n\r\n    const updatePaths = (nodes) => {\r\n      nodes.forEach((node) => {\r\n        if (node.path.startsWith(oldPath)) {\r\n          node.path = node.path.replace(oldPath, newPath);\r\n          if (node.type === 'folder') {\r\n            node.name = newPath.replace(/\\/$/, '').split('/').pop();\r\n          }\r\n        }\r\n        if (node.children) updatePaths(node.children);\r\n      });\r\n    };\r\n\r\n    updatePaths(newTree.children);\r\n    return newTree;\r\n  });\r\n});\r\nsocket.on('folder-deleted', ({ path }) => {\r\n  setFiles(prev => {\r\n    const updated = {};\r\n    for (const key in prev) {\r\n      if (!key.startsWith(path)) {\r\n        updated[key] = prev[key];\r\n      }\r\n    }\r\n    return updated;\r\n  });\r\n\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n    const newTree = JSON.parse(JSON.stringify(prevTree));\r\n\r\n    const removeFolder = (nodes) => {\r\n      for (let i = 0; i < nodes.length; i++) {\r\n        if (nodes[i].path === path) {\r\n          nodes.splice(i, 1);\r\n          return true;\r\n        }\r\n        if (nodes[i].children && removeFolder(nodes[i].children)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n\r\n    removeFolder(newTree.children);\r\n    return newTree;\r\n  });\r\n});\r\n\r\n    socket.on('user-joined', ({ userId, username: newUsername }) => {\r\n      console.log('👤 User joined:', newUsername);\r\n      setUsers(prev => {\r\n        const exists = prev.find(u => u.id === userId);\r\n        if (!exists) {\r\n          return [...prev, { id: userId, username: newUsername }];\r\n        }\r\n        return prev;\r\n      });\r\n    });\r\n\r\n    socket.on('user-left', ({ userId, username: leftUsername }) => {\r\n      console.log('👤 User left:', leftUsername);\r\n      setUsers(prev => prev.filter(u => u.id !== userId));\r\n      setActiveUsers(prev => {\r\n        const newActive = { ...prev };\r\n        delete newActive[userId];\r\n        return newActive;\r\n      });\r\n      setUserCursors(prev => {\r\n        const newCursors = { ...prev };\r\n        delete newCursors[userId];\r\n        return newCursors;\r\n      });\r\n      setTypingUsers(prev => {\r\n        const newTyping = { ...prev };\r\n        delete newTyping[userId];\r\n        return newTyping;\r\n      });\r\n    });\r\n\r\n    socket.on('cursor-position', ({ userId, username: cursorUsername, position, activeFile: userActiveFile }) => {\r\n      if (userId !== currentUserRef.current && userActiveFile === activeFile) {\r\n        setUserCursors(prev => ({\r\n          ...prev,\r\n          [userId]: { \r\n            position, \r\n            activeFile: userActiveFile, \r\n            username: cursorUsername,\r\n            timestamp: Date.now()\r\n          }\r\n        }));\r\n      }\r\n    });\r\n\r\n    socket.on('user-typing', ({ userId, username: typingUsername, filePath }) => {\r\n      if (userId !== currentUserRef.current && filePath === activeFile) {\r\n        setTypingUsers(prev => ({\r\n          ...prev,\r\n          [userId]: { username: typingUsername, timestamp: Date.now() }\r\n        }));\r\n      }\r\n    });\r\n// Listen for remote file creation\r\nsocket.on('remote-file-created', ({ filePath, content }) => {\r\n  setFiles(prev => ({ ...prev, [filePath]: content }));\r\n\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n\r\n    const newTree = JSON.parse(JSON.stringify(prevTree)); // Deep copy\r\n    const parts = filePath.split('/');\r\n    const fileName = parts.pop(); // last item is the file name\r\n    const folderPathParts = parts;\r\n\r\n    let current = newTree;\r\n\r\n    for (const part of folderPathParts) {\r\n      let folder = current.children.find(\r\n        child => child.name === part && child.type === 'folder'\r\n      );\r\n      if (!folder) {\r\n        folder = {\r\n          name: part,\r\n          type: 'folder',\r\n          path: (current.path || '') + part + '/',\r\n          children: []\r\n        };\r\n        current.children.push(folder);\r\n      }\r\n      current = folder;\r\n    }\r\n\r\n    // Add the new file under the right folder\r\n    current.children.push({\r\n      name: fileName,\r\n      type: 'file',\r\n      path: filePath,\r\n      content\r\n    });\r\n\r\n    return newTree;\r\n  });\r\n});\r\n\r\n// Listen for remote folder creation\r\nsocket.on('remote-folder-created', ({ path }) => {\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n    const exists = prevTree.children.some(child => child.path === path);\r\n    if (!exists) {\r\n      return {\r\n        ...prevTree,\r\n        children: [\r\n          ...prevTree.children,\r\n          {\r\n            name: path.replace(/\\/$/, '').split('/').pop(),\r\n            type: 'folder',\r\n            path,\r\n            children: []\r\n          }\r\n        ]\r\n      };\r\n    }\r\n    return prevTree;\r\n  });\r\n});\r\n\r\n    socketRef.current = socket;\r\n    return socket;\r\n  }, [username, roomId, activeFile, files,navigate]);\r\n\r\n  // Clear old typing indicators\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      const now = Date.now();\r\n      setTypingUsers(prev => {\r\n        const updated = { ...prev };\r\n        Object.keys(updated).forEach(userId => {\r\n          if (now - updated[userId].timestamp > 3000) {\r\n            delete updated[userId];\r\n          }\r\n        });\r\n        return updated;\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\nuseEffect(() => {\r\n  if (!socketRef.current) return;\r\n\r\n  const socket = socketRef.current;\r\n\r\n  socket.on('file-deleted', ({ path }) => {\r\n    setFiles(prev => {\r\n      const newFiles = { ...prev };\r\n      delete newFiles[path];\r\n      return newFiles;\r\n    });\r\n\r\n    setFileTree(prevTree => {\r\n      if (!prevTree) return prevTree;\r\n      const newTree = JSON.parse(JSON.stringify(prevTree));\r\n      const removeNode = (nodes) => {\r\n        for (let i = 0; i < nodes.length; i++) {\r\n          if (nodes[i].path === path) {\r\n            nodes.splice(i, 1);\r\n            return true;\r\n          }\r\n          if (nodes[i].children && removeNode(nodes[i].children)) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      };\r\n      removeNode(newTree.children);\r\n      return newTree;\r\n    });\r\n  });\r\n\r\n  socket.on('file-renamed', ({ oldPath, newPath }) => {\r\n    setFiles(prev => {\r\n      const newFiles = { ...prev };\r\n      if (newFiles[oldPath]) {\r\n        newFiles[newPath] = newFiles[oldPath];\r\n        delete newFiles[oldPath];\r\n      }\r\n      return newFiles;\r\n    });\r\n\r\n    setFileTree(prevTree => {\r\n      if (!prevTree) return prevTree;\r\n      const newTree = JSON.parse(JSON.stringify(prevTree));\r\n      const updateNode = (nodes) => {\r\n        for (let node of nodes) {\r\n          if (node.path === oldPath) {\r\n            const newName = newPath.split('/').pop();\r\n            node.name = newName;\r\n            node.path = newPath;\r\n            return true;\r\n          }\r\n          if (node.children && updateNode(node.children)) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      };\r\n      updateNode(newTree.children);\r\n      return newTree;\r\n    });\r\n\r\n    if (activeFile === oldPath) {\r\n      setActiveFile(newPath);\r\n    }\r\n  });\r\n\r\n  return () => {\r\n    socket.off('file-deleted');\r\n    socket.off('file-renamed');\r\n  };\r\n}, [activeFile]);\r\nuseEffect(() => {\r\n  if (!socketRef.current) return;\r\n  const socket = socketRef.current;\r\n\r\n  // 🔁 Folder Renamed\r\n  socket.on('folder-renamed', ({ oldPath, newPath }) => {\r\n    setFiles(prev => {\r\n      const updated = {};\r\n      for (const key in prev) {\r\n        if (key.startsWith(oldPath)) {\r\n          const updatedKey = key.replace(oldPath, newPath);\r\n          updated[updatedKey] = prev[key];\r\n        } else {\r\n          updated[key] = prev[key];\r\n        }\r\n      }\r\n      return updated;\r\n    });\r\n\r\n    setFileTree(prev => {\r\n      if (!prev) return prev;\r\n      const tree = JSON.parse(JSON.stringify(prev));\r\n      const updatePaths = (nodes) => {\r\n        nodes.forEach(node => {\r\n          if (node.path.startsWith(oldPath)) {\r\n            node.path = node.path.replace(oldPath, newPath);\r\n            if (node.type === 'folder') {\r\n              node.name = newPath.replace(/\\/$/, '').split('/').pop();\r\n            }\r\n          }\r\n          if (node.children) updatePaths(node.children);\r\n        });\r\n      };\r\n      updatePaths(tree.children);\r\n      return tree;\r\n    });\r\n  });\r\n\r\n  // 🗑️ Folder Deleted\r\n  socket.on('folder-deleted', ({ path }) => {\r\n    setFiles(prev => {\r\n      const updated = {};\r\n      for (const key in prev) {\r\n        if (!key.startsWith(path)) {\r\n          updated[key] = prev[key];\r\n        }\r\n      }\r\n      return updated;\r\n    });\r\n\r\n    setFileTree(prev => {\r\n      if (!prev) return prev;\r\n      const tree = JSON.parse(JSON.stringify(prev));\r\n      const removeFolder = (nodes) => {\r\n        for (let i = 0; i < nodes.length; i++) {\r\n          if (nodes[i].path === path) {\r\n            nodes.splice(i, 1);\r\n            return true;\r\n          }\r\n          if (nodes[i].children && removeFolder(nodes[i].children)) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      };\r\n      removeFolder(tree.children);\r\n      return tree;\r\n    });\r\n  });\r\n\r\n  return () => {\r\n    socket.off('folder-renamed');\r\n    socket.off('folder-deleted');\r\n  };\r\n}, []);\r\n\r\n  // Main initialization effect\r\n  useEffect(() => {\r\n    if (!roomId) {\r\n      navigate('/room');\r\n      return;\r\n    }\r\n\r\n    if (initializedRef.current) return;\r\n    initializedRef.current = true;\r\n\r\n    const user = (location.state && location.state.username) ||\r\n                 localStorage.getItem('username') ||\r\n                 'Guest';\r\n    setUsername(user);\r\n\r\n  const initialize = async () => {\r\n  try {\r\n    // 1. Fetch files - now returns { files, tree }\r\n    const { files: filesData, tree } = await fetchFiles();\r\n    \r\n    // 2. Set both states\r\n    setFiles(filesData);\r\n    setFileTree(tree); // Make sure you have this state: const [fileTree, setFileTree] = useState(null);\r\n    \r\n    // 3. Initialize socket with the flat files data\r\n    initializeSocket(filesData);\r\n    \r\n    // 4. Set username (unchanged)\r\n    localStorage.setItem('username', user);\r\n    \r\n    // 5. Set default active file if needed\r\n    if (!activeFile) {\r\n      setActiveFile('index.html');\r\n    }\r\n  } catch (error) {\r\n    console.error('Initialization error:', error);\r\n    setConnectionStatus('Initialization failed');\r\n  }\r\n};\r\n\r\n    initialize();\r\n\r\n    return () => {\r\n      if (socketRef.current) {\r\n        socketRef.current.disconnect();\r\n      }\r\n    };\r\n  }, [roomId, navigate, location.state, fetchFiles, initializeSocket,activeFile]);\r\n\r\n  // Track cursor position more frequently\r\n  useEffect(() => {\r\n    if (!editorRef.current || !socketRef.current?.connected) return;\r\n\r\n    const editor = editorRef.current;\r\n    \r\n    const handleCursorChange = () => {\r\n      if (isUpdatingFromSocket.current) return;\r\n      \r\n      const selection = editor.getSelection();\r\n      if (selection) {\r\n        const position = {\r\n          lineNumber: selection.positionLineNumber,\r\n          column: selection.positionColumn\r\n        };\r\n        \r\n        socketRef.current.emit('cursor-position', {\r\n          roomId,\r\n          filePath: activeFile,\r\n          position,\r\n          username\r\n        });\r\n      }\r\n    };\r\n\r\n    const disposable = editor.onDidChangeCursorPosition(handleCursorChange);\r\n    return () => disposable.dispose();\r\n  }, [roomId, activeFile, username]);\r\n\r\n  // Handle code changes with real-time sync\r\n\r\nconst handleMouseMove =useCallback((e) => {\r\n  if (!isDragging) return;\r\n  \r\n  const container = document.querySelector('.main-editor');\r\n  if (!container) return;\r\n  \r\n  const containerRect = container.getBoundingClientRect();\r\n  const containerWidth = containerRect.width;\r\n  const mouseX = e.clientX - containerRect.left;\r\n  const newWidth = (mouseX / containerWidth) * 100;\r\n  \r\n  // Limit the width between 20% and 80%\r\n  setPanelWidth(Math.min(Math.max(newWidth, 30), 70));\r\n},[isDragging]);\r\nconst handleMouseUp =useCallback( () => {\r\n  setIsDragging(false);\r\n  document.body.style.cursor = '';\r\n  document.removeEventListener('mousemove', handleMouseMove);\r\n  document.removeEventListener('mouseup', handleMouseUp);\r\n},[handleMouseMove]);\r\n// Add this to your cleanup effects\r\nuseEffect(() => {\r\n  return () => {\r\n    document.removeEventListener('mousemove', handleMouseMove);\r\n    document.removeEventListener('mouseup', handleMouseUp);\r\n  };\r\n}, [handleMouseMove, handleMouseUp]);\r\n\r\n  const handleMouseDown = useCallback((e) => {\r\n    e.preventDefault();\r\n  setIsDragging(true);\r\n  document.body.style.cursor = 'col-resize';\r\n  document.addEventListener('mousemove', handleMouseMove);\r\n  document.addEventListener('mouseup', handleMouseUp);\r\n},[handleMouseMove, handleMouseUp]);\r\n\r\n  const handleCodeChange = useCallback((value) => {\r\n    if (!value) value = '';\r\n    if (isUpdatingFromSocket.current) return;\r\n    \r\n    const timestamp = Date.now();\r\n    lastChangeTimestamp.current = timestamp;\r\n     \r\n    setFiles(prev => {\r\n      if (prev[activeFile] !== value) {\r\n        const newFiles = { ...prev, [activeFile]: value };\r\n        \r\n        if (socketRef.current?.connected) {\r\n          const selection = editorRef.current?.getSelection();\r\n          const position = selection ? {\r\n            lineNumber: selection.positionLineNumber,\r\n            column: selection.positionColumn\r\n          } : null;\r\n          \r\n          // Emit real-time changes\r\n          socketRef.current.emit('code-change', {\r\n            roomId,\r\n            filePath: activeFile,\r\n            code: value,\r\n            position,\r\n            timestamp,\r\n            username\r\n          });\r\n\r\n          // Emit typing indicator\r\n          socketRef.current.emit('user-typing', {\r\n            roomId,\r\n            filePath: activeFile,\r\n            username\r\n          });\r\n        }\r\n        \r\n        // Debounced save to database\r\n        debouncedSave(roomId, activeFile, value);\r\n        return newFiles;\r\n      }\r\n      return prev;\r\n    });\r\n  }, [activeFile, roomId, debouncedSave, username]);\r\nconst handleAddFile = () => {\r\n  setShowNewFileModal(true);\r\n};\r\n\r\nconst handleAddFolder = () => {\r\n  setShowNewFolderModal(true);\r\n};\r\nconst createNewFile = async () => {\r\n  if (!newFileName) return;\r\n  \r\n  const fileExt = newFileName.split('.').pop();\r\n  let defaultContent = '';\r\n  \r\n  if (fileExt === 'html') {\r\n    defaultContent = '<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>New File</title>\\n</head>\\n<body>\\n    \\n</body>\\n</html>';\r\n  } else if (fileExt === 'css') {\r\n    defaultContent = '/* Your CSS here */';\r\n  } else if (fileExt === 'js') {\r\n    defaultContent = '// Your JavaScript here';\r\n  }\r\n  \r\n  try {\r\n    // Save to backend first\r\n    await fetch('https://realtime-code-editor-backend-l2ok.onrender.com/api/code/save', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ \r\n        roomId, \r\n        filePath: newFileName, \r\n        content: defaultContent \r\n      }),\r\n    });\r\n\r\n    // Then update local state\r\n    setFiles(prev => ({ ...prev, [newFileName]: defaultContent }));\r\n    \r\n    setFileTree(prevTree => {\r\n      if (!prevTree) return prevTree;\r\n      \r\n      // Check if file already exists in tree\r\n      const exists = prevTree.children.some(child => \r\n        child.path === newFileName\r\n      );\r\n      \r\n      if (!exists) {\r\n        return {\r\n          ...prevTree,\r\n          children: [\r\n            ...prevTree.children,\r\n            {\r\n              name: newFileName,\r\n              type: 'file',\r\n              path: newFileName,\r\n              content: defaultContent\r\n            }\r\n          ]\r\n        };\r\n      }\r\n      return prevTree;\r\n    });\r\n        if (socketRef.current?.connected) {\r\n      socketRef.current.emit('new-file-created', {\r\n        roomId,\r\n        filePath: newFileName,\r\n        content: defaultContent,\r\n        username\r\n      });\r\n    }\r\n\r\n    setActiveFile(newFileName);\r\n    setShowNewFileModal(false);\r\n    setNewFileName('');\r\n    \r\n    // Notify other users\r\n    if (socketRef.current?.connected) {\r\n      socketRef.current.emit('code-change', {\r\n        roomId,\r\n        filePath: newFileName,\r\n        code: defaultContent,\r\n        username\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('Error creating file:', error);\r\n  }\r\n};\r\nconst createFileAtPath = async (path) => {\r\n  const fileExt = path.split('.').pop();\r\n  let defaultContent = '';\r\n  if (fileExt === 'html') defaultContent = '<!DOCTYPE html>\\n<html>\\n<head>\\n<title></title>\\n</head>\\n<body>\\n</body>\\n</html>';\r\n  if (fileExt === 'css') defaultContent = '/* CSS here */';\r\n  if (fileExt === 'js') defaultContent = '// JS here';\r\n\r\n  await fetch('https://realtime-code-editor-backend-l2ok.onrender.com/api/code/save', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ roomId, filePath: path, content: defaultContent }),\r\n  });\r\n\r\n  setFiles(prev => ({ ...prev, [path]: defaultContent }));\r\n  setFileTree(prevTree => {\r\n    if (!prevTree) return prevTree;\r\n\r\n    const newNode = {\r\n      name: path.split('/').pop(),\r\n      type: 'file',\r\n      path,\r\n      content: defaultContent\r\n    };\r\n\r\n    // Recursively insert file under the correct folder\r\n    const insertFile = (tree, folderPath) => {\r\n      if (tree.path === folderPath) {\r\n        tree.children.push(newNode);\r\n        return true;\r\n      }\r\n      for (const child of tree.children) {\r\n        if (child.type === 'folder' && insertFile(child, folderPath)) return true;\r\n      }\r\n      return false;\r\n    };\r\n\r\n    const updatedTree = JSON.parse(JSON.stringify(prevTree));\r\n    insertFile(updatedTree, path.substring(0, path.lastIndexOf('/') + 1));\r\n    return updatedTree;\r\n  });\r\n\r\n  if (socketRef.current?.connected) {\r\n    socketRef.current.emit('new-file-created', {\r\n      roomId,\r\n      filePath: path,\r\n      content: defaultContent,\r\n      username\r\n    });\r\n  }\r\n};\r\n\r\nconst createNewFolder = async () => {\r\n  if (!newFolderName) return;\r\n  \r\n  try {\r\n    // Ensure folder path ends with /\r\n    const folderPath = newFolderName.endsWith('/') ? \r\n      newFolderName : `${newFolderName}/`;\r\n    \r\n    // Save to backend\r\n    await fetch('https://realtime-code-editor-backend-l2ok.onrender.com/api/code/createFolder', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ \r\n        roomId, \r\n        path: folderPath \r\n      }),\r\n    });\r\n\r\n    // Update local state\r\n    setFileTree(prevTree => {\r\n      if (!prevTree) return prevTree;\r\n      \r\n      // Check if folder already exists\r\n      const exists = prevTree.children.some(child => \r\n        child.path === folderPath\r\n      );\r\n      \r\n      if (!exists) {\r\n        return {\r\n          ...prevTree,\r\n          children: [\r\n            ...prevTree.children,\r\n            {\r\n              name: newFolderName,\r\n              type: 'folder',\r\n              path: folderPath,\r\n              children: []\r\n            }\r\n          ]\r\n        };\r\n      }\r\n      return prevTree;\r\n    });\r\n    \r\n    setShowNewFolderModal(false);\r\n    setNewFolderName('');\r\n        if (socketRef.current?.connected) {\r\n      socketRef.current.emit('new-folder-created', {\r\n        roomId,\r\n        path: folderPath,\r\n        username\r\n      });\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Error creating folder:', error);\r\n  }\r\n};\r\n  // Handle running the code\r\n  const handleRun = () => {\r\n    if (!files || !iframeRef.current) return;\r\n\r\n    const html = files['index.html'] || '';\r\n    const css = files['style.css'] || '';\r\n    const js = files['script.js'] || '';\r\n\r\n    const combined = `\r\n      <!DOCTYPE html>\r\n      <html>\r\n        <head>\r\n          <meta charset=\"UTF-8\">\r\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n          <style>${css}</style>\r\n        </head>\r\n        <body>\r\n          ${html}\r\n          <script>\r\n            // Error handling for iframe\r\n            window.onerror = function(msg, url, line, col, error) {\r\n              console.error('Error:', msg, 'at', line + ':' + col);\r\n              return false;\r\n            };\r\n            ${js}\r\n          </script>\r\n        </body>\r\n      </html>\r\n    `;\r\n\r\n    const blob = new Blob([combined], { type: 'text/html' });\r\n    const url = URL.createObjectURL(blob);\r\n    iframeRef.current.src = url;\r\n    setTimeout(() => URL.revokeObjectURL(url), 1000);\r\n  };\r\n\r\n  // Handle file switching\r\n  // const handleFileSwitch = (fileName) => {\r\n  //   setActiveFile(fileName);\r\n  //    if (editorRef.current?.models?.[fileName]) {\r\n  //   editorRef.current.setModel(editorRef.current.models[fileName]);\r\n  // }\r\n  //   if (socketRef.current?.connected) {\r\n  //     socketRef.current.emit('file-switch', {\r\n  //       roomId,\r\n  //       filePath: fileName,\r\n  //       username\r\n  //     });\r\n  //   }\r\n  // };\r\n const handleEditorMount = (editor, monaco) => {\r\n  editorRef.current = editor;\r\n\r\n  // Initialize models object if not present\r\n  if (!editorRef.current.models) {\r\n    editorRef.current.models = {};\r\n  }\r\n\r\n  // Create or reuse a separate model for each file\r\n  Object.entries(files).forEach(([filePath, content]) => {\r\n    if (!editorRef.current.models[filePath]) {\r\n      const lang = getLanguage(filePath);\r\n      editorRef.current.models[filePath] = monaco.editor.createModel(content, lang);\r\n    }\r\n  });\r\n\r\n  // Set current active model\r\n  const activeModel = editorRef.current.models[activeFile];\r\n  if (activeModel) {\r\n    editor.setModel(activeModel);\r\n  }\r\n\r\n  // Cursor tracking\r\n  editor.onDidChangeCursorPosition(() => {\r\n    if (socketRef.current?.connected && !isUpdatingFromSocket.current) {\r\n      const selection = editor.getSelection();\r\n      if (selection) {\r\n        const position = {\r\n          lineNumber: selection.positionLineNumber,\r\n          column: selection.positionColumn\r\n        };\r\n        socketRef.current.emit('cursor-position', {\r\n          roomId,\r\n          filePath: activeFile,\r\n          position,\r\n          username\r\n        });\r\n      }\r\n    }\r\n  });\r\n};\r\nconst handleFileSwitch = (fileName) => {\r\n  setActiveFile(fileName);\r\n\r\n  const model = editorRef.current?.models?.[fileName];\r\n  if (model) {\r\n    editorRef.current.setModel(model);  // ✅ this is correct\r\n  }\r\n};\r\n\r\n\r\n  // Cleanup on page unload\r\n  useBeforeUnload(() => {\r\n    if (socketRef.current) {\r\n      socketRef.current.disconnect();\r\n    }\r\n  });\r\n\r\n  const getLanguage = (file) => {\r\n    if (file.endsWith('.js')) return 'javascript';\r\n    if (file.endsWith('.html')) return 'html';\r\n    if (file.endsWith('.css')) return 'css';\r\n    return 'plaintext';\r\n  };\r\n\r\n  if (!files || !fileTree) {\r\n    return (\r\n      <div className=\"editor-wrapper\" >\r\n        <div className=\"loading-screen\">\r\n          <div className=\"loading-spinner\"></div>\r\n          <div>Loading collaborative editor...</div>\r\n          <div className=\"connection-status\">{connectionStatus}</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const typingUsersList = Object.values(typingUsers);\r\n\r\n  return (\r\n    <div className=\"editor-wrapper\">\r\n      <div className=\"collaboration-bar\">\r\n        <div className=\"room-info\">\r\n          <strong>Room:</strong> {roomId} | <strong>User:</strong> {username}\r\n          <span className={`connection-status ${connectionStatus === 'Connected' ? 'connected' : 'disconnected'}`}>\r\n            ● {connectionStatus}\r\n          </span>\r\n        </div>\r\n        \r\n        <div className=\"online-users\">\r\n          <span className=\"users-label\">Online ({users.length}):</span>\r\n          {users.map(user => (\r\n            <div \r\n              key={user.id} \r\n              className=\"user-badge\"\r\n              style={{ backgroundColor: getUserColor(user.id) }}\r\n            >\r\n              {user.username}\r\n              {user.id === currentUserRef.current && ' (You)'}\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {typingUsersList.length > 0 && (\r\n          <div className=\"typing-indicator\">\r\n            <span className=\"typing-dots\">●●●</span>\r\n            {typingUsersList.map(t => t.username).join(', ')} \r\n            {typingUsersList.length === 1 ? ' is' : ' are'} typing in {activeFile}...\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"editor-container\" style={{ flexDirection: 'row' }}>\r\n        <div className=\"sidebar\">\r\n          <FileSidebar\r\n            tree={fileTree} \r\n           activeFile={activeFile}\r\n         setActiveFile={handleFileSwitch}\r\n         onAddFile={handleAddFile}\r\n             onAddFolder={handleAddFolder}\r\n               onAddFileToFolder={createFileAtPath}\r\n               roomId={roomId}\r\n               setFiles={setFiles}           // Pass down the setter\r\n          setFileTree={setFileTree}     // Pass down the setter\r\n      socketRef={socketRef}         // Pass down the ref\r\n      username={username}\r\n          /> \r\n        </div>\r\n\r\n        <div className=\"main-editor noselect\" style={{ display: 'flex', flexDirection: 'row', flex: 1 }}>\r\n          \r\n          <div style={{ width: `${panelWidth}%`, display: 'flex', flexDirection: 'column',minWidth: '300px' }}>\r\n          <div className=\"editor-header\">\r\n            <div className=\"file-info\">\r\n              <strong>{activeFile}</strong>\r\n              <span className=\"file-language\">({getLanguage(activeFile)})</span>\r\n            </div>\r\n            <button className=\"run-button\" onClick={handleRun}>\r\n              ▶ Run \r\n            </button>\r\n            <button className=\"download-button\" onClick={downloadProjectAsZip}>\r\n             ⬇ Download ZIP\r\n           </button>\r\n          </div>\r\n\r\n          <div className=\"editor-container-with-cursors\">\r\n            <Editor\r\n              height=\"50vh\"\r\n              language={getLanguage(activeFile)}\r\n              value={files[activeFile] || \"\"}\r\n              onChange={handleCodeChange}\r\n              onMount={handleEditorMount}//(editor,monaco) => {\r\n//                 editorRef.current = editor;\r\n//                  if (!editorRef.current.models) {\r\n//     editorRef.current.models = {};\r\n//   }\r\n  \r\n//   Object.entries(files).forEach(([filePath, content]) => {\r\n//     if (!editorRef.current.models[filePath]) {\r\n//       const language = getLanguage(filePath);\r\n//       editorRef.current.models[filePath] = monaco.editor.createModel(content, language);\r\n//     } \r\n//   });\r\n\r\n//   editor.setModel(editorRef.current.models[activeFile]);\r\n\r\n//   // Save the models for reuse\r\n// //  editorRef.current.models = models;\r\n//                 // Add cursor tracking\r\n//                 editor.onDidChangeCursorPosition(() => {\r\n//                   if (socketRef.current?.connected && !isUpdatingFromSocket.current) {\r\n//                     const selection = editor.getSelection();\r\n//                     if (selection) {\r\n//                       const position = {\r\n//                         lineNumber: selection.positionLineNumber,\r\n//                         column: selection.positionColumn\r\n//                       };\r\n                      \r\n//                       socketRef.current.emit('cursor-position', {\r\n//                         roomId,\r\n//                         filePath: activeFile,\r\n//                         position,\r\n//                         username\r\n//                       });\r\n//                     }\r\n//                   }\r\n//                 });\r\n//               }}\r\n\r\n\r\n              theme=\"vs-dark\"\r\n              options={{\r\n                minimap: { enabled: false },\r\n                fontSize: 14,\r\n                wordWrap: 'on',\r\n                automaticLayout: true,\r\n                scrollBeyondLastLine: false,\r\n                renderWhitespace: 'selection',\r\n                smoothScrolling: true,\r\n                cursorBlinking: 'smooth',\r\n                cursorSmoothCaretAnimation: true,\r\n              }}\r\n            />\r\n            \r\n            {/* Render other users' cursors */}\r\n            {Object.entries(userCursors).map(([userId, cursor]) => (\r\n              cursor.activeFile === activeFile && (\r\n                <div\r\n                  key={userId}\r\n                  className=\"user-cursor\"\r\n                  style={{\r\n                    position: 'absolute',\r\n                    top: `${(cursor.position?.lineNumber || 0) * 18}px`,\r\n                    left: `${(cursor.position?.column || 0) * 8}px`,\r\n                    borderLeft: `2px solid ${getUserColor(userId)}`,\r\n                    height: '18px',\r\n                    pointerEvents: 'none',\r\n                    zIndex: 1000,\r\n                  }}\r\n                >\r\n                  <div\r\n                    className=\"user-cursor-label\"\r\n                    style={{\r\n                      backgroundColor: getUserColor(userId),\r\n                      color: 'white',\r\n                      padding: '2px 6px',\r\n                      borderRadius: '3px',\r\n                      fontSize: '11px',\r\n                      position: 'absolute',\r\n                      top: '-20px',\r\n                      left: '0',\r\n                      whiteSpace: 'nowrap',\r\n                    }}\r\n                  >\r\n                    {cursor.username}\r\n                  </div>\r\n                </div>\r\n              )\r\n            ))}\r\n          </div>\r\n          </div>\r\n<div \r\n    className=\"resize-handle\"\r\n    onMouseDown={handleMouseDown}\r\n    style={{ \r\n      width: '5px', \r\n      cursor: 'col-resize',\r\n      backgroundColor: isDragging ? '#007acc' : '#3e3e42',\r\n      transition: 'background-color 0.2s ease'\r\n    }}\r\n  />\r\n          <div className=\"output-panel\" style={{ width: `${100 - panelWidth}%`, minWidth: '300px' }}>\r\n            <div className=\"output-header\">\r\n              <strong>Output Preview</strong>\r\n              <button className=\"refresh-output\" onClick={handleRun}>\r\n                🔄 Refresh\r\n              </button>\r\n            </div>\r\n            <iframe\r\n              ref={iframeRef}\r\n              title=\"Live Code Output\"\r\n              className=\"output-frame\"\r\n                style={{ flex: 1, border: 'none', background: 'white', width: '100%', height: '100%' }}\r\n              sandbox=\"allow-scripts allow-same-origin allow-forms\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {showNewFileModal && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal\">\r\n            <h3>Create New File</h3>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"filename.html/.css/.js\"\r\n              value={newFileName}\r\n              onChange={(e) => setNewFileName(e.target.value)}\r\n            />\r\n            <div className=\"modal-actions\">\r\n              <button onClick={() => setShowNewFileModal(false)}>Cancel</button>\r\n              <button onClick={createNewFile}>Create</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showNewFolderModal && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal\">\r\n            <h3>Create New Folder</h3>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Folder name\"\r\n              value={newFolderName}\r\n              onChange={(e) => setNewFolderName(e.target.value)}\r\n            />\r\n            <div className=\"modal-actions\">\r\n              <button onClick={() => setShowNewFolderModal(false)}>Cancel</button>\r\n              <button onClick={createNewFolder}>Create</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n   \r\n\r\nfunction debounce(func, wait) {\r\n  let timeout;\r\n  return function executedFunction(...args) {\r\n    const later = () => {\r\n      clearTimeout(timeout);\r\n      func(...args);\r\n    };\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n}\r\n\r\nexport default EditorPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}